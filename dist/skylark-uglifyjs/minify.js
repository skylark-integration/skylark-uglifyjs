/**
 * skylark-uglifyjs - A version of uglifyjs that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./utils","./ast","./parse","./output","./compress","./sourcemap","./propmangle"],function(e,r,a,n,o,s,t){"use strict";const{defaults:g,HOP:f}=e,{AST_Toplevel:d,AST_Node:v}=r,_=a["parse"],w=n["OutputStream"],h=o["Compressor"],b=s["SourceMap"],{mangle_properties:M,reserve_quoted_keys:k}=t;var y,S;function D(r){try{return JSON.parse(r)}catch(e){throw new Error("invalid input source map: "+r)}}function x(r,a,e){e.forEach(function(e){a[e]&&("object"!=typeof a[e]&&(a[e]={}),r in a[e]||(a[e][r]=a[r]))})}function C(e){e&&("props"in e?e.props instanceof Dictionary||(e.props=Dictionary.fromObject(e.props)):e.props=new Dictionary)}function j(e){return{props:e.props.toObject()}}return S="undefined"==typeof Buffer?(y=atob,btoa):void 0===Buffer.alloc?(y=function(e){return new Buffer(e,"base64").toString()},function(e){return new Buffer(e).toString("base64")}):(y=function(e){return Buffer.from(e,"base64").toString()},function(e){return Buffer.from(e).toString("base64")}),{minify:function(n,o){try{(o=g(o,{annotations:void 0,compress:{},enclose:!1,expression:!1,ie:!1,ie8:!1,keep_fargs:!1,keep_fnames:!1,mangle:{},module:!1,nameCache:null,output:{},parse:{},rename:void 0,sourceMap:!1,timings:!1,toplevel:!(!o||!o.module),v8:!1,validate:!1,warnings:!1,webkit:!1,wrap:!1},!0)).validate&&v.enable_validation();var e,s,r=o.timings&&{start:Date.now()},a=(void 0!==o.annotations&&x("annotations",o,["compress","output"]),o.expression&&x("expression",o,["compress","parse"]),o.ie8&&(o.ie=o.ie||o.ie8),o.ie&&x("ie",o,["compress","mangle","output","rename"]),o.keep_fargs&&x("keep_fargs",o,["compress","mangle","rename"]),o.keep_fnames&&x("keep_fnames",o,["compress","mangle","rename"]),o.module&&x("module",o,["compress","parse"]),o.toplevel&&x("toplevel",o,["compress","mangle","rename"]),o.v8&&x("v8",o,["mangle","output","rename"]),o.webkit&&x("webkit",o,["compress","mangle","output","rename"]),o.mangle&&(o.mangle=g(o.mangle,{cache:o.nameCache&&(o.nameCache.vars||{}),eval:!1,ie:!1,keep_fargs:!1,keep_fnames:!1,properties:!1,reserved:[],toplevel:!1,v8:!1,webkit:!1},!0),o.mangle.properties&&("object"!=typeof o.mangle.properties&&(o.mangle.properties={}),o.mangle.properties.keep_quoted&&(e=o.mangle.properties.reserved,Array.isArray(e)||(e=[]),o.mangle.properties.reserved=e),!o.nameCache||"cache"in o.mangle.properties||(o.mangle.properties.cache=o.nameCache.props||{})),C(o.mangle.cache),C(o.mangle.properties.cache)),void 0===o.rename&&(o.rename=o.compress&&o.mangle),o.sourceMap&&(o.sourceMap=g(o.sourceMap,{content:null,filename:null,includeSources:!1,names:!0,root:null,url:null},!0)),[]);if(o.warnings&&v.log_function(function(e){a.push(e)},"verbose"==o.warnings),r&&(r.parse=Date.now()),o.parse=o.parse||{},n instanceof v)s=n;else{"string"==typeof n&&(n=[n]),o.parse.toplevel=null;var t,p=o.sourceMap&&o.sourceMap.content;for(l in(p="string"==typeof p&&"inline"!=p?D(p):p)&&(o.sourceMap.orig=Object.create(null)),n)f(n,l)&&(o.parse.filename=l,o.parse.toplevel=s=_(n[l],o.parse),"inline"==p?(t=function(e,r){for(var a=r.end.comments_after,n=a.length;0<=--n;){var o=a[n];if("comment1"!=o.type)break;o=/^# ([^\s=]+)=(\S+)\s*$/.exec(o.value);if(!o)break;if("sourceMappingURL"==o[1]){if(o=/^data:application\/json(;.*?)?;base64,([^,]+)$/.exec(o[2]))return y(o[2]);break}}v.warn("inline source map not found: {name}",{name:e})}(l,s))&&(o.sourceMap.orig[l]=D(t)):p&&(o.sourceMap.orig[l]=p))}o.parse.expression&&(s=s.wrap_expression()),e&&k(s,e),["enclose","wrap"].forEach(function(e){var r,a=o[e];a&&(r=s.print_to_string().slice(0,-1),s=s[e](a),n[s.start.file]=s.print_to_string().replace(r,""))}),o.validate&&s.validate_ast(),r&&(r.rename=Date.now()),o.rename&&(s.figure_out_scope(o.rename),s.expand_names(o.rename)),r&&(r.compress=Date.now()),o.compress&&(s=new h(o.compress).compress(s),o.validate)&&s.validate_ast(),r&&(r.scope=Date.now()),o.mangle&&s.figure_out_scope(o.mangle),r&&(r.mangle=Date.now()),o.mangle&&(s.compute_char_frequency(o.mangle),s.mangle_names(o.mangle)),r&&(r.properties=Date.now()),e&&k(s,e),o.mangle&&o.mangle.properties&&M(s,o.mangle.properties),o.parse.expression&&(s=s.unwrap_expression()),r&&(r.output=Date.now());var i={},c=g(o.output,{ast:!1,code:!0});if(c.ast&&(i.ast=s),c.code){if(o.sourceMap&&(c.source_map=b(o.sourceMap),o.sourceMap.includeSources)){if(n instanceof d)throw new Error("original source content unavailable");for(var l in n)f(n,l)&&c.source_map.setSourceContent(l,n[l])}delete c.ast,delete c.code;var m,u=w(c);s.print(u),i.code=u.get(),o.sourceMap&&(i.map=c.source_map.toString(),m=o.sourceMap.url)&&(i.code=i.code.replace(/\n\/\/# sourceMappingURL=\S+\s*$/,""),i.code+="inline"==m?"\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,"+S(i.map):"\n//# sourceMappingURL="+m)}return o.nameCache&&o.mangle&&(o.mangle.cache&&(o.nameCache.vars=j(o.mangle.cache)),o.mangle.properties)&&o.mangle.properties.cache&&(o.nameCache.props=j(o.mangle.properties.cache)),r&&(r.end=Date.now(),i.timings={parse:.001*(r.rename-r.parse),rename:.001*(r.compress-r.rename),compress:.001*(r.scope-r.compress),scope:.001*(r.mangle-r.scope),mangle:.001*(r.properties-r.mangle),properties:.001*(r.output-r.properties),output:.001*(r.end-r.output),total:.001*(r.end-r.start)}),a.length&&(i.warnings=a),i}finally{v.log_function(),v.disable_validation()}}}});
//# sourceMappingURL=sourcemaps/minify.js.map
