/**
 * skylark-uglifyjs - A version of uglifyjs that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./utils","./ast","./parse","./output","./compress","./sourcemap","./propmangle"],function(e,r,a,n,o,s,t){"use strict";const{defaults:p,HOP:i}=e,{AST_Toplevel:c,AST_Node:l,walk:m,AST_Scope:u}=r,{parse:f}=a,{OutputStream:g}=n,{Compressor:v}=o,{SourceMap:d}=s,{mangle_properties:_,reserve_quoted_keys:w}=t;var h,b;function M(e,r){for(var a=r.end.comments_after,n=a.length;--n>=0;){var o=a[n];if("comment1"!=o.type)break;var s=/^# ([^\s=]+)=(\S+)\s*$/.exec(o.value);if(!s)break;if("sourceMappingURL"==s[1]){if(!(s=/^data:application\/json(;.*?)?;base64,([^,]+)$/.exec(s[2])))break;return h(s[2])}}l.warn("inline source map not found: {name}",{name:e})}function k(e){try{return JSON.parse(e)}catch(r){throw new Error("invalid input source map: "+e)}}function y(e,r,a){a.forEach(function(a){r[a]&&("object"!=typeof r[a]&&(r[a]={}),e in r[a]||(r[a][e]=r[e]))})}function S(e){e&&("props"in e?e.props instanceof Dictionary||(e.props=Dictionary.fromObject(e.props)):e.props=new Dictionary)}function D(e){return{props:e.props.toObject()}}return"undefined"==typeof Buffer?(h=atob,b=btoa):void 0===Buffer.alloc?(h=function(e){return new Buffer(e,"base64").toString()},b=function(e){return new Buffer(e).toString("base64")}):(h=function(e){return Buffer.from(e,"base64").toString()},b=function(e){return Buffer.from(e).toString("base64")}),{minify:function(e,r){try{(r=p(r,{annotations:void 0,compress:{},enclose:!1,expression:!1,ie:!1,ie8:!1,keep_fargs:!1,keep_fnames:!1,mangle:{},module:!1,nameCache:null,output:{},parse:{},rename:void 0,sourceMap:!1,timings:!1,toplevel:!(!r||!r.module),v8:!1,validate:!1,warnings:!1,webkit:!1,wrap:!1},!0)).validate&&l.enable_validation();var a,n=r.timings&&{start:Date.now()};void 0!==r.annotations&&y("annotations",r,["compress","output"]),r.expression&&y("expression",r,["compress","parse"]),r.ie8&&(r.ie=r.ie||r.ie8),r.ie&&y("ie",r,["compress","mangle","output","rename"]),r.keep_fargs&&y("keep_fargs",r,["compress","mangle","rename"]),r.keep_fnames&&y("keep_fnames",r,["compress","mangle","rename"]),r.module&&y("module",r,["compress","parse"]),r.toplevel&&y("toplevel",r,["compress","mangle","rename"]),r.v8&&y("v8",r,["mangle","output","rename"]),r.webkit&&y("webkit",r,["compress","mangle","output","rename"]),r.mangle&&(r.mangle=p(r.mangle,{cache:r.nameCache&&(r.nameCache.vars||{}),eval:!1,ie:!1,keep_fargs:!1,keep_fnames:!1,properties:!1,reserved:[],toplevel:!1,v8:!1,webkit:!1},!0),r.mangle.properties&&("object"!=typeof r.mangle.properties&&(r.mangle.properties={}),r.mangle.properties.keep_quoted&&(a=r.mangle.properties.reserved,Array.isArray(a)||(a=[]),r.mangle.properties.reserved=a),!r.nameCache||"cache"in r.mangle.properties||(r.mangle.properties.cache=r.nameCache.props||{})),S(r.mangle.cache),S(r.mangle.properties.cache)),void 0===r.rename&&(r.rename=r.compress&&r.mangle),r.sourceMap&&(r.sourceMap=p(r.sourceMap,{content:null,filename:null,includeSources:!1,names:!0,root:null,url:null},!0));var o,s=[];if(r.warnings&&l.log_function(function(e){s.push(e)},"verbose"==r.warnings),n&&(n.parse=Date.now()),r.parse=r.parse||{},e instanceof l)o=e;else{"string"==typeof e&&(e=[e]),r.parse.toplevel=null;var t=r.sourceMap&&r.sourceMap.content;for(var m in"string"==typeof t&&"inline"!=t&&(t=k(t)),t&&(r.sourceMap.orig=Object.create(null)),e)if(i(e,m))if(r.parse.filename=m,r.parse.toplevel=o=f(e[m],r.parse),"inline"==t){var u=M(m,o);u&&(r.sourceMap.orig[m]=k(u))}else t&&(r.sourceMap.orig[m]=t)}r.parse.expression&&(o=o.wrap_expression()),a&&w(o,a),["enclose","wrap"].forEach(function(a){var n=r[a];if(n){var s=o.print_to_string().slice(0,-1);o=o[a](n),e[o.start.file]=o.print_to_string().replace(s,"")}}),r.validate&&o.validate_ast(),n&&(n.rename=Date.now()),r.rename&&(o.figure_out_scope(r.rename),o.expand_names(r.rename)),n&&(n.compress=Date.now()),r.compress&&(o=new v(r.compress).compress(o),r.validate&&o.validate_ast()),n&&(n.scope=Date.now()),r.mangle&&o.figure_out_scope(r.mangle),n&&(n.mangle=Date.now()),r.mangle&&(o.compute_char_frequency(r.mangle),o.mangle_names(r.mangle)),n&&(n.properties=Date.now()),a&&w(o,a),r.mangle&&r.mangle.properties&&_(o,r.mangle.properties),r.parse.expression&&(o=o.unwrap_expression()),n&&(n.output=Date.now());var h={},x=p(r.output,{ast:!1,code:!0});if(x.ast&&(h.ast=o),x.code){if(r.sourceMap&&(x.source_map=d(r.sourceMap),r.sourceMap.includeSources)){if(e instanceof c)throw new Error("original source content unavailable");for(var m in e)i(e,m)&&x.source_map.setSourceContent(m,e[m])}delete x.ast,delete x.code;var C=g(x);if(o.print(C),h.code=C.get(),r.sourceMap){h.map=x.source_map.toString();var j=r.sourceMap.url;j&&(h.code=h.code.replace(/\n\/\/# sourceMappingURL=\S+\s*$/,""),h.code+="inline"==j?"\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,"+b(h.map):"\n//# sourceMappingURL="+j)}}return r.nameCache&&r.mangle&&(r.mangle.cache&&(r.nameCache.vars=D(r.mangle.cache)),r.mangle.properties&&r.mangle.properties.cache&&(r.nameCache.props=D(r.mangle.properties.cache))),n&&(n.end=Date.now(),h.timings={parse:.001*(n.rename-n.parse),rename:.001*(n.compress-n.rename),compress:.001*(n.scope-n.compress),scope:.001*(n.mangle-n.scope),mangle:.001*(n.properties-n.mangle),properties:.001*(n.output-n.properties),output:.001*(n.end-n.output),total:.001*(n.end-n.start)}),s.length&&(h.warnings=s),h}finally{l.log_function(),l.disable_validation()}}}});
//# sourceMappingURL=sourcemaps/minify.js.map
