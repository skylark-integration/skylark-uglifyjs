/**
 * skylark-uglifyjs - A version of uglifyjs that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./utils","./ast"],function(e,n){"use strict";const{characters:t,defaults:r,makePredicate:a,set_annotation:o,configure_error_stack:i,HOP:s,all:u}=e,{AST_Accessor:c,AST_Array:l,AST_Arrow:f,AST_Assign:p,AST_Await:_,AST_BigInt:d,AST_Binary:v,AST_BlockStatement:m,AST_Break:S,AST_Call:w,AST_Case:A,AST_Catch:k,AST_Chain:y,AST_ClassExpression:h,AST_ClassPrivateProperty:T,AST_ClassProperty:b,AST_ClassStaticBlock:g,AST_ConciseMethod:x,AST_PrivateIn:D,AST_PrivateGetter:C,AST_PrivateMethod:E,AST_PrivateSetter:I,AST_Conditional:P,AST_Const:F,AST_Continue:O,AST_Debugger:N,AST_Default:G,AST_DefaultAssign:U,AST_DefClass:R,AST_Definitions:j,AST_Defun:M,AST_Destructured:V,AST_DestructuredArray:L,AST_DestructuredKeyVal:$,AST_DestructuredObject:Y,AST_Destructuring:q,AST_Directive:B,AST_Do:z,AST_Dot:K,AST_DotHash:W,AST_EmptyStatement:X,AST_Expansion:H,AST_Export:J,AST_ExportDeclaration:Q,AST_False:Z,AST_Finally:ee,AST_For:ne,AST_ForIn:te,AST_ForOf:re,AST_Function:ae,AST_Hole:oe,AST_If:ie,AST_Import:se,AST_ImportMeta:ue,AST_IterationStatement:ce,AST_Label:le,AST_LabeledStatement:fe,AST_LabelRef:pe,AST_Let:_e,AST_NameMapping:de,AST_New:ve,AST_NewTarget:me,AST_Node:Se,AST_Null:we,AST_Number:Ae,AST_Object:ke,AST_ObjectGetter:ye,AST_ObjectKeyVal:he,AST_ObjectProperty:Te,AST_ObjectSetter:be,AST_PrefixedTemplateString:ge,AST_PropAccess:xe,AST_RegExp:De,AST_Return:Ce,AST_Sequence:Ee,AST_SimpleStatement:Ie,AST_String:Pe,AST_Sub:Fe,AST_Super:Oe,AST_Switch:Ne,AST_SymbolCatch:Ge,AST_SymbolClass:Ue,AST_SymbolClassProperty:Re,AST_SymbolConst:je,AST_SymbolDeclaration:Me,AST_SymbolDefClass:Ve,AST_SymbolDefun:Le,AST_SymbolExport:$e,AST_SymbolExportForeign:Ye,AST_SymbolFunarg:qe,AST_SymbolImport:Be,AST_SymbolImportForeign:ze,AST_SymbolLambda:Ke,AST_SymbolLet:We,AST_SymbolMethod:Xe,AST_SymbolRef:He,AST_SymbolVar:Je,AST_TemplateSegment:Qe,AST_TemplateString:Ze,AST_This:en,AST_SymbolPrivateProperty:nn,AST_Throw:tn,AST_Token:rn,AST_Toplevel:an,AST_True:on,AST_Try:sn,AST_TryBlock:un,AST_UnaryPostfix:cn,AST_UnaryPrefix:ln,AST_Var:fn,AST_VarDef:pn,AST_While:_n,AST_With:dn,AST_Yield:vn,_INLINE:mn,_NOINLINE:Sn,_PURE:wn,_KEY:An,_MANGLEPROP:kn}=n;var yn="break case catch class const continue debugger default delete do else extends finally for function if in instanceof new return switch throw try typeof var void while with",hn="false null true",Tn=["abstract async await boolean byte char double enum export final float goto implements import int interface let long native package private protected public short static super synchronized this throws transient volatile yield",hn,yn].join(" "),bn="return new delete throw else case";yn=a(yn),Tn=a(Tn),bn=a(bn),hn=a(hn);var gn=/^0b([01]+)$/i,xn=/^0x([0-9a-f]+)$/i,Dn=/^0o?([0-7]+)$/i,Cn=a(["in","instanceof","typeof","new","void","delete","++","--","+","-","!","~","&","|","^","*","/","%","**",">>","<<",">>>","<",">","<=",">=","==","===","!=","!==","?","=","+=","-=","/=","*=","%=","**=",">>=","<<=",">>>=","&=","|=","^=","&&","||","??","&&=","||=","??="]),En="\n\r\u2028\u2029",In="+-*&%=<>!?|~^",Pn=",;:)}]",Fn="[{(,;:",On=Fn+"`)}]",Nn=En+"  \t\f\v​             　\ufeff",Gn=a(t("./'\"#"+In+On+Nn));function Un(e){return e>=48&&e<=57}function Rn(e){return!Gn[e]}function jn(e){return/^[a-z_$][a-z0-9_$]*$/i.test(e)}function Mn(e,n,t,r,a){this.message=e,this.filename=n,this.line=t,this.col=r,this.pos=a}function Vn(e,n,t,r,a){throw new Mn(e,n,t,r,a)}function Ln(e,n,t){return e.type==n&&(null==t||e.value==t)}En=a(t(En)),In=a(t(In)),Pn=a(t(Pn)),Fn=a(t(Fn)),On=a(t(On)),Nn=a(t(Nn)),Mn.prototype=Object.create(Error.prototype),Mn.prototype.constructor=Mn,Mn.prototype.name="SyntaxError",i(Mn);var $n={};function Yn(e,n,t,r){var a={text:e,filename:n,pos:0,tokpos:0,line:1,tokline:0,col:0,tokcol:0,newline_before:!1,regex_allowed:!1,comments_before:[],directives:Object.create(null),read_template:b("Unterminated template literal",function(e){for(var n="";;){var t=r();switch(t){case"\\":t+=r();break;case"`":return void e.push(n);case"$":if("{"==i())return s(),e.push(n),a.regex_allowed=!0,!0}n+=t}function r(){var e=s(!0,!0);return"\r"==e?"\n":e}})},o=!1;function i(){return a.text.charAt(a.pos)}function s(e,n){var t=a.text.charAt(a.pos++);if(e&&!t)throw $n;return En[t]?(a.col=0,a.line++,n||(a.newline_before=!0),"\r"==t&&"\n"==i()&&(a.pos++,t="\n")):a.col++,t}function u(e){for(;e-- >0;)s()}function c(e){return a.text.substr(a.pos,e.length)==e}function l(){a.tokline=a.line,a.tokcol=a.col,a.tokpos=a.pos}function f(t,r,i){a.regex_allowed="operator"==t&&!Bn[r]||"keyword"==t&&bn[r]||"punc"==t&&Fn[r],"punc"==t&&"."==r?o=!0:i||(o=!1);var s={type:t,value:r,line:a.tokline,col:a.tokcol,pos:a.tokpos,endline:a.line,endcol:a.col,endpos:a.pos,nlb:a.newline_before,file:n};return/^(?:num|string|regexp)$/i.test(t)&&(s.raw=e.substring(s.pos,s.endpos)),i||(s.comments_before=a.comments_before,s.comments_after=a.comments_before=[]),a.newline_before=!1,new rn(s)}function p(){for(;Nn[i()];)s()}function _(e){Vn(e,n,a.tokline,a.tokcol,a.tokpos)}function d(e){return/^0[0-7_]+$/.test(e)}function v(e){var n=!1,t=!1,r=!1,a="."==e,o=function(e){for(var n,t="";(n=i())&&e(n,t);)t+=s();return t}(function(e,o){switch(e){case"x":case"X":return!r&&(r=!0);case"e":case"E":return!!r||!n&&(n=t=!0);case"+":case"-":return t;case t=!1,".":return!(a||n||r||d(o))&&(a=!0)}return/[_0-9a-dfo]/i.test(e)});e&&(o=e+o),d(o)?g.has_directive("use strict")&&_("Legacy octal literals are not allowed in strict mode"):o=o.replace(r?/([1-9a-f]|.0)_(?=[0-9a-f])/gi:/([1-9]|.0)_(?=[0-9])/gi,"$1");var u=function(e){var n;if(n=gn.exec(e))return parseInt(n[1],2);if(n=xn.exec(e))return parseInt(n[1],16);if(n=Dn.exec(e))return parseInt(n[1],8);var t=parseFloat(e);return t==e?t:void 0}(o);return isNaN(u)&&_("Invalid syntax: "+o),a||n||"n"!=i()?f("num",u):f("bigint",o.toLowerCase()+s())}function m(e){var n=s(!0,e);if(n>="0"&&n<="7")return function(e){var n=i();n>="0"&&n<="7"&&(e+=s(!0))[0]<="3"&&(n=i())>="0"&&n<="7"&&(e+=s(!0));if("0"===e)return"\0";e.length>0&&g.has_directive("use strict")&&_("Legacy octal escape sequences are not allowed in strict mode");return String.fromCharCode(parseInt(e,8))}(n);if("u"==n){var t=s(!0,e);if(n+=t,"{"!=t)n+=s(!0,e)+s(!0,e)+s(!0,e);else do{n+=t=s(!0,e)}while("}"!=t)}else"x"==n&&(n+=s(!0,e)+s(!0,e));var r=function(e){switch(e[0]){case"b":return"\b";case"f":return"\f";case"n":return"\n";case"r":return"\r";case"t":return"\t";case"u":var n;if("{"==e[1]&&"}"==e.slice(-1))n=e.slice(2,-1);else{if(5!=e.length)return;n=e.slice(1)}if((t=parseInt(n,16))<0||isNaN(t))return;if(t<65536)return String.fromCharCode(t);if(t>1114111)return;return String.fromCharCode(55232+(t>>10))+String.fromCharCode(56320+(1023&t));case"v":return"\v";case"x":if(3!=e.length)return;var t;if((t=parseInt(e.slice(1),16))<0||isNaN(t))return;return String.fromCharCode(t);case"\r":case"\n":return"";default:if("0"==e)return"\0";if(e[0]>="0"&&e[0]<="9")return;return e}}(n);return"string"!=typeof r&&_("Invalid escape sequence: \\"+n),r}var S=b("Unterminated string constant",function(e){for(var n=s(),t="";;){var r=s(!0,!0);if("\\"==r)r=m(!0);else if(En[r])_("Unterminated string constant");else if(r==n)break;t+=r}var a=f("string",t);return a.quote=e,a});function w(e){var n,t=a.regex_allowed,r=function(){for(var e=a.text,n=a.pos;n<a.text.length;++n)if(En[e[n]])return n;return-1}();return-1==r?(n=a.text.substr(a.pos),a.pos=a.text.length):(n=a.text.substring(a.pos,r),a.pos=r),a.col=a.tokcol+(a.pos-a.tokpos),a.comments_before.push(f(e,n,!0)),a.regex_allowed=t,g}var A=b("Unterminated multiline comment",function(){var e=a.regex_allowed,n=function(e,n){var t=a.text.indexOf(e,a.pos);if(n&&-1==t)throw $n;return t}("*/",!0),t=a.text.substring(a.pos,n).replace(/\r\n|\r|\u2028|\u2029/g,"\n");return u(t.length+2),a.comments_before.push(f("comment2",t,!0)),a.regex_allowed=e,g});function k(){for(var e,n=!1,t=!1,r="#"==i()?s():"";e=i();)if(n)"u"!=e&&_("Expecting UnicodeEscapeSequence -- uXXXX"),Rn(e=m())||_("Unicode char: "+e.charCodeAt(0)+" is not valid in identifier"),r+=e,n=!1;else if("\\"==e)t=n=!0,s();else{if(!Rn(e))break;r+=s()}if(yn[r]&&t){var a=r.charCodeAt(0).toString(16).toUpperCase();r="\\u"+"0000".substr(a.length)+a+r.slice(1)}return r}var y=b("Unterminated regular expression",function(e){for(var n,t=!1,r=!1;n=s(!0);)if(En[n])_("Unexpected line terminator");else if(t)e+="\\"+n,t=!1;else if("["==n)r=!0,e+=n;else if("]"==n&&r)r=!1,e+=n;else{if("/"==n&&!r)break;"\\"==n?t=!0:e+=n}var a=k();try{var o=new RegExp(e,a);return o.raw_source=e,f("regexp",o)}catch(e){_(e.message)}});function h(e){return f("operator",function e(n){if(!i())return n;var t=n+i();return Cn[t]?(s(),e(t)):n}(e||s()))}function T(){switch(s(),i()){case"/":return s(),w("comment1");case"*":return s(),A()}return a.regex_allowed?y(""):h("/")}function b(e,n){return function(t){try{return n(t)}catch(n){if(n!==$n)throw n;_(e)}}}function g(e){if(null!=e)return y(e);for(r&&0==a.pos&&c("#!")&&(l(),u(2),w("comment5"));;){if(p(),l(),t){if(c("\x3c!--")){u(4),w("comment3");continue}if(c("--\x3e")&&a.newline_before){u(3),w("comment4");continue}}var n=i();if(!n)return f("eof");var d=n.charCodeAt(0);switch(d){case 34:case 39:return S(n);case 46:return s(),c("..")?f("operator","."+s()+s()):Un(i().charCodeAt(0))?v("."):f("punc",".");case 47:var m=T();if(m===g)continue;return m}if(Un(d))return v();if(On[n])return f("punc",s());if(c("=>"))return f("punc",s()+s());if(In[n])return h();if(35==d||92==d||!Gn[n])return void 0,A=k(),o?f("name",A):hn[A]?f("atom",A):yn[A]?Cn[A]?f("operator",A):f("keyword",A):f("name",A);break}var A;_("Unexpected character '"+n+"'")}return g.context=function(e){return e&&(a=e),a},g.add_directive=function(e){a.directives[e]=!0},g.push_directives_stack=function(){a.directives=Object.create(a.directives)},g.pop_directives_stack=function(){a.directives=Object.getPrototypeOf(a.directives)},g.has_directive=function(e){return!!a.directives[e]},g}var qn=a("typeof void delete -- ++ ! ~ - +"),Bn=a("-- ++"),zn=a("= += -= /= *= %= **= >>= <<= >>>= &= |= ^= &&= ||= ??="),Kn=function(e,n){for(var t=0;t<e.length;)for(var r=e[t++],a=0;a<r.length;a++)n[r[a]]=t;return n}([["??"],["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],["<",">","<=",">=","in","instanceof"],[">>","<<",">>>"],["+","-"],["*","/","%"],["**"]],{}),Wn=a("atom bigint num regexp string");function Xn(e,n){n=r(n,{bare_returns:!1,expression:!1,filename:null,html5_comments:!0,module:!1,shebang:!0,strict:!1,toplevel:null},!0);var t={input:"string"==typeof e?Yn(e,n.filename,n.html5_comments,n.shebang):e,in_async:!1,in_directives:!0,in_funarg:-1,in_function:0,in_generator:!1,in_loop:0,labels:[],peeked:null,prev:null,token:null};function a(e,n){return Ln(t.token,e,n)}function o(){return t.peeked||(t.peeked=t.input())}function i(){return t.prev=t.token,t.peeked?(t.token=t.peeked,t.peeked=null):t.token=t.input(),t.in_directives=t.in_directives&&("string"==t.token.type||a("punc",";")),t.token}function y(){return t.prev}function T(e,n,r,a){var o=t.input.context();Vn(e,o.filename,null!=n?n:o.tokline,null!=r?r:o.tokcol,null!=a?a:o.tokpos)}function b(e,n){T(n,e.line,e.col)}function g(e,n){return e+(void 0===n?"":" «"+n+"»")}function x(e){null==e&&(e=t.token),b(e,"Unexpected token: "+g(e.type,e.value))}function D(e,n){if(a(e,n))return i();b(t.token,"Unexpected token: "+g(t.token.type,t.token.value)+", expected: "+g(e,n))}function C(e){return D("punc",e)}function E(e){return e.nlb||!u(e.comments_before,function(e){return!e.nlb})}function I(){return!n.strict&&(a("eof")||a("punc","}")||E(t.token))}function U(e){a("punc",";")?i():e||I()||C(";")}function q(){C("(");var e=Qn();return C(")"),e}function W(e){return function(){var n=t.token,r=e.apply(null,arguments),a=y();return r.start=n,r.end=a,r}}function H(){(a("operator","/")||a("operator","/="))&&(t.peeked=null,t.token=t.input(t.token.value.substr(1)))}t.token=i();var J=W(function(e){switch(H(),t.token.type){case"string":var r=t.in_directives,s=Qn();if(r)if(s instanceof Pe){var c=s.start.raw.slice(1,-1);t.input.add_directive(c),s.value=c}else t.in_directives=r=!1;return U(),r?new B(s):new Ie({body:s});case"num":case"bigint":case"regexp":case"operator":case"atom":return ue();case"name":switch(t.token.value){case"async":if(Ln(o(),"keyword","function"))return i(),i(),a("operator","*")?(i(),Ye(AST_AsyncGeneratorDefun)):Ye(AST_AsyncDefun);break;case"await":if(t.in_async)return ue();break;case"export":return e||""===n.module||x(),i(),function(){if(a("operator","*")){var e=t.token,n=e;return i(),a("name","as")&&(i(),ze()||D("name"),n=t.token,i()),D("name","from"),new AST_ExportForeign({aliases:[Xe(n)],keys:[Xe(e)],path:Qe()})}if(a("punc","{")){i();for(var r=[],s=[];ze();){var e=t.token;i(),s.push(e),a("name","as")?(i(),ze()||D("name"),r.push(t.token),i()):r.push(e),a("punc","}")||C(",")}return C("}"),a("name","from")?(i(),new AST_ExportForeign({aliases:r.map(Xe),keys:s.map(Xe),path:Qe()})):(U(),new AST_ExportReferences({properties:s.map(function(e,n){Ln(e,"name")||b(e,"Name expected");var t=Cn($e,e);return t.alias=Xe(r[n]),t})}))}if(a("keyword","default")){i();var u=t.token,c=function(){if(a("name","async")){if(!Ln(o(),"keyword","function"))return;return i(),i(),a("operator","*")?(i(),Ze(AST_AsyncGeneratorDefun,Ye(AST_AsyncGeneratorFunction))):Ze(AST_AsyncDefun,Ye(AST_AsyncFunction))}if(a("keyword"))switch(t.token.value){case"class":return i(),Ze(R,Te(h));case"function":return i(),a("operator","*")?(i(),Ze(AST_GeneratorDefun,Ye(AST_GeneratorFunction))):Ze(M,Ye(ae))}}();return c?(c.start=u,c.end=y()):(H(),c=Qn(),U()),new AST_ExportDefault({body:c})}return new Q({body:nn()})}();case"import":var l=o();if("punc"==l.type&&/^[(.]$/.test(l.value))break;return e||""===n.module||x(),i(),function(){var e,n=null,r=In(Be,!0),s=null;r?(r.key=new Pe({start:r.start,value:"",end:r.end}),(e=a("punc",","))&&i()):e=!a("string");if(e)if(a("operator","*")){var u=t.token;i(),D("name","as"),(n=In(Be)).key=Xe(u)}else{for(C("{"),s=[];ze();){var c;if(Ln(o(),"name","as")){var u=t.token;i(),i(),(c=In(Be)).key=Xe(u)}else(c=In(Be)).key=new Pe({start:c.start,value:c.name,end:c.end});s.push(c),a("punc","}")||C(",")}C("}")}(n||r||s)&&D("name","from");return new se({all:n,default:r,path:Qe(),properties:s})}();case"let":if(Sn()){i();var f=An();return U(),f}break;case"yield":if(t.in_generator)return ue()}return Ln(o(),"punc",":")?function(){var e=In(le);u(t.labels,function(n){return n.name!=e.name})||T("Label "+e.name+" defined twice");C(":"),t.labels.push(e);var n=J();t.labels.pop(),n instanceof ce||e.references.forEach(function(n){n instanceof O&&b(n.label.start,"Continue label `"+e.name+"` must refer to IterationStatement")});return new fe({body:n,label:e})}():ue();case"punc":switch(t.token.value){case"{":return new m({start:t.token,body:rn(),end:y()});case"[":case"(":case"`":return ue();case";":return t.in_directives=!1,i(),new X;default:x()}case"keyword":switch(t.token.value){case"break":return i(),de(S);case"class":return i(),Te(R);case"const":i();f=wn();return U(),f;case"continue":return i(),de(O);case"debugger":return i(),U(),new N;case"do":i();s=Zn(J);D("keyword","while");var p=q();return U(!0),new z({body:s,condition:p});case"while":return i(),new _n({condition:q(),body:Zn(J)});case"for":return i(),function(){var e=a("name","await")&&i();C("(");var n=null;if(e||!a("punc",";")){var t;if(n=a("keyword","const")?(i(),wn(!0)):a("name","let")&&Sn()?(i(),An(!0)):a("keyword","var")?(i(),kn(!0)):Qn(!0),e?(D("name","of"),t=AST_ForAwaitOf):a("operator","in")?(i(),t=te):a("name","of")&&(i(),t=re),t)return n instanceof j?(n.definitions.length>1&&b(n.start,"Only one variable declaration allowed in for..in/of loop"),t!==te&&n.definitions[0].value&&b(n.definitions[0].value.start,"No initializers allowed in for..of loop")):Xn(n)||(n=Hn(n))instanceof V||b(n.start,"Invalid left-hand side in for..in/of loop"),function(e,n){H();var t=Qn();return C(")"),new e({init:n,object:t,body:Zn(J)})}(t,n)}return function(e){C(";");var n=a("punc",";")?null:Qn();C(";");var t=a("punc",")")?null:Qn();return C(")"),new ne({init:e,condition:n,step:t,body:Zn(J)})}(n)}();case"function":return i(),a("operator","*")?(i(),Ye(AST_GeneratorDefun)):Ye(M);case"if":return i(),function(){var e=q(),n=J(),t=null;a("keyword","else")&&(i(),t=J());return new ie({condition:e,body:n,alternative:t})}();case"return":0!=t.in_function||n.bare_returns||T("'return' outside of function"),i();c=null;return a("punc",";")?i():I()||(c=Qn(),U()),new Ce({value:c});case"switch":return i(),new Ne({expression:q(),body:Zn(un)});case"throw":i(),E(t.token)&&T("Illegal newline after 'throw'");c=Qn();return U(),new tn({value:c});case"try":return i(),function(){var e=rn(),n=null,r=null;if(a("keyword","catch")){var o=t.token;i();var s=null;a("punc","(")&&(i(),s=Fn(Ge),C(")")),n=new k({start:o,argname:s,body:rn(),end:y()})}if(a("keyword","finally")){var o=t.token;i(),r=new ee({start:o,body:rn(),end:y()})}n||r||T("Missing catch/finally blocks");return new sn({body:e,bcatch:n,bfinally:r})}();case"var":i();f=kn();return U(),f;case"with":return t.input.has_directive("use strict")&&T("Strict mode may not include a with statement"),i(),new dn({expression:q(),body:J()})}}x()});function ue(){var e=Qn();return U(),new Ie({body:e})}function de(e){var n,r=null;I()||(r=In(pe,!0)),null!=r?((n=find_if(function(e){return e.name==r.name},t.labels))||b(r.start,"Undefined label "+r.name),r.thedef=n):0==t.in_loop&&T(e.TYPE+" not inside a loop or switch"),U();var a=new e({label:r});return n&&n.references.push(a),a}function Se(e,n){if(a("name",e)){var t=o();if(t&&!Ln(t,"operator","=")&&!("punc"==t.type&&/^[(;}]$/.test(t.value)||n&&E(t)))return i()}}function Te(e){var n,r=t.in_async,o=t.in_generator;t.input.push_directives_stack(),t.input.add_directive("use strict"),n=e===R?In(Ve):In(Ue,!0);var s=null;a("keyword","extends")&&(i(),H(),s=hn(!0)),C("{");for(var u=[];!a("punc","}");)if(a("punc",";"))i();else{var c=t.token,l=!!Se("static"),f=Se("async",!0);if(a("operator","*")){i();var p=a("name")&&/^#/.test(t.token.value),_=Dn(),d=t.token,v=Ye(f?AST_AsyncGeneratorFunction:AST_GeneratorFunction);v.start=d,v.end=y(),u.push(new AST_ClassMethod({start:c,static:l,private:p,key:_,value:v,end:y()}))}else if(l&&a("punc","{"))u.push(new AST_ClassInit({start:c,value:new AST_ClassInitBlock({start:c,body:rn(),end:y()}),end:y()}));else{p=a("name")&&/^#/.test(t.token.value),_=Dn();if(a("punc","(")){var m=t.token,S=Ye(f?AST_AsyncFunction:ae);S.start=m,S.end=y(),u.push(new AST_ClassMethod({start:c,static:l,private:p,key:_,value:S,end:y()}))}else{f&&x(f);var w=null;if(a("operator","="))i(),t.in_async=!1,t.in_generator=!1,w=Jn(),t.in_generator=o,t.in_async=r;else if(!a("punc",";")&&!a("punc","}")){var A=null;switch(_){case"get":A=AST_ClassGetter;break;case"set":A=AST_ClassSetter}if(A){u.push(new A({start:c,static:l,private:a("name")&&/^#/.test(t.token.value),key:Dn(),value:gn(),end:y()}));continue}}U(),u.push(new AST_ClassField({start:c,static:l,private:p,key:_,value:w,end:y()}))}}}return i(),t.input.pop_directives_stack(),t.in_generator=o,t.in_async=r,new e({extends:s,name:n,properties:u})}function ge(e){if(e instanceof l){var n=null;return e.elements[e.elements.length-1]instanceof AST_Spread&&(n=ge(e.elements.pop().expression)),new L({start:e.start,elements:e.elements.map(ge),rest:n,end:e.end})}if(e instanceof p)return new AST_DefaultValue({start:e.start,name:ge(e.left),value:e.right,end:e.end});if(e instanceof AST_DefaultValue)return e.name=ge(e.name),e;if(e instanceof L)return e.elements=e.elements.map(ge),e.rest&&(e.rest=ge(e.rest)),e;if(e instanceof Y)return e.properties.forEach(function(e){e.value=ge(e.value)}),e.rest&&(e.rest=ge(e.rest)),e;if(e instanceof oe)return e;if(e instanceof ke){n=null;return e.properties[e.properties.length-1]instanceof AST_Spread&&(n=ge(e.properties.pop().expression)),new Y({start:e.start,properties:e.properties.map(function(e){return e instanceof he||b(e.start,"Invalid destructuring assignment"),new $({start:e.start,key:e.key,value:ge(e.value),end:e.end})}),rest:n,end:e.end})}return e instanceof qe?e:e instanceof He?new qe(e):e instanceof vn?new qe({start:e.start,name:"yield",end:e.end}):void b(e.start,"Invalid arrow parameter")}function Re(e,n,r){var o=t.in_async,i=t.in_generator;t.in_async=r,t.in_generator=!1;var s=t.in_funarg;t.in_funarg=t.in_function;var u,c,l=e.map(ge),p=e.rest||null;p&&(p=ge(p)),t.in_funarg=s,C("=>");var _=t.in_loop,d=t.labels;++t.in_function,t.input.push_directives_stack(),t.in_loop=0,t.labels=[],a("punc","{")?(t.in_directives=!0,u=rn(),c=null):(u=[],H(),c=Jn());var v=t.input.has_directive("use strict");t.input.pop_directives_stack(),--t.in_function,t.in_loop=_,t.labels=d,t.in_generator=i,t.in_async=o;var m=new(r?AST_AsyncArrow:f)({start:n,argnames:l,rest:p,body:u,value:c,end:y()});return v&&m.each_argname(En),m}var Ye=function(e){var r,a=t.in_async,o=t.in_generator;/Defun$/.test(e.TYPE)?(r=In(Le),t.in_async=/^Async/.test(e.TYPE),t.in_generator=/Generator/.test(e.TYPE)):(t.in_async=/^Async/.test(e.TYPE),t.in_generator=/Generator/.test(e.TYPE),r=In(Ke,!0)),!r||e===c||r instanceof Me||x(y()),C("(");var i=t.in_funarg;t.in_funarg=t.in_function;var s=Tn(")",!n.strict,!1,function(){return On(qe)});t.in_funarg=i;var u=t.in_loop,l=t.labels;++t.in_function,t.in_directives=!0,t.input.push_directives_stack(),t.in_loop=0,t.labels=[];var f=rn(),p=t.input.has_directive("use strict");t.input.pop_directives_stack(),--t.in_function,t.in_loop=u,t.labels=l,t.in_generator=o,t.in_async=a;var _=new e({name:r,argnames:s,rest:s.rest||null,body:f});return p&&(r&&En(r),_.each_argname(En)),_};function ze(){return a("name")||a("string")||jn(t.token.value)}function Xe(e){return new Pe({start:e,quote:e.quote,value:e.value,end:e})}function Qe(){var e=t.token;return D("string"),U(),Xe(e)}function Ze(e,n){return n.name&&((n=new e(n)).name=new(e===R?Ve:Le)(n.name)),n}var nn=W(function(){if(a("name"))switch(t.token.value){case"async":return i(),D("keyword","function"),a("operator","*")?(i(),Ye(AST_AsyncGeneratorDefun)):Ye(AST_AsyncDefun);case"let":i();var e=An();return U(),e}else if(a("keyword"))switch(t.token.value){case"class":return i(),Te(R);case"const":i();e=wn();return U(),e;case"function":return i(),a("operator","*")?(i(),Ye(AST_GeneratorDefun)):Ye(M);case"var":i();e=kn();return U(),e}x()});function rn(){C("{");for(var e=[];!a("punc","}");)a("eof")&&C("}"),e.push(J());return i(),e}function un(){C("{");for(var e,n,r,o,s=[];!a("punc","}");)a("eof")&&C("}"),a("keyword","case")?(e&&(e.end=y()),n=[],e=new A({start:(o=t.token,i(),o),expression:Qn(),body:n}),s.push(e),C(":")):a("keyword","default")?(e&&(e.end=y()),r&&T("More than one default clause in switch statement"),n=[],e=new G({start:(o=t.token,i(),C(":"),o),body:n}),s.push(e),r=e):(n||x(),n.push(J()));return e&&(e.end=y()),i(),s}function mn(e,n){for(var r=[];;){var o=t.token,s=Fn(e),u=null;if(a("operator","=")?(i(),u=Jn(n)):!n&&(e===je||s instanceof V)&&T("Missing initializer in declaration"),r.push(new pn({start:o,name:s,value:u,end:y()})),!a("punc",","))break;i()}return r}function Sn(){var e=o();return Ln(e,"name")||Ln(e,"punc","[")||Ln(e,"punc","{")}var wn=function(e){return new F({start:y(),definitions:mn(je,e),end:y()})},An=function(e){return new _e({start:y(),definitions:mn(We,e),end:y()})},kn=function(e){return new fn({start:y(),definitions:mn(Je,e),end:y()})};var hn=function(e){if(a("operator","new"))return function(e){var r,s=t.token;if(D("operator","new"),a("punc",".")&&Ln(o(),"name","target"))i(),i(),r=new me;else{var u,c=hn(!1);a("punc","(")?(i(),u=Tn(")",!n.strict)):u=[],r=new ve({expression:c,args:u})}return r.start=s,r.end=y(),Gn(r,e)}(e);var r=t.token;if(a("punc")){switch(r.value){case"`":return Gn(Nn(null),e);case"(":if(i(),a("punc",")"))return i(),Re([],r);var s=Qn(!1,!0),u=r.comments_before.length;if([].unshift.apply(s.start.comments_before,r.comments_before),r.comments_before.length=0,r.comments_before=s.start.comments_before,r.comments_before_length=u,0==u&&r.comments_before.length>0){var c=r.comments_before[0];c.nlb||(c.nlb=r.nlb,r.nlb=!1)}r.comments_after=s.start.comments_after,s.start=r,C(")");var l=y();return l.comments_before=s.end.comments_before,l.comments_after.forEach(function(e){s.end.comments_after.push(e),e.nlb&&(t.token.nlb=!0)}),l.comments_after.length=0,l.comments_after=s.end.comments_after,s.end=l,a("punc","=>")?Re(s instanceof Ee?s.expressions:[s],r):Gn(s,e);case"[":return Gn(bn(),e);case"{":return Gn(xn(),e)}x()}if(a("keyword"))switch(r.value){case"class":i();var f=Te(h);return f.start=r,f.end=y(),Gn(f,e);case"function":return i(),a("operator","*")?(i(),_=Ye(AST_GeneratorFunction)):_=Ye(ae),_.start=r,_.end=y(),Gn(_,e)}if(a("name")){var p=Cn(He,r);if(i(),"async"==p.name){var _;if(a("keyword","function"))return i(),a("operator","*")?(i(),_=Ye(AST_AsyncGeneratorFunction)):_=Ye(AST_AsyncFunction),_.start=r,_.end=y(),Gn(_,e);if(a("name")&&Ln(o(),"punc","=>"))return r=t.token,p=Cn(He,r),i(),Re([p],r,!0);if(a("punc","(")){var v=Gn(p,e);if(!a("punc","=>"))return v;var m=v.args;return m[m.length-1]instanceof AST_Spread&&(m.rest=m.pop().expression),Re(m,r,!0)}}return a("punc","=>")?Re([p],r):Gn(p,e)}if(Wn[t.token.type])return Gn(function(){var e,n=t.token,r=n.value;switch(n.type){case"num":isFinite(r)?e=new Ae({value:r}):(e=new AST_Infinity,r<0&&(e=new ln({operator:"-",expression:e})));break;case"bigint":e=new d({value:r});break;case"string":e=new Pe({value:r,quote:n.quote});break;case"regexp":e=new De({value:r});break;case"atom":switch(r){case"false":e=new Z;break;case"true":e=new on;break;case"null":e=new we;break;default:x()}break;default:x()}return i(),e.start=e.end=n,e}(),e);x()};function Tn(e,n,r,o){o||(o=Jn);for(var s=!0,u=[];!a("punc",e)&&(s?s=!1:C(","),!n||!a("punc",e));)if(r&&a("punc",","))u.push(new oe({start:t.token,end:t.token}));else if(a("operator","...")){if(o!==Jn){i(),u.rest=o(),u.rest instanceof AST_DefaultValue&&b(u.rest.start,"Invalid rest parameter");break}u.push(new AST_Spread({start:t.token,expression:(i(),o()),end:y()}))}else u.push(o());return C(e),u}var bn=W(function(){return C("["),new l({elements:Tn("]",!n.strict,!0)})}),gn=W(function(){return Ye(c)}),xn=W(function(){C("{");for(var e=!0,r=[];!a("punc","}")&&(e?e=!1:C(","),n.strict||!a("punc","}"));){var s=t.token;if(a("operator","*")){i();var u=Dn(),c=t.token,l=Ye(AST_GeneratorFunction);l.start=c,l.end=y(),r.push(new AST_ObjectMethod({start:s,key:u,value:l,end:y()}))}else if(a("operator","..."))i(),r.push(new AST_Spread({start:s,expression:Jn(),end:y()}));else if(Ln(o(),"operator","=")){var f=In(He);i(),r.push(new he({start:s,key:s.value,value:new p({start:s,left:f,operator:"=",right:Jn(),end:y()}),end:y()}))}else if(Ln(o(),"punc",",")||Ln(o(),"punc","}"))r.push(new he({start:s,key:s.value,value:In(He),end:y()}));else{u=Dn();if(a("punc","(")){var _=t.token;(v=Ye(ae)).start=_,v.end=y(),r.push(new AST_ObjectMethod({start:s,key:u,value:v,end:y()}))}else if(a("punc",":"))i(),r.push(new he({start:s,key:u,value:Jn(),end:y()}));else{if("name"==s.type)switch(u){case"async":var d=a("operator","*")&&i();u=Dn();var v;_=t.token;(v=Ye(d?AST_AsyncGeneratorFunction:AST_AsyncFunction)).start=_,v.end=y(),r.push(new AST_ObjectMethod({start:s,key:u,value:v,end:y()}));continue;case"get":r.push(new ye({start:s,key:Dn(),value:gn(),end:y()}));continue;case"set":r.push(new be({start:s,key:Dn(),value:gn(),end:y()}));continue}x()}}}return i(),new ke({properties:r})});function Dn(){var e=t.token;switch(e.type){case"operator":yn[e.value]||x();case"num":case"string":case"name":case"keyword":case"atom":return i(),""+e.value;case"punc":C("[");var n=Jn();return C("]"),n;default:x()}}function Cn(e,n){var r=n.value;switch(r){case"await":t.in_async&&x(n);break;case"super":e=Oe;break;case"this":e=en;break;case"yield":t.in_generator&&x(n)}return new e({name:""+r,start:n,end:n})}function En(e){"arguments"!=e.name&&"eval"!=e.name&&"let"!=e.name||b(e.start,"Unexpected "+e.name+" in strict mode")}function In(e,n){if(!a("name"))return n||T("Name expected"),null;var r=Cn(e,t.token);return t.input.has_directive("use strict")&&r instanceof Me&&En(r),i(),r}function Fn(e){var r=t.token;if(a("punc","[")){i();var s=Tn("]",!n.strict,!0,function(){return On(e)});return new L({start:r,elements:s,rest:s.rest||null,end:y()})}if(a("punc","{")){i();for(var u=!0,c=[],l=null;!a("punc","}")&&(u?u=!1:C(","),n.strict||!a("punc","}"));){var f=t.token;if(a("punc","[")||Ln(o(),"punc",":")){var p=Dn();C(":"),c.push(new $({start:f,key:p,value:On(e),end:y()}))}else{if(a("operator","...")){i(),l=Fn(e);break}var _=In(e);a("operator","=")&&(i(),_=new AST_DefaultValue({start:_.start,name:_,value:Jn(),end:y()})),c.push(new $({start:f,key:f.value,value:_,end:y()}))}}return C("}"),new Y({start:r,properties:c,rest:l,end:y()})}return In(e)}function On(e){var n=t.token,r=Fn(e);return a("operator","=")?(i(),new AST_DefaultValue({start:n,name:r,value:Jn(),end:y()})):r}function Nn(e){for(var n=e?e.start:t.token,r=t.input.context().read_template,o=[],s=[];r(o);)i(),s.push(Qn()),a("punc","}")||x();return i(),new AST_Template({start:n,expressions:s,strings:o,tag:e,end:y()})}function Gn(e,r){for(var u,c=e.start,l=null;;)if(a("operator","?")&&Ln(o(),"punc",".")&&(i(),i(),l=e),a("punc","[")){i();var f=Qn();C("]"),e=new Fe({start:c,optional:l===e,expression:e,property:f,end:y()})}else if(r&&a("punc","("))i(),e=new w({start:c,optional:l===e,expression:e,args:Tn(")",!n.strict),end:y()});else if(l===e||a("punc","."))l!==e&&i(),e=new K({start:c,optional:l===e,expression:e,property:(void 0,u=t.token.value,D("name"),u),end:y()});else{if(!a("punc","`"))break;l&&T("Invalid template on optional chain"),e=Nn(e)}if(l&&(e.terminal=!0),e instanceof w&&!e.pure)for(var p=(c=e.start).comments_before,_=s(c,"comments_before_length")?c.comments_before_length:p.length;--_>=0;)if(/[@#]__PURE__/.test(p[_].value)){e.pure=!0;break}return e}function Un(e){var n=t.token;if(t.in_async&&a("name","await"))return t.in_funarg===t.in_function&&T("Invalid use of await in function argument"),t.input.context().regex_allowed=!0,i(),new _({start:n,expression:Un(e),end:y()});if(t.in_generator&&a("name","yield")){t.in_funarg===t.in_function&&T("Invalid use of yield in function argument"),t.input.context().regex_allowed=!0,i();var r=null,o=!1;return a("operator","*")?(i(),r=Jn(e),o=!0):(a("punc")?Pn[t.token.value]:I())||(r=Jn(e)),new vn({start:n,expression:r,nested:o,end:y()})}if(a("operator")&&qn[n.value]){i(),H();var s=Rn(ln,n,Un(e));return s.start=n,s.end=y(),s}for(var u=hn(!0);a("operator")&&Bn[t.token.value]&&!E(t.token);)(u=Rn(cn,t.token,u)).start=n,u.end=t.token,i();return u}function Rn(e,n,r){var a=n.value;switch(a){case"++":case"--":Xn(r)||b(n,"Invalid use of "+a+" operator");break;case"delete":r instanceof He&&t.input.has_directive("use strict")&&b(r.start,"Calling delete on expression not allowed in strict mode")}return new e({operator:a,expression:r})}var Mn=function(e,n,r){var o=a("operator")?t.token.value:null;"in"==o&&r&&(o=null);var s=null!=o?Kn[o]:null;if(null!=s&&s>n){i();var u=Mn(Un(r),"**"==o?s-1:s,r);return Mn(new v({start:e.start,left:e,operator:o,right:u,end:u.end}),n,r)}return e};var $n=function(e){var n=t.token,r=function(e){return Mn(Un(e),0,e)}(e);if(a("operator","?")){i();var o=Jn();return C(":"),new P({start:n,condition:r,consequent:o,alternative:Jn(e),end:y()})}return r};function Xn(e){return e instanceof xe&&!e.optional||e instanceof He}function Hn(e){if(e instanceof l){var n=null;if(e.elements[e.elements.length-1]instanceof AST_Spread&&!((n=Hn(e.elements.pop().expression))instanceof V||Xn(n)))return e;var t=e.elements.map(Hn);return u(t,function(e){return e instanceof AST_DefaultValue||e instanceof V||e instanceof oe||Xn(e)})?new L({start:e.start,elements:t,rest:n,end:e.end}):e}if(e instanceof p){var r=Hn(e.left);return r instanceof V||Xn(r)?new AST_DefaultValue({start:e.start,name:r,value:e.right,end:e.end}):e}if(!(e instanceof ke))return e;n=null;if(e.properties[e.properties.length-1]instanceof AST_Spread&&!((n=Hn(e.properties.pop().expression))instanceof V||Xn(n)))return e;for(var a=[],o=0;o<e.properties.length;o++){var i=e.properties[o];if(!(i instanceof he))return e;var s=Hn(i.value);if(!(s instanceof AST_DefaultValue||s instanceof V||Xn(s)))return e;a.push(new $({start:i.start,key:i.key,value:s,end:i.end}))}return new Y({start:e.start,properties:a,rest:n,end:e.end})}function Jn(e){var n=t.token,r=$n(e),o=t.token.value;if(a("operator")&&zn[o]){if(Xn(r)||"="==o&&(r=Hn(r))instanceof V)return i(),new p({start:n,left:r,operator:o,right:Jn(e),end:y()});T("Invalid assignment")}return r}function Qn(e,n){for(var r=t.token,s=[];;){if(n&&a("operator","...")){i(),s.rest=Fn(qe);break}if(s.push(Jn(e)),!a("punc",","))break;if(i(),n&&a("punc",")")&&Ln(o(),"punc","=>"))break}return 1!=s.length||s.rest?new Ee({start:r,expressions:s,end:y()}):s[0]}function Zn(e){++t.in_loop;var n=e();return--t.in_loop,n}if(n.expression){H();var et=Qn();return D("eof"),et}return function(){var e=t.token,r=[];for(n.module&&(t.in_async=!0,t.input.add_directive("use strict")),t.input.push_directives_stack();!a("eof");)r.push(J(!0));t.input.pop_directives_stack();var o=y()||e,i=n.toplevel;return i?(i.body=i.body.concat(r),i.end=o):i=new an({start:e,body:r,end:o}),i}()}return n.parse=Xn,{is_identifier_string:jn,is_identifier_char:Rn,is_surrogate_pair_head:function(e){return e>=55296&&e<=56319},is_surrogate_pair_tail:function(e){return e>=56320&&e<=57343},tokenizer:Yn,parse:Xn,KEYWORDS:yn,RESERVED_WORDS:Tn,KEYWORDS_BEFORE_EXPRESSION:bn,KEYWORDS_ATOM:hn}});
//# sourceMappingURL=sourcemaps/parse.js.map
