/**
 * skylark-uglifyjs - A version of uglifyjs that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./utils","./ast"],function(e,n){"use strict";const{characters:t,defaults:r,find_if:a,makePredicate:o,set_annotation:i,configure_error_stack:s,HOP:u,all:c}=e,{AST_Accessor:l,AST_Array:f,AST_Arrow:p,AST_Assign:d,AST_AsyncFunction:v,AST_AsyncDefun:_,AST_AsyncArrow:m,AST_AsyncGeneratorFunction:w,AST_AsyncGeneratorDefun:k,AST_Await:S,AST_BigInt:h,AST_Binary:y,AST_BlockStatement:b,AST_Break:A,AST_Call:g,AST_Case:T,AST_Catch:x,AST_Chain:E,AST_ClassExpression:C,AST_ClassGetter:I,AST_ClassInit:D,AST_ClassMethod:P,AST_ClassPrivateProperty:O,AST_ClassProperty:N,AST_ClassStaticBlock:F,AST_ClassSetter:R,AST_ConciseMethod:U,AST_PrivateIn:G,AST_PrivateGetter:j,AST_PrivateMethod:L,AST_PrivateSetter:$,AST_Conditional:M,AST_Const:Y,AST_Continue:q,AST_Debugger:B,AST_Default:V,AST_DefaultAssign:X,AST_DefaultValue:z,AST_DefClass:K,AST_Definitions:W,AST_Defun:H,AST_Destructured:J,AST_DestructuredArray:Q,AST_DestructuredKeyVal:Z,AST_DestructuredObject:ee,AST_Destructuring:ne,AST_Directive:te,AST_Do:re,AST_Dot:ae,AST_DotHash:oe,AST_EmptyStatement:ie,AST_Expansion:se,AST_Export:ue,AST_ExportDeclaration:ce,AST_False:le,AST_Finally:fe,AST_For:pe,AST_ForIn:de,AST_ForOf:ve,AST_Function:_e,AST_Hole:me,AST_If:we,AST_Import:ke,AST_ImportMeta:Se,AST_IterationStatement:he,AST_Label:ye,AST_LabeledStatement:be,AST_LabelRef:Ae,AST_Let:ge,AST_NameMapping:Te,AST_New:xe,AST_NewTarget:Ee,AST_Node:Ce,AST_Null:Ie,AST_Number:De,AST_Object:Pe,AST_ObjectGetter:Oe,AST_ObjectKeyVal:Ne,AST_ObjectMethod:Fe,AST_ObjectProperty:Re,AST_ObjectSetter:Ue,AST_PrefixedTemplateString:Ge,AST_PropAccess:je,AST_RegExp:Le,AST_Return:$e,AST_Sequence:Me,AST_SimpleStatement:Ye,AST_Spread:qe,AST_String:Be,AST_Sub:Ve,AST_Super:Xe,AST_Switch:ze,AST_SymbolCatch:Ke,AST_SymbolClass:We,AST_SymbolClassProperty:He,AST_SymbolConst:Je,AST_SymbolDeclaration:Qe,AST_SymbolDefClass:Ze,AST_SymbolDefun:en,AST_SymbolExport:nn,AST_SymbolExportForeign:tn,AST_SymbolFunarg:rn,AST_SymbolImport:an,AST_SymbolImportForeign:on,AST_SymbolLambda:sn,AST_SymbolLet:un,AST_SymbolMethod:cn,AST_SymbolRef:ln,AST_SymbolVar:fn,AST_Template:pn,AST_TemplateSegment:dn,AST_TemplateString:vn,AST_This:_n,AST_SymbolPrivateProperty:mn,AST_Throw:wn,AST_Token:kn,AST_Toplevel:Sn,AST_True:hn,AST_Try:yn,AST_TryBlock:bn,AST_UnaryPostfix:An,AST_UnaryPrefix:gn,AST_Var:Tn,AST_VarDef:xn,AST_While:En,AST_With:Cn,AST_Yield:In,_INLINE:Dn,_NOINLINE:Pn,_PURE:On,_KEY:Nn,_MANGLEPROP:Fn}=n;var Rn="break case catch class const continue debugger default delete do else extends finally for function if in instanceof new return switch throw try typeof var void while with",Un="false null true",Gn=["abstract async await boolean byte char double enum export final float goto implements import int interface let long native package private protected public short static super synchronized this throws transient volatile yield",Un,Rn].join(" "),jn="return new delete throw else case";Rn=o(Rn),Gn=o(Gn),jn=o(jn),Un=o(Un);var Ln=/^0b([01]+)$/i,$n=/^0x([0-9a-f]+)$/i,Mn=/^0o?([0-7]+)$/i,Yn=o(["in","instanceof","typeof","new","void","delete","++","--","+","-","!","~","&","|","^","*","/","%","**",">>","<<",">>>","<",">","<=",">=","==","===","!=","!==","?","=","+=","-=","/=","*=","%=","**=",">>=","<<=",">>>=","&=","|=","^=","&&","||","??","&&=","||=","??="]),qn="\n\r\u2028\u2029",Bn="+-*&%=<>!?|~^",Vn=",;:)}]",Xn="[{(,;:",zn=Xn+"`)}]",Kn=qn+"  \t\f\v​             　\ufeff",Wn=o(t("./'\"#"+Bn+zn+Kn));function Hn(e){return e>=48&&e<=57}function Jn(e){return!Wn[e]}function Qn(e){return/^[a-z_$][a-z0-9_$]*$/i.test(e)}function Zn(e){switch(e[0]){case"b":return"\b";case"f":return"\f";case"n":return"\n";case"r":return"\r";case"t":return"\t";case"u":var n;if("{"==e[1]&&"}"==e.slice(-1))n=e.slice(2,-1);else{if(5!=e.length)return;n=e.slice(1)}if((t=parseInt(n,16))<0||isNaN(t))return;if(t<65536)return String.fromCharCode(t);if(t>1114111)return;return String.fromCharCode(55232+(t>>10))+String.fromCharCode(56320+(1023&t));case"v":return"\v";case"x":if(3!=e.length)return;var t;if((t=parseInt(e.slice(1),16))<0||isNaN(t))return;return String.fromCharCode(t);case"\r":case"\n":return"";default:if("0"==e)return"\0";if(e[0]>="0"&&e[0]<="9")return;return e}}function et(e,n,t,r,a){this.message=e,this.filename=n,this.line=t,this.col=r,this.pos=a}function nt(e,n,t,r,a){throw new et(e,n,t,r,a)}function tt(e,n,t){return e.type==n&&(null==t||e.value==t)}qn=o(t(qn)),Bn=o(t(Bn)),Vn=o(t(Vn)),Xn=o(t(Xn)),zn=o(t(zn)),Kn=o(t(Kn)),et.prototype=Object.create(Error.prototype),et.prototype.constructor=et,et.prototype.name="SyntaxError",s(et);var rt={};function at(e,n,t,r){var a={text:e,filename:n,pos:0,tokpos:0,line:1,tokline:0,col:0,tokcol:0,newline_before:!1,regex_allowed:!1,comments_before:[],directives:Object.create(null),read_template:g("Unterminated template literal",function(e){for(var n="";;){var t=r();switch(t){case"\\":t+=r();break;case"`":return void e.push(n);case"$":if("{"==i())return s(),e.push(n),a.regex_allowed=!0,!0}n+=t}function r(){var e=s(!0,!0);return"\r"==e?"\n":e}})},o=!1;function i(){return a.text.charAt(a.pos)}function s(e,n){var t=a.text.charAt(a.pos++);if(e&&!t)throw rt;return qn[t]?(a.col=0,a.line++,n||(a.newline_before=!0),"\r"==t&&"\n"==i()&&(a.pos++,t="\n")):a.col++,t}function u(e){for(;e-- >0;)s()}function c(e){return a.text.substr(a.pos,e.length)==e}function l(){a.tokline=a.line,a.tokcol=a.col,a.tokpos=a.pos}function f(t,r,i){a.regex_allowed="operator"==t&&!it[r]||"keyword"==t&&jn[r]||"punc"==t&&Xn[r],"punc"==t&&"."==r?o=!0:i||(o=!1);var s={type:t,value:r,line:a.tokline,col:a.tokcol,pos:a.tokpos,endline:a.line,endcol:a.col,endpos:a.pos,nlb:a.newline_before,file:n};return/^(?:num|string|regexp)$/i.test(t)&&(s.raw=e.substring(s.pos,s.endpos)),i||(s.comments_before=a.comments_before,s.comments_after=a.comments_before=[]),a.newline_before=!1,new kn(s)}function p(){for(;Kn[i()];)s()}function d(e){nt(e,n,a.tokline,a.tokcol,a.tokpos)}function v(e){return/^0[0-7_]+$/.test(e)}function _(e){var n=!1,t=!1,r=!1,a="."==e,o=function(e){for(var n,t="";(n=i())&&e(n,t);)t+=s();return t}(function(e,o){switch(e){case"x":case"X":return!r&&(r=!0);case"e":case"E":return!!r||!n&&(n=t=!0);case"+":case"-":return t;case t=!1,".":return!(a||n||r||v(o))&&(a=!0)}return/[_0-9a-dfo]/i.test(e)});e&&(o=e+o),v(o)?T.has_directive("use strict")&&d("Legacy octal literals are not allowed in strict mode"):o=o.replace(r?/([1-9a-f]|.0)_(?=[0-9a-f])/gi:/([1-9]|.0)_(?=[0-9])/gi,"$1");var u=function(e){var n;if(n=Ln.exec(e))return parseInt(n[1],2);if(n=$n.exec(e))return parseInt(n[1],16);if(n=Mn.exec(e))return parseInt(n[1],8);var t=parseFloat(e);return t==e?t:void 0}(o);return isNaN(u)&&d("Invalid syntax: "+o),a||n||"n"!=i()?f("num",u):f("bigint",o.toLowerCase()+s())}function m(e){var n=s(!0,e);if(n>="0"&&n<="7")return function(e){var n=i();n>="0"&&n<="7"&&(e+=s(!0))[0]<="3"&&(n=i())>="0"&&n<="7"&&(e+=s(!0));if("0"===e)return"\0";e.length>0&&T.has_directive("use strict")&&d("Legacy octal escape sequences are not allowed in strict mode");return String.fromCharCode(parseInt(e,8))}(n);if("u"==n){var t=s(!0,e);if(n+=t,"{"!=t)n+=s(!0,e)+s(!0,e)+s(!0,e);else do{n+=t=s(!0,e)}while("}"!=t)}else"x"==n&&(n+=s(!0,e)+s(!0,e));var r=Zn(n);return"string"!=typeof r&&d("Invalid escape sequence: \\"+n),r}var w=g("Unterminated string constant",function(e){for(var n=s(),t="";;){var r=s(!0,!0);if("\\"==r)r=m(!0);else if(qn[r])d("Unterminated string constant");else if(r==n)break;t+=r}var a=f("string",t);return a.quote=e,a});function k(e){var n,t=a.regex_allowed,r=function(){for(var e=a.text,n=a.pos;n<a.text.length;++n)if(qn[e[n]])return n;return-1}();return-1==r?(n=a.text.substr(a.pos),a.pos=a.text.length):(n=a.text.substring(a.pos,r),a.pos=r),a.col=a.tokcol+(a.pos-a.tokpos),a.comments_before.push(f(e,n,!0)),a.regex_allowed=t,T}var S=g("Unterminated multiline comment",function(){var e=a.regex_allowed,n=function(e,n){var t=a.text.indexOf(e,a.pos);if(n&&-1==t)throw rt;return t}("*/",!0),t=a.text.substring(a.pos,n).replace(/\r\n|\r|\u2028|\u2029/g,"\n");return u(t.length+2),a.comments_before.push(f("comment2",t,!0)),a.regex_allowed=e,T});function h(){for(var e,n=!1,t=!1,r="#"==i()?s():"";e=i();)if(n)"u"!=e&&d("Expecting UnicodeEscapeSequence -- uXXXX"),Jn(e=m())||d("Unicode char: "+e.charCodeAt(0)+" is not valid in identifier"),r+=e,n=!1;else if("\\"==e)t=n=!0,s();else{if(!Jn(e))break;r+=s()}if(Rn[r]&&t){var a=r.charCodeAt(0).toString(16).toUpperCase();r="\\u"+"0000".substr(a.length)+a+r.slice(1)}return r}var y=g("Unterminated regular expression",function(e){for(var n,t=!1,r=!1;n=s(!0);)if(qn[n])d("Unexpected line terminator");else if(t)e+="\\"+n,t=!1;else if("["==n)r=!0,e+=n;else if("]"==n&&r)r=!1,e+=n;else{if("/"==n&&!r)break;"\\"==n?t=!0:e+=n}var a=h();try{var o=new RegExp(e,a);return o.raw_source=e,f("regexp",o)}catch(e){d(e.message)}});function b(e){return f("operator",function e(n){if(!i())return n;var t=n+i();return Yn[t]?(s(),e(t)):n}(e||s()))}function A(){switch(s(),i()){case"/":return s(),k("comment1");case"*":return s(),S()}return a.regex_allowed?y(""):b("/")}function g(e,n){return function(t){try{return n(t)}catch(n){if(n!==rt)throw n;d(e)}}}function T(e){if(null!=e)return y(e);for(r&&0==a.pos&&c("#!")&&(l(),u(2),k("comment5"));;){if(p(),l(),t){if(c("\x3c!--")){u(4),k("comment3");continue}if(c("--\x3e")&&a.newline_before){u(3),k("comment4");continue}}var n=i();if(!n)return f("eof");var v=n.charCodeAt(0);switch(v){case 34:case 39:return w(n);case 46:return s(),c("..")?f("operator","."+s()+s()):Hn(i().charCodeAt(0))?_("."):f("punc",".");case 47:var m=A();if(m===T)continue;return m}if(Hn(v))return _();if(zn[n])return f("punc",s());if(c("=>"))return f("punc",s()+s());if(Bn[n])return b();if(35==v||92==v||!Wn[n])return void 0,S=h(),o?f("name",S):Un[S]?f("atom",S):Rn[S]?Yn[S]?f("operator",S):f("keyword",S):f("name",S);break}var S;d("Unexpected character '"+n+"'")}return T.context=function(e){return e&&(a=e),a},T.add_directive=function(e){a.directives[e]=!0},T.push_directives_stack=function(){a.directives=Object.create(a.directives)},T.pop_directives_stack=function(){a.directives=Object.getPrototypeOf(a.directives)},T.has_directive=function(e){return!!a.directives[e]},T}var ot=o("typeof void delete -- ++ ! ~ - +"),it=o("-- ++"),st=o("= += -= /= *= %= **= >>= <<= >>>= &= |= ^= &&= ||= ??="),ut=function(e,n){for(var t=0;t<e.length;)for(var r=e[t++],a=0;a<r.length;a++)n[r[a]]=t;return n}([["??"],["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],["<",">","<=",">=","in","instanceof"],[">>","<<",">>>"],["+","-"],["*","/","%"],["**"]],{}),ct=o("atom bigint num regexp string");function lt(e,n){n=r(n,{bare_returns:!1,expression:!1,filename:null,html5_comments:!0,module:!1,shebang:!0,strict:!1,toplevel:null},!0);var t={input:"string"==typeof e?at(e,n.filename,n.html5_comments,n.shebang):e,in_async:!1,in_directives:!0,in_funarg:-1,in_function:0,in_generator:!1,in_loop:0,labels:[],peeked:null,prev:null,token:null};function o(e,n){return tt(t.token,e,n)}function i(){return t.peeked||(t.peeked=t.input())}function s(){return t.prev=t.token,t.peeked?(t.token=t.peeked,t.peeked=null):t.token=t.input(),t.in_directives=t.in_directives&&("string"==t.token.type||o("punc",";")),t.token}function E(){return t.prev}function O(e,n,r,a){var o=t.input.context();nt(e,o.filename,null!=n?n:o.tokline,null!=r?r:o.tokcol,null!=a?a:o.tokpos)}function N(e,n){O(n,e.line,e.col)}function F(e,n){return e+(void 0===n?"":" «"+n+"»")}function U(e){null==e&&(e=t.token),N(e,"Unexpected token: "+F(e.type,e.value))}function G(e,n){if(o(e,n))return s();N(t.token,"Unexpected token: "+F(t.token.type,t.token.value)+", expected: "+F(e,n))}function j(e){return G("punc",e)}function L(e){return e.nlb||!c(e.comments_before,function(e){return!e.nlb})}function $(){return!n.strict&&(o("eof")||o("punc","}")||L(t.token))}function X(e){o("punc",";")?s():e||$()||j(";")}function ne(){j("(");var e=pt();return j(")"),e}function oe(e){return function(){var n=t.token,r=e.apply(null,arguments),a=E();return r.start=n,r.end=a,r}}function se(){(o("operator","/")||o("operator","/="))&&(t.peeked=null,t.token=t.input(t.token.value.substr(1)))}t.token=s();var ue=oe(function(e){switch(se(),t.token.type){case"string":var r=t.in_directives,a=pt();if(r)if(a instanceof Be){var u=a.start.raw.slice(1,-1);t.input.add_directive(u),a.value=u}else t.in_directives=r=!1;return X(),r?new te(a):new Ye({body:a});case"num":case"bigint":case"regexp":case"operator":case"atom":return Se();case"name":switch(t.token.value){case"async":if(tt(i(),"keyword","function"))return s(),s(),o("operator","*")?(s(),tn(k)):tn(_);break;case"await":if(t.in_async)return Se();break;case"export":return e||""===n.module||U(),s(),function(){if(o("operator","*")){var e=t.token,n=e;return s(),o("name","as")&&(s(),on()||G("name"),n=t.token,s()),G("name","from"),new AST_ExportForeign({aliases:[cn(n)],keys:[cn(e)],path:dn()})}if(o("punc","{")){s();for(var r=[],a=[];on();){var e=t.token;s(),a.push(e),o("name","as")?(s(),on()||G("name"),r.push(t.token),s()):r.push(e),o("punc","}")||j(",")}return j("}"),o("name","from")?(s(),new AST_ExportForeign({aliases:r.map(cn),keys:a.map(cn),path:dn()})):(X(),new AST_ExportReferences({properties:a.map(function(e,n){tt(e,"name")||N(e,"Name expected");var t=Yn(nn,e);return t.alias=cn(r[n]),t})}))}if(o("keyword","default")){s();var u=t.token,c=function(){if(o("name","async")){if(!tt(i(),"keyword","function"))return;return s(),s(),o("operator","*")?(s(),vn(k,tn(w))):vn(_,tn(v))}if(o("keyword"))switch(t.token.value){case"class":return s(),vn(K,Re(C));case"function":return s(),o("operator","*")?(s(),vn(AST_GeneratorDefun,tn(AST_GeneratorFunction))):vn(H,tn(_e))}}();return c?(c.start=u,c.end=E()):(se(),c=pt(),X()),new AST_ExportDefault({body:c})}return new ce({body:mn()})}();case"import":var l=i();if("punc"==l.type&&/^[(.]$/.test(l.value))break;return e||""===n.module||U(),s(),function(){var e,n=null,r=Bn(an,!0),a=null;r?(r.key=new Be({start:r.start,value:"",end:r.end}),(e=o("punc",","))&&s()):e=!o("string");if(e)if(o("operator","*")){var u=t.token;s(),G("name","as"),(n=Bn(an)).key=cn(u)}else{for(j("{"),a=[];on();){var c;if(tt(i(),"name","as")){var u=t.token;s(),s(),(c=Bn(an)).key=cn(u)}else(c=Bn(an)).key=new Be({start:c.start,value:c.name,end:c.end});a.push(c),o("punc","}")||j(",")}j("}")}(n||r||a)&&G("name","from");return new ke({all:n,default:r,path:dn(),properties:a})}();case"let":if(Pn()){s();var f=Nn();return X(),f}break;case"yield":if(t.in_generator)return Se()}return tt(i(),"punc",":")?function(){var e=Bn(ye);c(t.labels,function(n){return n.name!=e.name})||O("Label "+e.name+" defined twice");j(":"),t.labels.push(e);var n=ue();t.labels.pop(),n instanceof he||e.references.forEach(function(n){n instanceof q&&N(n.label.start,"Continue label `"+e.name+"` must refer to IterationStatement")});return new be({body:n,label:e})}():Se();case"punc":switch(t.token.value){case"{":return new b({start:t.token,body:kn(),end:E()});case"[":case"(":case"`":return Se();case";":return t.in_directives=!1,s(),new ie;default:U()}case"keyword":switch(t.token.value){case"break":return s(),Te(A);case"class":return s(),Re(K);case"const":s();f=On();return X(),f;case"continue":return s(),Te(q);case"debugger":return s(),X(),new B;case"do":s();a=dt(ue);G("keyword","while");var p=ne();return X(!0),new re({body:a,condition:p});case"while":return s(),new En({condition:ne(),body:dt(ue)});case"for":return s(),function(){var e=o("name","await")&&s();j("(");var n=null;if(e||!o("punc",";")){var t;if(n=o("keyword","const")?(s(),On(!0)):o("name","let")&&Pn()?(s(),Nn(!0)):o("keyword","var")?(s(),Fn(!0)):pt(!0),e?(G("name","of"),t=AST_ForAwaitOf):o("operator","in")?(s(),t=de):o("name","of")&&(s(),t=ve),t)return n instanceof W?(n.definitions.length>1&&N(n.start,"Only one variable declaration allowed in for..in/of loop"),t!==de&&n.definitions[0].value&&N(n.definitions[0].value.start,"No initializers allowed in for..of loop")):rt(n)||(n=lt(n))instanceof J||N(n.start,"Invalid left-hand side in for..in/of loop"),function(e,n){se();var t=pt();return j(")"),new e({init:n,object:t,body:dt(ue)})}(t,n)}return function(e){j(";");var n=o("punc",";")?null:pt();j(";");var t=o("punc",")")?null:pt();return j(")"),new pe({init:e,condition:n,step:t,body:dt(ue)})}(n)}();case"function":return s(),o("operator","*")?(s(),tn(AST_GeneratorDefun)):tn(H);case"if":return s(),function(){var e=ne(),n=ue(),t=null;o("keyword","else")&&(s(),t=ue());return new we({condition:e,body:n,alternative:t})}();case"return":0!=t.in_function||n.bare_returns||O("'return' outside of function"),s();u=null;return o("punc",";")?s():$()||(u=pt(),X()),new $e({value:u});case"switch":return s(),new ze({expression:ne(),body:dt(bn)});case"throw":s(),L(t.token)&&O("Illegal newline after 'throw'");u=pt();return X(),new wn({value:u});case"try":return s(),function(){var e=kn(),n=null,r=null;if(o("keyword","catch")){var a=t.token;s();var i=null;o("punc","(")&&(s(),i=Xn(Ke),j(")")),n=new x({start:a,argname:i,body:kn(),end:E()})}if(o("keyword","finally")){var a=t.token;s(),r=new fe({start:a,body:kn(),end:E()})}n||r||O("Missing catch/finally blocks");return new yn({body:e,bcatch:n,bfinally:r})}();case"var":s();f=Fn();return X(),f;case"with":return t.input.has_directive("use strict")&&O("Strict mode may not include a with statement"),s(),new Cn({expression:ne(),body:ue()})}}U()});function Se(){var e=pt();return X(),new Ye({body:e})}function Te(e){var n,r=null;$()||(r=Bn(Ae,!0)),null!=r?((n=a(function(e){return e.name==r.name},t.labels))||N(r.start,"Undefined label "+r.name),r.thedef=n):0==t.in_loop&&O(e.TYPE+" not inside a loop or switch"),X();var o=new e({label:r});return n&&n.references.push(o),o}function Ce(e,n){if(o("name",e)){var t=i();if(t&&!tt(t,"operator","=")&&!("punc"==t.type&&/^[(;}]$/.test(t.value)||n&&L(t)))return s()}}function Re(e){var n,r=t.in_async,a=t.in_generator;t.input.push_directives_stack(),t.input.add_directive("use strict"),n=e===K?Bn(Ze):Bn(We,!0);var i=null;o("keyword","extends")&&(s(),se(),i=Un(!0)),j("{");for(var u=[];!o("punc","}");)if(o("punc",";"))s();else{var c=t.token,l=!!Ce("static"),f=Ce("async",!0);if(o("operator","*")){s();var p=o("name")&&/^#/.test(t.token.value),d=Mn(),_=t.token,m=tn(f?w:AST_GeneratorFunction);m.start=_,m.end=E(),u.push(new P({start:c,static:l,private:p,key:d,value:m,end:E()}))}else if(l&&o("punc","{"))u.push(new D({start:c,value:new AST_ClassInitBlock({start:c,body:kn(),end:E()}),end:E()}));else{p=o("name")&&/^#/.test(t.token.value),d=Mn();if(o("punc","(")){var k=t.token,S=tn(f?v:_e);S.start=k,S.end=E(),u.push(new P({start:c,static:l,private:p,key:d,value:S,end:E()}))}else{f&&U(f);var h=null;if(o("operator","="))s(),t.in_async=!1,t.in_generator=!1,h=ft(),t.in_generator=a,t.in_async=r;else if(!o("punc",";")&&!o("punc","}")){var y=null;switch(d){case"get":y=I;break;case"set":y=R}if(y){u.push(new y({start:c,static:l,private:o("name")&&/^#/.test(t.token.value),key:Mn(),value:Ln(),end:E()}));continue}}X(),u.push(new AST_ClassField({start:c,static:l,private:p,key:d,value:h,end:E()}))}}}return s(),t.input.pop_directives_stack(),t.in_generator=a,t.in_async=r,new e({extends:i,name:n,properties:u})}function Ge(e){if(e instanceof f){var n=null;return e.elements[e.elements.length-1]instanceof qe&&(n=Ge(e.elements.pop().expression)),new Q({start:e.start,elements:e.elements.map(Ge),rest:n,end:e.end})}if(e instanceof d)return new z({start:e.start,name:Ge(e.left),value:e.right,end:e.end});if(e instanceof z)return e.name=Ge(e.name),e;if(e instanceof Q)return e.elements=e.elements.map(Ge),e.rest&&(e.rest=Ge(e.rest)),e;if(e instanceof ee)return e.properties.forEach(function(e){e.value=Ge(e.value)}),e.rest&&(e.rest=Ge(e.rest)),e;if(e instanceof me)return e;if(e instanceof Pe){n=null;return e.properties[e.properties.length-1]instanceof qe&&(n=Ge(e.properties.pop().expression)),new ee({start:e.start,properties:e.properties.map(function(e){return e instanceof Ne||N(e.start,"Invalid destructuring assignment"),new Z({start:e.start,key:e.key,value:Ge(e.value),end:e.end})}),rest:n,end:e.end})}return e instanceof rn?e:e instanceof ln?new rn(e):e instanceof In?new rn({start:e.start,name:"yield",end:e.end}):void N(e.start,"Invalid arrow parameter")}function He(e,n,r){var a=t.in_async,i=t.in_generator;t.in_async=r,t.in_generator=!1;var s=t.in_funarg;t.in_funarg=t.in_function;var u,c,l=e.map(Ge),f=e.rest||null;f&&(f=Ge(f)),t.in_funarg=s,j("=>");var d=t.in_loop,v=t.labels;++t.in_function,t.input.push_directives_stack(),t.in_loop=0,t.labels=[],o("punc","{")?(t.in_directives=!0,u=kn(),c=null):(u=[],se(),c=ft());var _=t.input.has_directive("use strict");t.input.pop_directives_stack(),--t.in_function,t.in_loop=d,t.labels=v,t.in_generator=i,t.in_async=a;var w=new(r?m:p)({start:n,argnames:l,rest:f,body:u,value:c,end:E()});return _&&w.each_argname(qn),w}var tn=function(e){var r,a=t.in_async,o=t.in_generator;/Defun$/.test(e.TYPE)?(r=Bn(en),t.in_async=/^Async/.test(e.TYPE),t.in_generator=/Generator/.test(e.TYPE)):(t.in_async=/^Async/.test(e.TYPE),t.in_generator=/Generator/.test(e.TYPE),r=Bn(sn,!0)),!r||e===l||r instanceof Qe||U(E()),j("(");var i=t.in_funarg;t.in_funarg=t.in_function;var s=Gn(")",!n.strict,!1,function(){return zn(rn)});t.in_funarg=i;var u=t.in_loop,c=t.labels;++t.in_function,t.in_directives=!0,t.input.push_directives_stack(),t.in_loop=0,t.labels=[];var f=kn(),p=t.input.has_directive("use strict");t.input.pop_directives_stack(),--t.in_function,t.in_loop=u,t.labels=c,t.in_generator=o,t.in_async=a;var d=new e({name:r,argnames:s,rest:s.rest||null,body:f});return p&&(r&&qn(r),d.each_argname(qn)),d};function on(){return o("name")||o("string")||Qn(t.token.value)}function cn(e){return new Be({start:e,quote:e.quote,value:e.value,end:e})}function dn(){var e=t.token;return G("string"),X(),cn(e)}function vn(e,n){return n.name&&((n=new e(n)).name=new(e===K?Ze:en)(n.name)),n}var mn=oe(function(){if(o("name"))switch(t.token.value){case"async":return s(),G("keyword","function"),o("operator","*")?(s(),tn(k)):tn(_);case"let":s();var e=Nn();return X(),e}else if(o("keyword"))switch(t.token.value){case"class":return s(),Re(K);case"const":s();e=On();return X(),e;case"function":return s(),o("operator","*")?(s(),tn(AST_GeneratorDefun)):tn(H);case"var":s();e=Fn();return X(),e}U()});function kn(){j("{");for(var e=[];!o("punc","}");)o("eof")&&j("}"),e.push(ue());return s(),e}function bn(){j("{");for(var e,n,r,a,i=[];!o("punc","}");)o("eof")&&j("}"),o("keyword","case")?(e&&(e.end=E()),n=[],e=new T({start:(a=t.token,s(),a),expression:pt(),body:n}),i.push(e),j(":")):o("keyword","default")?(e&&(e.end=E()),r&&O("More than one default clause in switch statement"),n=[],e=new V({start:(a=t.token,s(),j(":"),a),body:n}),i.push(e),r=e):(n||U(),n.push(ue()));return e&&(e.end=E()),s(),i}function Dn(e,n){for(var r=[];;){var a=t.token,i=Xn(e),u=null;if(o("operator","=")?(s(),u=ft(n)):!n&&(e===Je||i instanceof J)&&O("Missing initializer in declaration"),r.push(new xn({start:a,name:i,value:u,end:E()})),!o("punc",","))break;s()}return r}function Pn(){var e=i();return tt(e,"name")||tt(e,"punc","[")||tt(e,"punc","{")}var On=function(e){return new Y({start:E(),definitions:Dn(Je,e),end:E()})},Nn=function(e){return new ge({start:E(),definitions:Dn(un,e),end:E()})},Fn=function(e){return new Tn({start:E(),definitions:Dn(fn,e),end:E()})};var Un=function(e){if(o("operator","new"))return function(e){var r,a=t.token;if(G("operator","new"),o("punc",".")&&tt(i(),"name","target"))s(),s(),r=new Ee;else{var u,c=Un(!1);o("punc","(")?(s(),u=Gn(")",!n.strict)):u=[],r=new xe({expression:c,args:u})}return r.start=a,r.end=E(),Wn(r,e)}(e);var r=t.token;if(o("punc")){switch(r.value){case"`":return Wn(Kn(null),e);case"(":if(s(),o("punc",")"))return s(),He([],r);var a=pt(!1,!0),u=r.comments_before.length;if([].unshift.apply(a.start.comments_before,r.comments_before),r.comments_before.length=0,r.comments_before=a.start.comments_before,r.comments_before_length=u,0==u&&r.comments_before.length>0){var c=r.comments_before[0];c.nlb||(c.nlb=r.nlb,r.nlb=!1)}r.comments_after=a.start.comments_after,a.start=r,j(")");var l=E();return l.comments_before=a.end.comments_before,l.comments_after.forEach(function(e){a.end.comments_after.push(e),e.nlb&&(t.token.nlb=!0)}),l.comments_after.length=0,l.comments_after=a.end.comments_after,a.end=l,o("punc","=>")?He(a instanceof Me?a.expressions:[a],r):Wn(a,e);case"[":return Wn(jn(),e);case"{":return Wn($n(),e)}U()}if(o("keyword"))switch(r.value){case"class":s();var f=Re(C);return f.start=r,f.end=E(),Wn(f,e);case"function":return s(),o("operator","*")?(s(),d=tn(AST_GeneratorFunction)):d=tn(_e),d.start=r,d.end=E(),Wn(d,e)}if(o("name")){var p=Yn(ln,r);if(s(),"async"==p.name){var d;if(o("keyword","function"))return s(),o("operator","*")?(s(),d=tn(w)):d=tn(v),d.start=r,d.end=E(),Wn(d,e);if(o("name")&&tt(i(),"punc","=>"))return r=t.token,p=Yn(ln,r),s(),He([p],r,!0);if(o("punc","(")){var _=Wn(p,e);if(!o("punc","=>"))return _;var m=_.args;return m[m.length-1]instanceof qe&&(m.rest=m.pop().expression),He(m,r,!0)}}return o("punc","=>")?He([p],r):Wn(p,e)}if(ct[t.token.type])return Wn(function(){var e,n=t.token,r=n.value;switch(n.type){case"num":isFinite(r)?e=new De({value:r}):(e=new AST_Infinity,r<0&&(e=new gn({operator:"-",expression:e})));break;case"bigint":e=new h({value:r});break;case"string":e=new Be({value:r,quote:n.quote});break;case"regexp":e=new Le({value:r});break;case"atom":switch(r){case"false":e=new le;break;case"true":e=new hn;break;case"null":e=new Ie;break;default:U()}break;default:U()}return s(),e.start=e.end=n,e}(),e);U()};function Gn(e,n,r,a){a||(a=ft);for(var i=!0,u=[];!o("punc",e)&&(i?i=!1:j(","),!n||!o("punc",e));)if(r&&o("punc",","))u.push(new me({start:t.token,end:t.token}));else if(o("operator","...")){if(a!==ft){s(),u.rest=a(),u.rest instanceof z&&N(u.rest.start,"Invalid rest parameter");break}u.push(new qe({start:t.token,expression:(s(),a()),end:E()}))}else u.push(a());return j(e),u}var jn=oe(function(){return j("["),new f({elements:Gn("]",!n.strict,!0)})}),Ln=oe(function(){return tn(l)}),$n=oe(function(){j("{");for(var e=!0,r=[];!o("punc","}")&&(e?e=!1:j(","),n.strict||!o("punc","}"));){var a=t.token;if(o("operator","*")){s();var u=Mn(),c=t.token,l=tn(AST_GeneratorFunction);l.start=c,l.end=E(),r.push(new Fe({start:a,key:u,value:l,end:E()}))}else if(o("operator","..."))s(),r.push(new qe({start:a,expression:ft(),end:E()}));else if(tt(i(),"operator","=")){var f=Bn(ln);s(),r.push(new Ne({start:a,key:a.value,value:new d({start:a,left:f,operator:"=",right:ft(),end:E()}),end:E()}))}else if(tt(i(),"punc",",")||tt(i(),"punc","}"))r.push(new Ne({start:a,key:a.value,value:Bn(ln),end:E()}));else{u=Mn();if(o("punc","(")){var p=t.token;(m=tn(_e)).start=p,m.end=E(),r.push(new Fe({start:a,key:u,value:m,end:E()}))}else if(o("punc",":"))s(),r.push(new Ne({start:a,key:u,value:ft(),end:E()}));else{if("name"==a.type)switch(u){case"async":var _=o("operator","*")&&s();u=Mn();var m;p=t.token;(m=tn(_?w:v)).start=p,m.end=E(),r.push(new Fe({start:a,key:u,value:m,end:E()}));continue;case"get":r.push(new Oe({start:a,key:Mn(),value:Ln(),end:E()}));continue;case"set":r.push(new Ue({start:a,key:Mn(),value:Ln(),end:E()}));continue}U()}}}return s(),new Pe({properties:r})});function Mn(){var e=t.token;switch(e.type){case"operator":Rn[e.value]||U();case"num":case"string":case"name":case"keyword":case"atom":return s(),""+e.value;case"punc":j("[");var n=ft();return j("]"),n;default:U()}}function Yn(e,n){var r=n.value;switch(r){case"await":t.in_async&&U(n);break;case"super":e=Xe;break;case"this":e=_n;break;case"yield":t.in_generator&&U(n)}return new e({name:""+r,start:n,end:n})}function qn(e){"arguments"!=e.name&&"eval"!=e.name&&"let"!=e.name||N(e.start,"Unexpected "+e.name+" in strict mode")}function Bn(e,n){if(!o("name"))return n||O("Name expected"),null;var r=Yn(e,t.token);return t.input.has_directive("use strict")&&r instanceof Qe&&qn(r),s(),r}function Xn(e){var r=t.token;if(o("punc","[")){s();var a=Gn("]",!n.strict,!0,function(){return zn(e)});return new Q({start:r,elements:a,rest:a.rest||null,end:E()})}if(o("punc","{")){s();for(var u=!0,c=[],l=null;!o("punc","}")&&(u?u=!1:j(","),n.strict||!o("punc","}"));){var f=t.token;if(o("punc","[")||tt(i(),"punc",":")){var p=Mn();j(":"),c.push(new Z({start:f,key:p,value:zn(e),end:E()}))}else{if(o("operator","...")){s(),l=Xn(e);break}var d=Bn(e);o("operator","=")&&(s(),d=new z({start:d.start,name:d,value:ft(),end:E()})),c.push(new Z({start:f,key:f.value,value:d,end:E()}))}}return j("}"),new ee({start:r,properties:c,rest:l,end:E()})}return Bn(e)}function zn(e){var n=t.token,r=Xn(e);return o("operator","=")?(s(),new z({start:n,name:r,value:ft(),end:E()})):r}function Kn(e){for(var n=e?e.start:t.token,r=t.input.context().read_template,a=[],i=[];r(a);)s(),i.push(pt()),o("punc","}")||U();return s(),new pn({start:n,expressions:i,strings:a,tag:e,end:E()})}function Wn(e,r){for(var a,c=e.start,l=null;;)if(o("operator","?")&&tt(i(),"punc",".")&&(s(),s(),l=e),o("punc","[")){s();var f=pt();j("]"),e=new Ve({start:c,optional:l===e,expression:e,property:f,end:E()})}else if(r&&o("punc","("))s(),e=new g({start:c,optional:l===e,expression:e,args:Gn(")",!n.strict),end:E()});else if(l===e||o("punc","."))l!==e&&s(),e=new ae({start:c,optional:l===e,expression:e,property:(void 0,a=t.token.value,G("name"),a),end:E()});else{if(!o("punc","`"))break;l&&O("Invalid template on optional chain"),e=Kn(e)}if(l&&(e.terminal=!0),e instanceof g&&!e.pure)for(var p=(c=e.start).comments_before,d=u(c,"comments_before_length")?c.comments_before_length:p.length;--d>=0;)if(/[@#]__PURE__/.test(p[d].value)){e.pure=!0;break}return e}function Hn(e){var n=t.token;if(t.in_async&&o("name","await"))return t.in_funarg===t.in_function&&O("Invalid use of await in function argument"),t.input.context().regex_allowed=!0,s(),new S({start:n,expression:Hn(e),end:E()});if(t.in_generator&&o("name","yield")){t.in_funarg===t.in_function&&O("Invalid use of yield in function argument"),t.input.context().regex_allowed=!0,s();var r=null,a=!1;return o("operator","*")?(s(),r=ft(e),a=!0):(o("punc")?Vn[t.token.value]:$())||(r=ft(e)),new In({start:n,expression:r,nested:a,end:E()})}if(o("operator")&&ot[n.value]){s(),se();var i=Jn(gn,n,Hn(e));return i.start=n,i.end=E(),i}for(var u=Un(!0);o("operator")&&it[t.token.value]&&!L(t.token);)(u=Jn(An,t.token,u)).start=n,u.end=t.token,s();return u}function Jn(e,n,r){var a=n.value;switch(a){case"++":case"--":rt(r)||N(n,"Invalid use of "+a+" operator");break;case"delete":r instanceof ln&&t.input.has_directive("use strict")&&N(r.start,"Calling delete on expression not allowed in strict mode")}return new e({operator:a,expression:r})}var Zn=function(e,n,r){var a=o("operator")?t.token.value:null;"in"==a&&r&&(a=null);var i=null!=a?ut[a]:null;if(null!=i&&i>n){s();var u=Zn(Hn(r),"**"==a?i-1:i,r);return Zn(new y({start:e.start,left:e,operator:a,right:u,end:u.end}),n,r)}return e};var et=function(e){var n=t.token,r=function(e){return Zn(Hn(e),0,e)}(e);if(o("operator","?")){s();var a=ft();return j(":"),new M({start:n,condition:r,consequent:a,alternative:ft(e),end:E()})}return r};function rt(e){return e instanceof je&&!e.optional||e instanceof ln}function lt(e){if(e instanceof f){var n=null;if(e.elements[e.elements.length-1]instanceof qe&&!((n=lt(e.elements.pop().expression))instanceof J||rt(n)))return e;var t=e.elements.map(lt);return c(t,function(e){return e instanceof z||e instanceof J||e instanceof me||rt(e)})?new Q({start:e.start,elements:t,rest:n,end:e.end}):e}if(e instanceof d){var r=lt(e.left);return r instanceof J||rt(r)?new z({start:e.start,name:r,value:e.right,end:e.end}):e}if(!(e instanceof Pe))return e;n=null;if(e.properties[e.properties.length-1]instanceof qe&&!((n=lt(e.properties.pop().expression))instanceof J||rt(n)))return e;for(var a=[],o=0;o<e.properties.length;o++){var i=e.properties[o];if(!(i instanceof Ne))return e;var s=lt(i.value);if(!(s instanceof z||s instanceof J||rt(s)))return e;a.push(new Z({start:i.start,key:i.key,value:s,end:i.end}))}return new ee({start:e.start,properties:a,rest:n,end:e.end})}function ft(e){var n=t.token,r=et(e),a=t.token.value;if(o("operator")&&st[a]){if(rt(r)||"="==a&&(r=lt(r))instanceof J)return s(),new d({start:n,left:r,operator:a,right:ft(e),end:E()});O("Invalid assignment")}return r}function pt(e,n){for(var r=t.token,a=[];;){if(n&&o("operator","...")){s(),a.rest=Xn(rn);break}if(a.push(ft(e)),!o("punc",","))break;if(s(),n&&o("punc",")")&&tt(i(),"punc","=>"))break}return 1!=a.length||a.rest?new Me({start:r,expressions:a,end:E()}):a[0]}function dt(e){++t.in_loop;var n=e();return--t.in_loop,n}if(n.expression){se();var vt=pt();return G("eof"),vt}return function(){var e=t.token,r=[];for(n.module&&(t.in_async=!0,t.input.add_directive("use strict")),t.input.push_directives_stack();!o("eof");)r.push(ue(!0));t.input.pop_directives_stack();var a=E()||e,i=n.toplevel;return i?(i.body=i.body.concat(r),i.end=a):i=new Sn({start:e,body:r,end:a}),i}()}return n.parse=lt,{is_identifier_string:Qn,is_identifier_char:Jn,is_surrogate_pair_head:function(e){return e>=55296&&e<=56319},is_surrogate_pair_tail:function(e){return e>=56320&&e<=57343},decode_escape_sequence:Zn,tokenizer:at,parse:lt,KEYWORDS:Rn,RESERVED_WORDS:Gn,KEYWORDS_BEFORE_EXPRESSION:jn,KEYWORDS_ATOM:Un,UNARY_POSTFIX:it,PRECEDENCE:ut}});
//# sourceMappingURL=sourcemaps/parse.js.map
