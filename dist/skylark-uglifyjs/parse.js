/**
 * skylark-uglifyjs - A version of uglifyjs that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./utils","./ast"],function(e,r){"use strict";const{characters:n,defaults:Pe,find_if:Ge,makePredicate:t,configure_error_stack:a,HOP:$e,all:fe}=e,{AST_Accessor:je,AST_Array:T,AST_Arrow:qe,AST_Assign:pe,AST_AsyncFunction:de,AST_AsyncDefun:_e,AST_AsyncArrow:Ye,AST_AsyncGeneratorFunction:ve,AST_AsyncGeneratorDefun:me,AST_Await:Le,AST_BigInt:Ve,AST_Binary:Xe,AST_BlockStatement:ze,AST_Break:Be,AST_Call:Me,AST_Case:We,AST_Catch:Ke,AST_ClassExpression:He,AST_ClassGetter:Je,AST_ClassInit:Qe,AST_ClassMethod:Ze,AST_ClassSetter:en,AST_Conditional:nn,AST_Const:tn,AST_Continue:rn,AST_Debugger:an,AST_Default:on,AST_DefaultValue:we,AST_DefClass:ke,AST_Definitions:sn,AST_Defun:he,AST_Destructured:ye,AST_DestructuredArray:be,AST_DestructuredKeyVal:Se,AST_DestructuredObject:ge,AST_Directive:un,AST_Do:cn,AST_Dot:ln,AST_EmptyStatement:fn,AST_ExportDeclaration:pn,AST_False:dn,AST_Finally:_n,AST_For:vn,AST_ForIn:mn,AST_ForOf:wn,AST_Function:Ae,AST_Hole:Te,AST_If:kn,AST_Import:hn,AST_Infinity:yn,AST_IterationStatement:bn,AST_Label:Sn,AST_LabeledStatement:gn,AST_LabelRef:An,AST_Let:Tn,AST_New:xn,AST_NewTarget:En,AST_Null:Cn,AST_Number:Dn,AST_Object:xe,AST_ObjectGetter:In,AST_ObjectKeyVal:Ee,AST_ObjectMethod:Ce,AST_ObjectSetter:On,AST_PropAccess:Fn,AST_RegExp:Un,AST_Return:Rn,AST_Sequence:Nn,AST_SimpleStatement:Pn,AST_Spread:De,AST_String:Ie,AST_Sub:Gn,AST_Super:$n,AST_Switch:jn,AST_SymbolCatch:qn,AST_SymbolClass:Yn,AST_SymbolConst:Ln,AST_SymbolDeclaration:Vn,AST_SymbolDefClass:Xn,AST_SymbolDefun:zn,AST_SymbolExport:Bn,AST_SymbolFunarg:Oe,AST_SymbolImport:Fe,AST_SymbolLambda:Mn,AST_SymbolLet:Wn,AST_SymbolRef:Ue,AST_SymbolVar:Kn,AST_Template:Hn,AST_This:Jn,AST_Throw:Qn,AST_Token:F,AST_Toplevel:Zn,AST_True:et,AST_Try:nt,AST_UnaryPostfix:tt,AST_UnaryPrefix:rt,AST_Var:at,AST_VarDef:ot,AST_While:it,AST_With:st,AST_Yield:ut}=r;var e=["abstract async await boolean byte char double enum export final float goto implements import int interface let long native package private protected public short static super synchronized this throws transient volatile yield",x="false null true",Re="break case catch class const continue debugger default delete do else extends finally for function if in instanceof new return switch throw try typeof var void while with"].join(" "),U="return new delete throw else case",Re=t(Re),e=t(e),U=t(U),x=t(x),R=/^0b([01]+)$/i,N=/^0x([0-9a-f]+)$/i,P=/^0o?([0-7]+)$/i,G=t(["in","instanceof","typeof","new","void","delete","++","--","+","-","!","~","&","|","^","*","/","%","**",">>","<<",">>>","<",">","<=",">=","==","===","!=","!==","?","=","+=","-=","/=","*=","%=","**=",">>=","<<=",">>>=","&=","|=","^=","&&","||","??","&&=","||=","??="]),E="\n\r\u2028\u2029",C="+-*&%=<>!?|~^",ct=",;:)}]",D="[{(,;:",I=D+"`)}]",O=E+"  \t\f\v​             　\ufeff",$=t(n("./'\"#"+C+I+O));function j(e){return 48<=e&&e<=57}function q(e){return!$[e]}function lt(e){return/^[a-z_$][a-z0-9_$]*$/i.test(e)}function Y(e){switch(e[0]){case"b":return"\b";case"f":return"\f";case"n":return"\n";case"r":return"\r";case"t":return"\t";case"u":if("{"==e[1]&&"}"==e.slice(-1))n=e.slice(2,-1);else{if(5!=e.length)return;n=e.slice(1)}return(n=parseInt(n,16))<0||isNaN(n)?void 0:n<65536?String.fromCharCode(n):1114111<n?void 0:String.fromCharCode(55232+(n>>10))+String.fromCharCode(56320+(1023&n));case"v":return"\v";case"x":var n;return 3!=e.length?void 0:(n=parseInt(e.slice(1),16))<0||isNaN(n)?void 0:String.fromCharCode(n);case"\r":case"\n":return"";default:return"0"==e?"\0":"0"<=e[0]&&e[0]<="9"?void 0:e}}function o(e,n,t,r,a){this.message=e,this.filename=n,this.line=t,this.col=r,this.pos=a}function ft(e,n,t,r,a){throw new o(e,n,t,r,a)}function Ne(e,n,t){return e.type==n&&(null==t||e.value==t)}E=t(n(E)),C=t(n(C)),ct=t(n(ct)),D=t(n(D)),I=t(n(I)),O=t(n(O)),((o.prototype=Object.create(Error.prototype)).constructor=o).prototype.name="SyntaxError",a(o);var L={};function pt(r,a,o,i){var s={text:r,filename:a,pos:0,tokpos:0,line:1,tokline:0,col:0,tokcol:0,newline_before:!1,regex_allowed:!1,comments_before:[],directives:Object.create(null),read_template:e("Unterminated template literal",function(e){for(var n="";;){var t=r();switch(t){case"\\":t+=r();break;case"`":return void e.push(n);case"$":if("{"==c())return l(),e.push(n),s.regex_allowed=!0}n+=t}function r(){var e=l(!0,!0);return"\r"==e?"\n":e}})},u=!1;function c(){return s.text.charAt(s.pos)}function l(e,n){var t=s.text.charAt(s.pos++);if(e&&!t)throw L;return E[t]?(s.col=0,s.line++,n||(s.newline_before=!0),"\r"==t&&"\n"==c()&&(s.pos++,t="\n")):s.col++,t}function f(e){for(;0<e--;)l()}function p(e){return s.text.substr(s.pos,e.length)==e}function d(){s.tokline=s.line,s.tokcol=s.col,s.tokpos=s.pos}function _(e,n,t){s.regex_allowed="operator"==e&&!_t[n]||"keyword"==e&&U[n]||"punc"==e&&D[n],"punc"==e&&"."==n?u=!0:t||(u=!1);n={type:e,value:n,line:s.tokline,col:s.tokcol,pos:s.tokpos,endline:s.line,endcol:s.col,endpos:s.pos,nlb:s.newline_before,file:a};return/^(?:num|string|regexp)$/i.test(e)&&(n.raw=r.substring(n.pos,n.endpos)),t||(n.comments_before=s.comments_before,n.comments_after=s.comments_before=[]),s.newline_before=!1,new F(n)}function v(e){ft(e,a,s.tokline,s.tokcol,s.tokpos)}function m(e){return/^0[0-7_]+$/.test(e)}function w(e){var n,t=!1,r=!1,a=!1,o="."==e,i=function(e){for(var n,t="";(n=c())&&e(n,t);)t+=l();return t}(function(e,n){switch(e){case"x":case"X":return!a&&(a=!0);case"e":case"E":return a||!t&&(t=r=!0);case"+":case"-":return r;case r=!1,".":return!(o||t||a||m(n))&&(o=!0)}return/[_0-9a-dfo]/i.test(e)}),e=(m(i=e?e+i:i)?T.has_directive("use strict")&&v("Legacy octal literals are not allowed in strict mode"):i=i.replace(a?/([1-9a-f]|.0)_(?=[0-9a-f])/gi:/([1-9]|.0)_(?=[0-9])/gi,"$1"),e=i,(n=R.exec(e))?parseInt(n[1],2):(n=N.exec(e))?parseInt(n[1],16):(n=P.exec(e))?parseInt(n[1],8):(n=parseFloat(e))==e?n:void 0);return isNaN(e)&&v("Invalid syntax: "+i),o||t||"n"!=c()?_("num",e):_("bigint",i.toLowerCase()+l())}function k(e){var n,t=l(!0,e);if("0"<=t&&t<="7")return n=t,"0"<=(a=c())&&a<="7"&&(n+=l(!0))[0]<="3"&&"0"<=(a=c())&&a<="7"&&(n+=l(!0)),"0"===n?"\0":(0<n.length&&T.has_directive("use strict")&&v("Legacy octal escape sequences are not allowed in strict mode"),String.fromCharCode(parseInt(n,8)));if("u"==t){var r=l(!0,e);if(t+=r,"{"!=r)t+=l(!0,e)+l(!0,e)+l(!0,e);else for(;t+=r=l(!0,e),"}"!=r;);}else"x"==t&&(t+=l(!0,e)+l(!0,e));var a=Y(t);return"string"!=typeof a&&v("Invalid escape sequence: \\"+t),a}var h=e("Unterminated string constant",function(e){for(var n=l(),t="";;){var r=l(!0,!0);if("\\"==r)r=k(!0);else if(E[r])v("Unterminated string constant");else if(r==n)break;t+=r}var a=_("string",t);return a.quote=e,a});function y(e){var n,t=s.regex_allowed,r=function(){for(var e=s.text,n=s.pos;n<s.text.length;++n)if(E[e[n]])return n;return-1}();return-1==r?(n=s.text.substr(s.pos),s.pos=s.text.length):(n=s.text.substring(s.pos,r),s.pos=r),s.col=s.tokcol+(s.pos-s.tokpos),s.comments_before.push(_(e,n,!0)),s.regex_allowed=t,T}var b=e("Unterminated multiline comment",function(){var e=s.regex_allowed,n=function(e,n){if(e=s.text.indexOf(e,s.pos),n&&-1==e)throw L;return e}("*/",!0),n=s.text.substring(s.pos,n).replace(/\r\n|\r|\u2028|\u2029/g,"\n");return f(n.length+2),s.comments_before.push(_("comment2",n,!0)),s.regex_allowed=e,T});function S(){for(var e,n,t=!1,r=!1,a="#"==c()?l():"";e=c();)if(t)"u"!=e&&v("Expecting UnicodeEscapeSequence -- uXXXX"),q(e=k())||v("Unicode char: "+e.charCodeAt(0)+" is not valid in identifier"),a+=e,t=!1;else if("\\"==e)r=t=!0,l();else{if(!q(e))break;a+=l()}return Re[a]&&r&&(n=a.charCodeAt(0).toString(16).toUpperCase(),a="\\u"+"0000".substr(n.length)+n+a.slice(1)),a}var g=e("Unterminated regular expression",function(e){for(var n,t=!1,r=!1;n=l(!0);)if(E[n])v("Unexpected line terminator");else if(t)e+="\\"+n,t=!1;else if("["==n)r=!0,e+=n;else if("]"==n&&r)r=!1,e+=n;else{if("/"==n&&!r)break;"\\"==n?t=!0:e+=n}var a=S();try{var o=new RegExp(e,a);return o.raw_source=e,_("regexp",o)}catch(e){v(e.message)}});function A(e){return _("operator",function e(n){var t;return c()&&(t=n+c(),G[t])?(l(),e(t)):n}(e||l()))}function e(n,t){return function(e){try{return t(e)}catch(e){if(e!==L)throw e;v(n)}}}function T(e){if(null!=e)return g(e);for(i&&0==s.pos&&p("#!")&&(d(),f(2),y("comment5"));;){for(;O[c()];)l();if(d(),o){if(p("\x3c!--")){f(4),y("comment3");continue}if(p("--\x3e")&&s.newline_before){f(3),y("comment4");continue}}var n=c();if(!n)return _("eof");var t=n.charCodeAt(0);switch(t){case 34:case 39:return h(n);case 46:return l(),p("..")?_("operator","."+l()+l()):j(c().charCodeAt(0))?w("."):_("punc",".");case 47:var r=function(){switch(l(),c()){case"/":return l(),y("comment1");case"*":return l(),b()}return s.regex_allowed?g(""):A("/")}();if(r===T)continue;return r}if(j(t))return w();if(I[n])return _("punc",l());if(p("=>"))return _("punc",l()+l());if(C[n])return A();if(35!=t&&92!=t&&$[n])break;return t=void 0,t=S(),u?_("name",t):x[t]?_("atom",t):Re[t]?G[t]?_("operator",t):_("keyword",t):_("name",t)}v("Unexpected character '"+n+"'")}return T.context=function(e){return s=e?e:s},T.add_directive=function(e){s.directives[e]=!0},T.push_directives_stack=function(){s.directives=Object.create(s.directives)},T.pop_directives_stack=function(){s.directives=Object.getPrototypeOf(s.directives)},T.has_directive=function(e){return!!s.directives[e]},T}var dt=t("typeof void delete -- ++ ! ~ - +"),_t=t("-- ++"),vt=t("= += -= /= *= %= **= >>= <<= >>>= &= |= ^= &&= ||= ??="),mt=function(e,n){for(var t=0;t<e.length;)for(var r=e[t++],a=0;a<r.length;a++)n[r[a]]=t;return n}([["??"],["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],["<",">","<=",">=","in","instanceof"],[">>","<<",">>>"],["+","-"],["*","/","%"],["**"]],{}),wt=t("atom bigint num regexp string");function i(e,x){x=Pe(x,{bare_returns:!1,expression:!1,filename:null,html5_comments:!0,module:!1,shebang:!0,strict:!1,toplevel:null},!0);var E={input:"string"==typeof e?pt(e,x.filename,x.html5_comments,x.shebang):e,in_async:!1,in_directives:!0,in_funarg:-1,in_function:0,in_generator:!1,in_loop:0,labels:[],peeked:null,prev:null,token:null};function C(e,n){return Ne(E.token,e,n)}function D(){return E.peeked||(E.peeked=E.input())}function I(){return E.prev=E.token,E.peeked?(E.token=E.peeked,E.peeked=null):E.token=E.input(),E.in_directives=E.in_directives&&("string"==E.token.type||C("punc",";")),E.token}function O(){return E.prev}function F(e,n,t,r){var a=E.input.context();ft(e,a.filename,null!=n?n:a.tokline,null!=t?t:a.tokcol,null!=r?r:a.tokpos)}function U(e,n){F(n,e.line,e.col)}function r(e,n){return e+(void 0===n?"":" «"+n+"»")}function R(e){U(e=null==e?E.token:e,"Unexpected token: "+r(e.type,e.value))}function N(e,n){if(C(e,n))return I();U(E.token,"Unexpected token: "+r(E.token.type,E.token.value)+", expected: "+r(e,n))}function P(e){N("punc",e)}function G(e){return e.nlb||!fe(e.comments_before,function(e){return!e.nlb})}function Z(){return!x.strict&&(C("eof")||C("punc","}")||G(E.token))}function $(e){C("punc",";")?I():e||Z()||P(";")}function j(){P("(");var e=J();return P(")"),e}function n(r){return function(){var e=E.token,n=r.apply(null,arguments),t=O();return n.start=e,n.end=t,n}}function q(){(C("operator","/")||C("operator","/="))&&(E.peeked=null,E.token=E.input(E.token.value.substr(1)))}E.token=I();var Y=n(function(e){switch(q(),E.token.type){case"string":var n=E.in_directives,t=J();return n&&(t instanceof Ie?(b=t.start.raw.slice(1,-1),E.input.add_directive(b),t.value=b):E.in_directives=n=!1),$(),n?new un(t):new Pn({body:t});case"num":case"bigint":case"regexp":case"operator":case"atom":return L();case"name":switch(E.token.value){case"async":if(Ne(D(),"keyword","function"))return I(),I(),C("operator","*")?(I(),V(me)):V(_e);break;case"await":if(E.in_async)return L();break;case"export":if(e||""===x.module||R(),I(),C("operator","*"))return i=o=E.token,I(),C("name","as")&&(I(),te()||N("name"),i=E.token,I()),N("name","from"),new AST_ExportForeign({aliases:[X(i)],keys:[X(o)],path:re()});if(C("punc","{")){I();for(var r=[],a=[];te();){var o=E.token;I(),a.push(o),C("name","as")?(I(),te()||N("name"),r.push(E.token),I()):r.push(o),C("punc","}")||P(",")}return(P("}"),C("name","from"))?(I(),new AST_ExportForeign({aliases:r.map(X),keys:a.map(X),path:re()})):($(),new AST_ExportReferences({properties:a.map(function(e,n){Ne(e,"name")||U(e,"Name expected");e=le(Bn,e);return e.alias=X(r[n]),e})}))}return C("keyword","default")?(I(),i=E.token,(c=function(){if(C("name","async")){if(Ne(D(),"keyword","function"))return I(),I(),C("operator","*")?(I(),z(me,V(ve))):z(_e,V(de))}else if(C("keyword"))switch(E.token.value){case"class":return I(),z(ke,ne(He));case"function":return(I(),C("operator","*"))?(I(),z(AST_GeneratorDefun,V(AST_GeneratorFunction))):z(he,V(Ae))}}())?(c.start=i,c.end=O()):(q(),c=J(),$()),new AST_ExportDefault({body:c})):new pn({body:ae()});case"import":var i=D();if("punc"==i.type&&/^[(.]$/.test(i.value))break;e||""===x.module||R(),I();var s,u,c=null,l=M(Fe,!0),f=null;if(l?(l.key=new Ie({start:l.start,value:"",end:l.end}),(s=C("punc",","))&&I()):s=!C("string"),s)if(C("operator","*")){var p=E.token;I(),N("name","as"),(c=M(Fe)).key=X(p)}else{for(P("{"),f=[];te();)Ne(D(),"name","as")?(p=E.token,I(),I(),(u=M(Fe)).key=X(p)):(u=M(Fe)).key=new Ie({start:u.start,value:u.name,end:u.end}),f.push(u),C("punc","}")||P(",");P("}")}return(c||l||f)&&N("name","from"),new hn({all:c,default:l,path:re(),properties:f});case"let":if(ie())return I(),d=ue(),$(),d;break;case"yield":if(E.in_generator)return L()}return(Ne(D(),"punc",":")?function(){var n=M(Sn);fe(E.labels,function(e){return e.name!=n.name})||F("Label "+n.name+" defined twice");P(":"),E.labels.push(n);var e=Y();E.labels.pop(),e instanceof bn||n.references.forEach(function(e){e instanceof rn&&U(e.label.start,"Continue label `"+n.name+"` must refer to IterationStatement")});return new gn({body:e,label:n})}:L)();case"punc":switch(E.token.value){case"{":return new ze({start:E.token,body:B(),end:O()});case"[":case"(":case"`":return L();case";":return E.in_directives=!1,I(),new fn;default:R()}case"keyword":switch(E.token.value){case"break":return I(),ee(Be);case"class":return I(),ne(ke);case"const":I();var d=se();return $(),d;case"continue":return I(),ee(rn);case"debugger":return I(),$(),new an;case"do":I();var t=Q(Y),_=(N("keyword","while"),j());return $(!0),new cn({body:t,condition:_});case"while":return I(),new it({condition:j(),body:Q(Y)});case"for":I();var _=C("name","await")&&I(),v=(P("("),null);if(!_&&C("punc",";")||(v=(C("keyword","const")?(I(),se):C("name","let")&&ie()?(I(),ue):C("keyword","var")?(I(),ce):J)(!0),_?(N("name","of"),h=AST_ForAwaitOf):C("operator","in")?(I(),h=mn):C("name","of")&&(I(),h=wn),!h))return m=v,P(";"),w=C("punc",";")?null:J(),P(";"),k=C("punc",")")?null:J(),P(")"),new vn({init:m,condition:w,step:k,body:Q(Y)});v instanceof sn?(1<v.definitions.length&&U(v.start,"Only one variable declaration allowed in for..in/of loop"),h!==mn&&v.definitions[0].value&&U(v.definitions[0].value.start,"No initializers allowed in for..of loop")):K(v)||(v=H(v))instanceof ye||U(v.start,"Invalid left-hand side in for..in/of loop");var m=h,w=v,k=(q(),J());return P(")"),new m({init:w,object:k,body:Q(Y)});case"function":return(I(),C("operator","*"))?(I(),V(AST_GeneratorDefun)):V(he);case"if":I();var h=j(),v=Y(),y=null;return C("keyword","else")&&(I(),y=Y()),new kn({condition:h,body:v,alternative:y});case"return":0!=E.in_function||x.bare_returns||F("'return' outside of function"),I();var b=null;return C("punc",";")?I():Z()||(b=J(),$()),new Rn({value:b});case"switch":return I(),new jn({expression:j(),body:Q(oe)});case"throw":I(),G(E.token)&&F("Illegal newline after 'throw'");b=J();return $(),new Qn({value:b});case"try":I();var S,g,y=B(),A=null,T=null;return C("keyword","catch")&&(g=E.token,I(),S=null,C("punc","(")&&(I(),S=W(qn),P(")")),A=new Ke({start:g,argname:S,body:B(),end:O()})),C("keyword","finally")&&(g=E.token,I(),T=new _n({start:g,body:B(),end:O()})),A||T||F("Missing catch/finally blocks"),new nt({body:y,bcatch:A,bfinally:T});case"var":I();d=ce();return $(),d;case"with":return E.input.has_directive("use strict")&&F("Strict mode may not include a with statement"),I(),new st({expression:j(),body:Y()})}}R()});function L(){var e=J();return $(),new Pn({body:e})}function ee(e){var n,t=null,e=(null!=(t=Z()?t:M(An,!0))?((n=Ge(function(e){return e.name==t.name},E.labels))||U(t.start,"Undefined label "+t.name),t.thedef=n):0==E.in_loop&&F(e.TYPE+" not inside a loop or switch"),$(),new e({label:t}));return n&&n.references.push(e),e}function m(e,n){if(C("name",e)){e=D();if(e&&!Ne(e,"operator","=")&&!("punc"==e.type&&/^[(;}]$/.test(e.value)||n&&G(e)))return I()}}function ne(e){for(var n,t=E.in_async,r=E.in_generator,a=(E.input.push_directives_stack(),E.input.add_directive("use strict"),n=e===ke?M(Xn):M(Yn,!0),null),o=(C("keyword","extends")&&(I(),q(),a=w(!0)),P("{"),[]);!C("punc","}");)if(C("punc",";"))I();else{var i=E.token,s=!!m("static"),u=m("async",!0);if(C("operator","*")){I();var c=C("name")&&/^#/.test(E.token.value),l=_(),f=E.token,p=V(u?ve:AST_GeneratorFunction);p.start=f,p.end=O(),o.push(new Ze({start:i,static:s,private:c,key:l,value:p,end:O()}))}else if(s&&C("punc","{"))o.push(new Qe({start:i,value:new AST_ClassInitBlock({start:i,body:B(),end:O()}),end:O()}));else{c=C("name")&&/^#/.test(E.token.value),l=_();if(C("punc","(")){f=E.token,p=V(u?de:Ae);p.start=f,p.end=O(),o.push(new Ze({start:i,static:s,private:c,key:l,value:p,end:O()}))}else{u&&R(u);u=null;if(C("operator","="))I(),E.in_async=!1,E.in_generator=!1,u=v(),E.in_generator=r,E.in_async=t;else if(!C("punc",";")&&!C("punc","}")){var d=null;switch(l){case"get":d=Je;break;case"set":d=en}if(d){o.push(new d({start:i,static:s,private:C("name")&&/^#/.test(E.token.value),key:_(),value:h(),end:O()}));continue}}$(),o.push(new AST_ClassField({start:i,static:s,private:c,key:l,value:u,end:O()}))}}}return I(),E.input.pop_directives_stack(),E.in_generator=r,E.in_async=t,new e({extends:a,name:n,properties:o})}function f(e){var n;return e instanceof T?(n=null,e.elements[e.elements.length-1]instanceof De&&(n=f(e.elements.pop().expression)),new be({start:e.start,elements:e.elements.map(f),rest:n,end:e.end})):e instanceof pe?new we({start:e.start,name:f(e.left),value:e.right,end:e.end}):e instanceof we?(e.name=f(e.name),e):e instanceof be?(e.elements=e.elements.map(f),e.rest&&(e.rest=f(e.rest)),e):e instanceof ge?(e.properties.forEach(function(e){e.value=f(e.value)}),e.rest&&(e.rest=f(e.rest)),e):e instanceof Te?e:e instanceof xe?(n=null,e.properties[e.properties.length-1]instanceof De&&(n=f(e.properties.pop().expression)),new ge({start:e.start,properties:e.properties.map(function(e){return e instanceof Ee||U(e.start,"Invalid destructuring assignment"),new Se({start:e.start,key:e.key,value:f(e.value),end:e.end})}),rest:n,end:e.end})):e instanceof Oe?e:e instanceof Ue?new Oe(e):e instanceof ut?new Oe({start:e.start,name:"yield",end:e.end}):void U(e.start,"Invalid arrow parameter")}function l(e,n,t){var r,a,o=E.in_async,i=E.in_generator,s=(E.in_async=t,E.in_generator=!1,E.in_funarg),u=(E.in_funarg=E.in_function,e.map(f)),e=(e=e.rest||null)&&f(e),s=(E.in_funarg=s,P("=>"),E.in_loop),c=E.labels,l=(++E.in_function,E.input.push_directives_stack(),E.in_loop=0,E.labels=[],a=C("punc","{")?(E.in_directives=!0,r=B(),null):(r=[],q(),v()),E.input.has_directive("use strict")),s=(E.input.pop_directives_stack(),--E.in_function,E.in_loop=s,E.labels=c,E.in_generator=i,E.in_async=o,new(t?Ye:qe)({start:n,argnames:u,rest:e,body:r,value:a,end:O()}));return l&&s.each_argname(b),s}var V=function(e){var n,t=E.in_async,r=E.in_generator,a=(/Defun$/.test(e.TYPE)?(n=M(zn),E.in_async=/^Async/.test(e.TYPE),E.in_generator=/Generator/.test(e.TYPE)):(E.in_async=/^Async/.test(e.TYPE),E.in_generator=/Generator/.test(e.TYPE),n=M(Mn,!0)),!n||e===je||n instanceof Vn||R(O()),P("("),E.in_funarg),o=(E.in_funarg=E.in_function,p(")",!x.strict,!1,function(){return c(Oe)})),a=(E.in_funarg=a,E.in_loop),i=E.labels,s=(++E.in_function,E.in_directives=!0,E.input.push_directives_stack(),E.in_loop=0,E.labels=[],B()),u=E.input.has_directive("use strict"),a=(E.input.pop_directives_stack(),--E.in_function,E.in_loop=a,E.labels=i,E.in_generator=r,E.in_async=t,new e({name:n,argnames:o,rest:o.rest||null,body:s}));return u&&(n&&b(n),a.each_argname(b)),a};function te(){return C("name")||C("string")||lt(E.token.value)}function X(e){return new Ie({start:e,quote:e.quote,value:e.value,end:e})}function re(){var e=E.token;return N("string"),$(),X(e)}function z(e,n){return n.name&&((n=new e(n)).name=new(e===ke?Xn:zn)(n.name)),n}var ae=n(function(){if(C("name"))switch(E.token.value){case"async":return(I(),N("keyword","function"),C("operator","*"))?(I(),V(me)):V(_e);case"let":I();var e=ue();return $(),e}else if(C("keyword"))switch(E.token.value){case"class":return I(),ne(ke);case"const":I();e=se();return $(),e;case"function":return(I(),C("operator","*"))?(I(),V(AST_GeneratorDefun)):V(he);case"var":I();e=ce();return $(),e}R()});function B(){P("{");for(var e=[];!C("punc","}");)C("eof")&&P("}"),e.push(Y());return I(),e}function oe(){P("{");for(var e,n,t,r,a=[];!C("punc","}");)C("eof")&&P("}"),C("keyword","case")?(e&&(e.end=O()),n=[],e=new We({start:(r=E.token,I(),r),expression:J(),body:n}),a.push(e),P(":")):C("keyword","default")?(e&&(e.end=O()),t&&F("More than one default clause in switch statement"),n=[],e=new on({start:(r=E.token,I(),P(":"),r),body:n}),a.push(e),t=e):(n||R(),n.push(Y()));return e&&(e.end=O()),I(),a}function a(e,n){for(var t=[];;){var r=E.token,a=W(e),o=null;if(C("operator","=")?(I(),o=v(n)):!n&&(e===Ln||a instanceof ye)&&F("Missing initializer in declaration"),t.push(new ot({start:r,name:a,value:o,end:O()})),!C("punc",","))break;I()}return t}function ie(){var e=D();return Ne(e,"name")||Ne(e,"punc","[")||Ne(e,"punc","{")}var se=function(e){return new tn({start:O(),definitions:a(Ln,e),end:O()})},ue=function(e){return new Tn({start:O(),definitions:a(Wn,e),end:O()})},ce=function(e){return new at({start:O(),definitions:a(Kn,e),end:O()})};var w=function(e){if(C("operator","new"))return n=e,s=E.token,N("operator","new"),(u=C("punc",".")&&Ne(D(),"name","target")?(I(),I(),new En):(u=w(!1),c=C("punc","(")?(I(),p(")",!x.strict)):[],new xn({expression:u,args:c}))).start=s,u.end=O(),d(u,n);var n,t,r,a=E.token;if(C("punc")){switch(a.value){case"`":return d(S(null),e);case"(":return(I(),C("punc",")"))?(I(),l([],a)):(t=J(!1,!0),r=a.comments_before.length,[].unshift.apply(t.start.comments_before,a.comments_before),a.comments_before.length=0,a.comments_before=t.start.comments_before,0==(a.comments_before_length=r)&&0<a.comments_before.length&&((r=a.comments_before[0]).nlb||(r.nlb=a.nlb,a.nlb=!1)),a.comments_after=t.start.comments_after,t.start=a,P(")"),(r=O()).comments_before=t.end.comments_before,r.comments_after.forEach(function(e){t.end.comments_after.push(e),e.nlb&&(E.token.nlb=!0)}),r.comments_after.length=0,r.comments_after=t.end.comments_after,t.end=r,C("punc","=>")?l(t instanceof Nn?t.expressions:[t],a):d(t,e));case"[":return d(k(),e);case"{":return d(y(),e)}R()}if(C("keyword"))switch(a.value){case"class":I();var o=ne(He);return o.start=a,o.end=O(),d(o,e);case"function":return I(),(i=C("operator","*")?(I(),V(AST_GeneratorFunction)):V(Ae)).start=a,i.end=O(),d(i,e)}if(C("name")){var i,s,u,c=le(Ue,a);if(I(),"async"==c.name){if(C("keyword","function"))return I(),(i=C("operator","*")?(I(),V(ve)):V(de)).start=a,i.end=O(),d(i,e);if(C("name")&&Ne(D(),"punc","=>"))return a=E.token,c=le(Ue,a),I(),l([c],a,!0);if(C("punc","("))return s=d(c,e),C("punc","=>")?((u=s.args)[u.length-1]instanceof De&&(u.rest=u.pop().expression),l(u,a,!0)):s}return C("punc","=>")?l([c],a):d(c,e)}if(wt[E.token.type])return d(function(){var e,n=E.token,t=n.value;switch(n.type){case"num":isFinite(t)?e=new Dn({value:t}):(e=new yn,t<0&&(e=new rt({operator:"-",expression:e})));break;case"bigint":e=new Ve({value:t});break;case"string":e=new Ie({value:t,quote:n.quote});break;case"regexp":e=new Un({value:t});break;case"atom":switch(t){case"false":e=new dn;break;case"true":e=new et;break;case"null":e=new Cn;break;default:R()}break;default:R()}return I(),e.start=e.end=n,e}(),e);R()};function p(e,n,t,r){r=r||v;for(var a=!0,o=[];!C("punc",e)&&(a?a=!1:P(","),!n||!C("punc",e));)if(t&&C("punc",","))o.push(new Te({start:E.token,end:E.token}));else if(C("operator","...")){if(r!==v){I(),o.rest=r(),o.rest instanceof we&&U(o.rest.start,"Invalid rest parameter");break}o.push(new De({start:E.token,expression:(I(),r()),end:O()}))}else o.push(r());return P(e),o}var k=n(function(){return P("["),new T({elements:p("]",!x.strict,!0)})}),h=n(function(){return V(je)}),y=n(function(){P("{");for(var e=!0,n=[];!C("punc","}")&&(e?e=!1:P(","),x.strict||!C("punc","}"));){var t=E.token;if(C("operator","*")){I();var r=_(),a=E.token,o=V(AST_GeneratorFunction);o.start=a,o.end=O(),n.push(new Ce({start:t,key:r,value:o,end:O()}))}else if(C("operator","..."))I(),n.push(new De({start:t,expression:v(),end:O()}));else if(Ne(D(),"operator","=")){a=M(Ue);I(),n.push(new Ee({start:t,key:t.value,value:new pe({start:t,left:a,operator:"=",right:v(),end:O()}),end:O()}))}else if(Ne(D(),"punc",",")||Ne(D(),"punc","}"))n.push(new Ee({start:t,key:t.value,value:M(Ue),end:O()}));else{r=_();if(C("punc","(")){var i=E.token;(s=V(Ae)).start=i,s.end=O(),n.push(new Ce({start:t,key:r,value:s,end:O()}))}else if(C("punc",":"))I(),n.push(new Ee({start:t,key:r,value:v(),end:O()}));else{if("name"==t.type)switch(r){case"async":var s,u=C("operator","*")&&I(),i=(r=_(),E.token);(s=V(u?ve:de)).start=i,s.end=O(),n.push(new Ce({start:t,key:r,value:s,end:O()}));continue;case"get":n.push(new In({start:t,key:_(),value:h(),end:O()}));continue;case"set":n.push(new On({start:t,key:_(),value:h(),end:O()}));continue}R()}}}return I(),new xe({properties:n})});function _(){var e=E.token;switch(e.type){case"operator":Re[e.value]||R();case"num":case"string":case"name":case"keyword":case"atom":return I(),""+e.value;case"punc":P("[");var n=v();return P("]"),n;default:R()}}function le(e,n){var t=n.value;switch(t){case"await":E.in_async&&R(n);break;case"super":e=$n;break;case"this":e=Jn;break;case"yield":E.in_generator&&R(n)}return new e({name:""+t,start:n,end:n})}function b(e){"arguments"!=e.name&&"eval"!=e.name&&"let"!=e.name||U(e.start,"Unexpected "+e.name+" in strict mode")}function M(e,n){return C("name")?(e=le(e,E.token),E.input.has_directive("use strict")&&e instanceof Vn&&b(e),I(),e):(n||F("Name expected"),null)}function W(e){var n,t=E.token;if(C("punc","["))return I(),n=p("]",!x.strict,!0,function(){return c(e)}),new be({start:t,elements:n,rest:n.rest||null,end:O()});if(C("punc","{")){I();for(var r=!0,a=[],o=null;!C("punc","}")&&(r?r=!1:P(","),x.strict||!C("punc","}"));){var i=E.token;if(C("punc","[")||Ne(D(),"punc",":")){var s=_();P(":"),a.push(new Se({start:i,key:s,value:c(e),end:O()}))}else{if(C("operator","...")){I(),o=W(e);break}s=M(e);C("operator","=")&&(I(),s=new we({start:s.start,name:s,value:v(),end:O()})),a.push(new Se({start:i,key:i.value,value:s,end:O()}))}}return P("}"),new ge({start:t,properties:a,rest:o,end:O()})}return M(e)}function c(e){var n=E.token,e=W(e);return C("operator","=")?(I(),new we({start:n,name:e,value:v(),end:O()})):e}function S(e){for(var n=e?e.start:E.token,t=E.input.context().read_template,r=[],a=[];t(r);)I(),a.push(J()),C("punc","}")||R();return I(),new Hn({start:n,expressions:a,strings:r,tag:e,end:O()})}function d(e,n){for(var t=e.start,r=null;;)if(C("operator","?")&&Ne(D(),"punc",".")&&(I(),I(),r=e),C("punc","[")){I();var a=J();P("]"),e=new Gn({start:t,optional:r===e,expression:e,property:a,end:O()})}else if(n&&C("punc","("))I(),e=new Me({start:t,optional:r===e,expression:e,args:p(")",!x.strict),end:O()});else if(r===e||C("punc","."))r!==e&&I(),e=new ln({start:t,optional:r===e,expression:e,property:(a=void 0,a=E.token.value,N("name"),a),end:O()});else{if(!C("punc","`"))break;r&&F("Invalid template on optional chain"),e=S(e)}if(r&&(e.terminal=!0),e instanceof Me&&!e.pure)for(var o=(t=e.start).comments_before,i=$e(t,"comments_before_length")?t.comments_before_length:o.length;0<=--i;)if(/[@#]__PURE__/.test(o[i].value)){e.pure=!0;break}return e}function o(e){var n,t,r=E.token;if(E.in_async&&C("name","await"))return E.in_funarg===E.in_function&&F("Invalid use of await in function argument"),E.input.context().regex_allowed=!0,I(),new Le({start:r,expression:o(e),end:O()});if(E.in_generator&&C("name","yield"))return E.in_funarg===E.in_function&&F("Invalid use of yield in function argument"),E.input.context().regex_allowed=!0,I(),t=null,n=!1,C("operator","*")?(I(),t=v(e),n=!0):(C("punc")?ct[E.token.value]:Z())||(t=v(e)),new ut({start:r,expression:t,nested:n,end:O()});if(C("operator")&&dt[r.value])return I(),q(),(t=i(rt,r,o(e))).start=r,t.end=O(),t;for(var a=w(!0);C("operator")&&_t[E.token.value]&&!G(E.token);)(a=i(tt,E.token,a)).start=r,a.end=E.token,I();return a}function i(e,n,t){var r=n.value;switch(r){case"++":case"--":K(t)||U(n,"Invalid use of "+r+" operator");break;case"delete":t instanceof Ue&&E.input.has_directive("use strict")&&U(t.start,"Calling delete on expression not allowed in strict mode")}return new e({operator:r,expression:t})}var s=function(e,n,t){var r=C("operator")?E.token.value:null,a=null!=(r="in"==r&&t?null:r)?mt[r]:null;return null!=a&&n<a?(I(),a=s(o(t),"**"==r?a-1:a,t),s(new Xe({start:e.start,left:e,operator:r,right:a,end:a.end}),n,t)):e};var u=function(e){var n,t=E.token,r=s(o(r=e),0,r);return C("operator","?")?(I(),n=v(),P(":"),new nn({start:t,condition:r,consequent:n,alternative:v(e),end:O()})):r};function K(e){return e instanceof Fn&&!e.optional||e instanceof Ue}function H(e){var n;if(e instanceof T)return t=null,(!(e.elements[e.elements.length-1]instanceof De)||(t=H(e.elements.pop().expression))instanceof ye||K(t))&&(n=e.elements.map(H),fe(n,function(e){return e instanceof we||e instanceof ye||e instanceof Te||K(e)}))?new be({start:e.start,elements:n,rest:t,end:e.end}):e;if(e instanceof pe)return(n=H(e.left))instanceof ye||K(n)?new we({start:e.start,name:n,value:e.right,end:e.end}):e;if(!(e instanceof xe))return e;var t=null;if(e.properties[e.properties.length-1]instanceof De&&!((t=H(e.properties.pop().expression))instanceof ye||K(t)))return e;for(var r=[],a=0;a<e.properties.length;a++){var o=e.properties[a];if(!(o instanceof Ee))return e;var i=H(o.value);if(!(i instanceof we||i instanceof ye||K(i)))return e;r.push(new Se({start:o.start,key:o.key,value:i,end:o.end}))}return new ge({start:e.start,properties:r,rest:t,end:e.end})}function v(e){var n=E.token,t=u(e),r=E.token.value;if(C("operator")&&vt[r]){if(K(t)||"="==r&&(t=H(t))instanceof ye)return I(),new pe({start:n,left:t,operator:r,right:v(e),end:O()});F("Invalid assignment")}return t}function J(e,n){for(var t=E.token,r=[];;){if(n&&C("operator","...")){I(),r.rest=W(Oe);break}if(r.push(v(e)),!C("punc",","))break;if(I(),n&&C("punc",")")&&Ne(D(),"punc","=>"))break}return 1!=r.length||r.rest?new Nn({start:t,expressions:r,end:O()}):r[0]}function Q(e){++E.in_loop;e=e();return--E.in_loop,e}if(x.expression)return q(),e=J(),N("eof"),e;var e=E.token,g=[];for(x.module&&(E.in_async=!0,E.input.add_directive("use strict")),E.input.push_directives_stack();!C("eof");)g.push(Y(!0));E.input.pop_directives_stack();var A=O()||e,t=x.toplevel;return t?(t.body=t.body.concat(g),t.end=A):t=new Zn({start:e,body:g,end:A}),t}return{is_identifier_string:lt,is_identifier_char:q,is_surrogate_pair_head:function(e){return 55296<=e&&e<=56319},is_surrogate_pair_tail:function(e){return 56320<=e&&e<=57343},decode_escape_sequence:Y,tokenizer:pt,parse:r.parse=i,KEYWORDS:Re,RESERVED_WORDS:e,KEYWORDS_BEFORE_EXPRESSION:U,KEYWORDS_ATOM:x,UNARY_POSTFIX:_t,PRECEDENCE:mt}});
//# sourceMappingURL=sourcemaps/parse.js.map
