/**
 * skylark-uglifyjs - A version of uglifyjs that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./utils","./ast"],function(e,n){"use strict";const{characters:t,defaults:r,makePredicate:a,set_annotation:o,configure_error_stack:i,HOP:s,all:u}=e,{AST_Accessor:c,AST_Array:l,AST_Arrow:f,AST_Assign:p,AST_Await:_,AST_BigInt:d,AST_Binary:v,AST_BlockStatement:m,AST_Break:S,AST_Call:A,AST_Case:w,AST_Catch:T,AST_Chain:k,AST_ClassExpression:y,AST_ClassPrivateProperty:h,AST_ClassProperty:b,AST_ClassStaticBlock:g,AST_ConciseMethod:x,AST_PrivateIn:D,AST_PrivateGetter:C,AST_PrivateMethod:E,AST_PrivateSetter:I,AST_Conditional:O,AST_Const:P,AST_Continue:F,AST_Debugger:N,AST_Default:G,AST_DefaultAssign:j,AST_DefClass:U,AST_Definitions:R,AST_Defun:V,AST_Destructuring:M,AST_Directive:L,AST_Do:$,AST_Dot:Y,AST_DotHash:q,AST_EmptyStatement:K,AST_Expansion:B,AST_Export:z,AST_False:W,AST_Finally:X,AST_For:H,AST_ForIn:J,AST_ForOf:Q,AST_Function:Z,AST_Hole:ee,AST_If:ne,AST_Import:te,AST_ImportMeta:re,AST_IterationStatement:ae,AST_Label:oe,AST_LabeledStatement:ie,AST_LabelRef:se,AST_Let:ue,AST_NameMapping:ce,AST_New:le,AST_NewTarget:fe,AST_Node:pe,AST_Null:_e,AST_Number:de,AST_Object:ve,AST_ObjectGetter:me,AST_ObjectKeyVal:Se,AST_ObjectProperty:Ae,AST_ObjectSetter:we,AST_PrefixedTemplateString:Te,AST_PropAccess:ke,AST_RegExp:ye,AST_Return:he,AST_Sequence:be,AST_SimpleStatement:ge,AST_String:xe,AST_Sub:De,AST_Super:Ce,AST_Switch:Ee,AST_SymbolCatch:Ie,AST_SymbolClass:Oe,AST_SymbolClassProperty:Pe,AST_SymbolConst:Fe,AST_SymbolDeclaration:Ne,AST_SymbolDefClass:Ge,AST_SymbolDefun:je,AST_SymbolExport:Ue,AST_SymbolExportForeign:Re,AST_SymbolFunarg:Ve,AST_SymbolImport:Me,AST_SymbolImportForeign:Le,AST_SymbolLambda:$e,AST_SymbolLet:Ye,AST_SymbolMethod:qe,AST_SymbolRef:Ke,AST_SymbolVar:Be,AST_TemplateSegment:ze,AST_TemplateString:We,AST_This:Xe,AST_SymbolPrivateProperty:He,AST_Throw:Je,AST_Token:Qe,AST_Toplevel:Ze,AST_True:en,AST_Try:nn,AST_TryBlock:tn,AST_UnaryPostfix:rn,AST_UnaryPrefix:an,AST_Var:on,AST_VarDef:sn,AST_While:un,AST_With:cn,AST_Yield:ln,_INLINE:fn,_NOINLINE:pn,_PURE:_n,_KEY:dn,_MANGLEPROP:vn}=n;var mn="break case catch class const continue debugger default delete do else extends finally for function if in instanceof new return switch throw try typeof var void while with",Sn="false null true",An=["abstract async await boolean byte char double enum export final float goto implements import int interface let long native package private protected public short static super synchronized this throws transient volatile yield",Sn,mn].join(" "),wn="return new delete throw else case";mn=a(mn),An=a(An),wn=a(wn),Sn=a(Sn);var Tn=/^0b([01]+)$/i,kn=/^0x([0-9a-f]+)$/i,yn=/^0o?([0-7]+)$/i,hn=a(["in","instanceof","typeof","new","void","delete","++","--","+","-","!","~","&","|","^","*","/","%","**",">>","<<",">>>","<",">","<=",">=","==","===","!=","!==","?","=","+=","-=","/=","*=","%=","**=",">>=","<<=",">>>=","&=","|=","^=","&&","||","??","&&=","||=","??="]),bn="\n\r\u2028\u2029",gn="+-*&%=<>!?|~^",xn=",;:)}]",Dn="[{(,;:",Cn=Dn+"`)}]",En=bn+"  \t\f\v​             　\ufeff",In=a(t("./'\"#"+gn+Cn+En));function On(e){return e>=48&&e<=57}function Pn(e){return!In[e]}function Fn(e){return/^[a-z_$][a-z0-9_$]*$/i.test(e)}function Nn(e,n,t,r,a){this.message=e,this.filename=n,this.line=t,this.col=r,this.pos=a}function Gn(e,n,t,r,a){throw new Nn(e,n,t,r,a)}function jn(e,n,t){return e.type==n&&(null==t||e.value==t)}bn=a(t(bn)),gn=a(t(gn)),xn=a(t(xn)),Dn=a(t(Dn)),Cn=a(t(Cn)),En=a(t(En)),Nn.prototype=Object.create(Error.prototype),Nn.prototype.constructor=Nn,Nn.prototype.name="SyntaxError",i(Nn);var Un={};function Rn(e,n,t,r){var a={text:e,filename:n,pos:0,tokpos:0,line:1,tokline:0,col:0,tokcol:0,newline_before:!1,regex_allowed:!1,comments_before:[],directives:Object.create(null),read_template:b("Unterminated template literal",function(e){for(var n="";;){var t=r();switch(t){case"\\":t+=r();break;case"`":return void e.push(n);case"$":if("{"==i())return s(),e.push(n),a.regex_allowed=!0,!0}n+=t}function r(){var e=s(!0,!0);return"\r"==e?"\n":e}})},o=!1;function i(){return a.text.charAt(a.pos)}function s(e,n){var t=a.text.charAt(a.pos++);if(e&&!t)throw Un;return bn[t]?(a.col=0,a.line++,n||(a.newline_before=!0),"\r"==t&&"\n"==i()&&(a.pos++,t="\n")):a.col++,t}function u(e){for(;e-- >0;)s()}function c(e){return a.text.substr(a.pos,e.length)==e}function l(){a.tokline=a.line,a.tokcol=a.col,a.tokpos=a.pos}function f(t,r,i){a.regex_allowed="operator"==t&&!Mn[r]||"keyword"==t&&wn[r]||"punc"==t&&Dn[r],"punc"==t&&"."==r?o=!0:i||(o=!1);var s={type:t,value:r,line:a.tokline,col:a.tokcol,pos:a.tokpos,endline:a.line,endcol:a.col,endpos:a.pos,nlb:a.newline_before,file:n};return/^(?:num|string|regexp)$/i.test(t)&&(s.raw=e.substring(s.pos,s.endpos)),i||(s.comments_before=a.comments_before,s.comments_after=a.comments_before=[]),a.newline_before=!1,new Qe(s)}function p(){for(;En[i()];)s()}function _(e){Gn(e,n,a.tokline,a.tokcol,a.tokpos)}function d(e){return/^0[0-7_]+$/.test(e)}function v(e){var n=!1,t=!1,r=!1,a="."==e,o=function(e){for(var n,t="";(n=i())&&e(n,t);)t+=s();return t}(function(e,o){switch(e){case"x":case"X":return!r&&(r=!0);case"e":case"E":return!!r||!n&&(n=t=!0);case"+":case"-":return t;case t=!1,".":return!(a||n||r||d(o))&&(a=!0)}return/[_0-9a-dfo]/i.test(e)});e&&(o=e+o),d(o)?g.has_directive("use strict")&&_("Legacy octal literals are not allowed in strict mode"):o=o.replace(r?/([1-9a-f]|.0)_(?=[0-9a-f])/gi:/([1-9]|.0)_(?=[0-9])/gi,"$1");var u=function(e){var n;if(n=Tn.exec(e))return parseInt(n[1],2);if(n=kn.exec(e))return parseInt(n[1],16);if(n=yn.exec(e))return parseInt(n[1],8);var t=parseFloat(e);return t==e?t:void 0}(o);return isNaN(u)&&_("Invalid syntax: "+o),a||n||"n"!=i()?f("num",u):f("bigint",o.toLowerCase()+s())}function m(e){var n=s(!0,e);if(n>="0"&&n<="7")return function(e){var n=i();n>="0"&&n<="7"&&(e+=s(!0))[0]<="3"&&(n=i())>="0"&&n<="7"&&(e+=s(!0));if("0"===e)return"\0";e.length>0&&g.has_directive("use strict")&&_("Legacy octal escape sequences are not allowed in strict mode");return String.fromCharCode(parseInt(e,8))}(n);if("u"==n){var t=s(!0,e);if(n+=t,"{"!=t)n+=s(!0,e)+s(!0,e)+s(!0,e);else do{n+=t=s(!0,e)}while("}"!=t)}else"x"==n&&(n+=s(!0,e)+s(!0,e));var r=function(e){switch(e[0]){case"b":return"\b";case"f":return"\f";case"n":return"\n";case"r":return"\r";case"t":return"\t";case"u":var n;if("{"==e[1]&&"}"==e.slice(-1))n=e.slice(2,-1);else{if(5!=e.length)return;n=e.slice(1)}if((t=parseInt(n,16))<0||isNaN(t))return;if(t<65536)return String.fromCharCode(t);if(t>1114111)return;return String.fromCharCode(55232+(t>>10))+String.fromCharCode(56320+(1023&t));case"v":return"\v";case"x":if(3!=e.length)return;var t;if((t=parseInt(e.slice(1),16))<0||isNaN(t))return;return String.fromCharCode(t);case"\r":case"\n":return"";default:if("0"==e)return"\0";if(e[0]>="0"&&e[0]<="9")return;return e}}(n);return"string"!=typeof r&&_("Invalid escape sequence: \\"+n),r}var S=b("Unterminated string constant",function(e){for(var n=s(),t="";;){var r=s(!0,!0);if("\\"==r)r=m(!0);else if(bn[r])_("Unterminated string constant");else if(r==n)break;t+=r}var a=f("string",t);return a.quote=e,a});function A(e){var n,t=a.regex_allowed,r=function(){for(var e=a.text,n=a.pos;n<a.text.length;++n)if(bn[e[n]])return n;return-1}();return-1==r?(n=a.text.substr(a.pos),a.pos=a.text.length):(n=a.text.substring(a.pos,r),a.pos=r),a.col=a.tokcol+(a.pos-a.tokpos),a.comments_before.push(f(e,n,!0)),a.regex_allowed=t,g}var w=b("Unterminated multiline comment",function(){var e=a.regex_allowed,n=function(e,n){var t=a.text.indexOf(e,a.pos);if(n&&-1==t)throw Un;return t}("*/",!0),t=a.text.substring(a.pos,n).replace(/\r\n|\r|\u2028|\u2029/g,"\n");return u(t.length+2),a.comments_before.push(f("comment2",t,!0)),a.regex_allowed=e,g});function T(){for(var e,n=!1,t=!1,r="#"==i()?s():"";e=i();)if(n)"u"!=e&&_("Expecting UnicodeEscapeSequence -- uXXXX"),Pn(e=m())||_("Unicode char: "+e.charCodeAt(0)+" is not valid in identifier"),r+=e,n=!1;else if("\\"==e)t=n=!0,s();else{if(!Pn(e))break;r+=s()}if(mn[r]&&t){var a=r.charCodeAt(0).toString(16).toUpperCase();r="\\u"+"0000".substr(a.length)+a+r.slice(1)}return r}var k=b("Unterminated regular expression",function(e){for(var n,t=!1,r=!1;n=s(!0);)if(bn[n])_("Unexpected line terminator");else if(t)e+="\\"+n,t=!1;else if("["==n)r=!0,e+=n;else if("]"==n&&r)r=!1,e+=n;else{if("/"==n&&!r)break;"\\"==n?t=!0:e+=n}var a=T();try{var o=new RegExp(e,a);return o.raw_source=e,f("regexp",o)}catch(e){_(e.message)}});function y(e){return f("operator",function e(n){if(!i())return n;var t=n+i();return hn[t]?(s(),e(t)):n}(e||s()))}function h(){switch(s(),i()){case"/":return s(),A("comment1");case"*":return s(),w()}return a.regex_allowed?k(""):y("/")}function b(e,n){return function(t){try{return n(t)}catch(n){if(n!==Un)throw n;_(e)}}}function g(e){if(null!=e)return k(e);for(r&&0==a.pos&&c("#!")&&(l(),u(2),A("comment5"));;){if(p(),l(),t){if(c("\x3c!--")){u(4),A("comment3");continue}if(c("--\x3e")&&a.newline_before){u(3),A("comment4");continue}}var n=i();if(!n)return f("eof");var d=n.charCodeAt(0);switch(d){case 34:case 39:return S(n);case 46:return s(),c("..")?f("operator","."+s()+s()):On(i().charCodeAt(0))?v("."):f("punc",".");case 47:var m=h();if(m===g)continue;return m}if(On(d))return v();if(Cn[n])return f("punc",s());if(c("=>"))return f("punc",s()+s());if(gn[n])return y();if(35==d||92==d||!In[n])return void 0,w=T(),o?f("name",w):Sn[w]?f("atom",w):mn[w]?hn[w]?f("operator",w):f("keyword",w):f("name",w);break}var w;_("Unexpected character '"+n+"'")}return g.context=function(e){return e&&(a=e),a},g.add_directive=function(e){a.directives[e]=!0},g.push_directives_stack=function(){a.directives=Object.create(a.directives)},g.pop_directives_stack=function(){a.directives=Object.getPrototypeOf(a.directives)},g.has_directive=function(e){return!!a.directives[e]},g}var Vn=a("typeof void delete -- ++ ! ~ - +"),Mn=a("-- ++"),Ln=a("= += -= /= *= %= **= >>= <<= >>>= &= |= ^= &&= ||= ??="),$n=function(e,n){for(var t=0;t<e.length;)for(var r=e[t++],a=0;a<r.length;a++)n[r[a]]=t;return n}([["??"],["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],["<",">","<=",">=","in","instanceof"],[">>","<<",">>>"],["+","-"],["*","/","%"],["**"]],{}),Yn=a("atom bigint num regexp string");function qn(e,n){n=r(n,{bare_returns:!1,expression:!1,filename:null,html5_comments:!0,module:!1,shebang:!0,strict:!1,toplevel:null},!0);var t={input:"string"==typeof e?Rn(e,n.filename,n.html5_comments,n.shebang):e,in_async:!1,in_directives:!0,in_funarg:-1,in_function:0,in_generator:!1,in_loop:0,labels:[],peeked:null,prev:null,token:null};function a(e,n){return jn(t.token,e,n)}function o(){return t.peeked||(t.peeked=t.input())}function i(){return t.prev=t.token,t.peeked?(t.token=t.peeked,t.peeked=null):t.token=t.input(),t.in_directives=t.in_directives&&("string"==t.token.type||a("punc",";")),t.token}function k(){return t.prev}function h(e,n,r,a){var o=t.input.context();Gn(e,o.filename,null!=n?n:o.tokline,null!=r?r:o.tokcol,null!=a?a:o.tokpos)}function b(e,n){h(n,e.line,e.col)}function g(e,n){return e+(void 0===n?"":" «"+n+"»")}function x(e){null==e&&(e=t.token),b(e,"Unexpected token: "+g(e.type,e.value))}function D(e,n){if(a(e,n))return i();b(t.token,"Unexpected token: "+g(t.token.type,t.token.value)+", expected: "+g(e,n))}function C(e){return D("punc",e)}function E(e){return e.nlb||!u(e.comments_before,function(e){return!e.nlb})}function I(){return!n.strict&&(a("eof")||a("punc","}")||E(t.token))}function j(e){a("punc",";")?i():e||I()||C(";")}function M(){C("(");var e=zn();return C(")"),e}function q(e){return function(){var n=t.token,r=e.apply(null,arguments),a=k();return r.start=n,r.end=a,r}}function B(){(a("operator","/")||a("operator","/="))&&(t.peeked=null,t.token=t.input(t.token.value.substr(1)))}t.token=i();var z=q(function(e){switch(B(),t.token.type){case"string":var r=t.in_directives,s=zn();if(r)if(s instanceof xe){var c=s.start.raw.slice(1,-1);t.input.add_directive(c),s.value=c}else t.in_directives=r=!1;return j(),r?new L(s):new ge({body:s});case"num":case"bigint":case"regexp":case"operator":case"atom":return re();case"name":switch(t.token.value){case"async":if(jn(o(),"keyword","function"))return i(),i(),a("operator","*")?(i(),Re(AST_AsyncGeneratorDefun)):Re(AST_AsyncDefun);break;case"await":if(t.in_async)return re();break;case"export":return e||""===n.module||x(),i(),function(){if(a("operator","*")){var e=t.token,n=e;return i(),a("name","as")&&(i(),Le()||D("name"),n=t.token,i()),D("name","from"),new AST_ExportForeign({aliases:[qe(n)],keys:[qe(e)],path:ze()})}if(a("punc","{")){i();for(var r=[],s=[];Le();){var e=t.token;i(),s.push(e),a("name","as")?(i(),Le()||D("name"),r.push(t.token),i()):r.push(e),a("punc","}")||C(",")}return C("}"),a("name","from")?(i(),new AST_ExportForeign({aliases:r.map(qe),keys:s.map(qe),path:ze()})):(j(),new AST_ExportReferences({properties:s.map(function(e,n){jn(e,"name")||b(e,"Name expected");var t=hn(Ue,e);return t.alias=qe(r[n]),t})}))}if(a("keyword","default")){i();var u=t.token,c=function(){if(a("name","async")){if(!jn(o(),"keyword","function"))return;return i(),i(),a("operator","*")?(i(),We(AST_AsyncGeneratorDefun,Re(AST_AsyncGeneratorFunction))):We(AST_AsyncDefun,Re(AST_AsyncFunction))}if(a("keyword"))switch(t.token.value){case"class":return i(),We(U,Ae(y));case"function":return i(),a("operator","*")?(i(),We(AST_GeneratorDefun,Re(AST_GeneratorFunction))):We(V,Re(Z))}}();return c?(c.start=u,c.end=k()):(B(),c=zn(),j()),new AST_ExportDefault({body:c})}return new AST_ExportDeclaration({body:He()})}();case"import":var l=o();if("punc"==l.type&&/^[(.]$/.test(l.value))break;return e||""===n.module||x(),i(),function(){var e,n=null,r=gn(Me,!0),s=null;r?(r.key=new xe({start:r.start,value:"",end:r.end}),(e=a("punc",","))&&i()):e=!a("string");if(e)if(a("operator","*")){var u=t.token;i(),D("name","as"),(n=gn(Me)).key=qe(u)}else{for(C("{"),s=[];Le();){var c;if(jn(o(),"name","as")){var u=t.token;i(),i(),(c=gn(Me)).key=qe(u)}else(c=gn(Me)).key=new xe({start:c.start,value:c.name,end:c.end});s.push(c),a("punc","}")||C(",")}C("}")}(n||r||s)&&D("name","from");return new te({all:n,default:r,path:ze(),properties:s})}();case"let":if(pn()){i();var f=dn();return j(),f}break;case"yield":if(t.in_generator)return re()}return jn(o(),"punc",":")?function(){var e=gn(oe);u(t.labels,function(n){return n.name!=e.name})||h("Label "+e.name+" defined twice");C(":"),t.labels.push(e);var n=z();t.labels.pop(),n instanceof ae||e.references.forEach(function(n){n instanceof F&&b(n.label.start,"Continue label `"+e.name+"` must refer to IterationStatement")});return new ie({body:n,label:e})}():re();case"punc":switch(t.token.value){case"{":return new m({start:t.token,body:Qe(),end:k()});case"[":case"(":case"`":return re();case";":return t.in_directives=!1,i(),new K;default:x()}case"keyword":switch(t.token.value){case"break":return i(),ce(S);case"class":return i(),Ae(U);case"const":i();f=_n();return j(),f;case"continue":return i(),ce(F);case"debugger":return i(),j(),new N;case"do":i();s=Wn(z);D("keyword","while");var p=M();return j(!0),new $({body:s,condition:p});case"while":return i(),new un({condition:M(),body:Wn(z)});case"for":return i(),function(){var e=a("name","await")&&i();C("(");var n=null;if(e||!a("punc",";")){var t;if(n=a("keyword","const")?(i(),_n(!0)):a("name","let")&&pn()?(i(),dn(!0)):a("keyword","var")?(i(),vn(!0)):zn(!0),e?(D("name","of"),t=AST_ForAwaitOf):a("operator","in")?(i(),t=J):a("name","of")&&(i(),t=Q),t)return n instanceof R?(n.definitions.length>1&&b(n.start,"Only one variable declaration allowed in for..in/of loop"),t!==J&&n.definitions[0].value&&b(n.definitions[0].value.start,"No initializers allowed in for..of loop")):qn(n)||(n=Kn(n))instanceof AST_Destructured||b(n.start,"Invalid left-hand side in for..in/of loop"),function(e,n){B();var t=zn();return C(")"),new e({init:n,object:t,body:Wn(z)})}(t,n)}return function(e){C(";");var n=a("punc",";")?null:zn();C(";");var t=a("punc",")")?null:zn();return C(")"),new H({init:e,condition:n,step:t,body:Wn(z)})}(n)}();case"function":return i(),a("operator","*")?(i(),Re(AST_GeneratorDefun)):Re(V);case"if":return i(),function(){var e=M(),n=z(),t=null;a("keyword","else")&&(i(),t=z());return new ne({condition:e,body:n,alternative:t})}();case"return":0!=t.in_function||n.bare_returns||h("'return' outside of function"),i();c=null;return a("punc",";")?i():I()||(c=zn(),j()),new he({value:c});case"switch":return i(),new Ee({expression:M(),body:Wn(tn)});case"throw":i(),E(t.token)&&h("Illegal newline after 'throw'");c=zn();return j(),new Je({value:c});case"try":return i(),function(){var e=Qe(),n=null,r=null;if(a("keyword","catch")){var o=t.token;i();var s=null;a("punc","(")&&(i(),s=Dn(Ie),C(")")),n=new T({start:o,argname:s,body:Qe(),end:k()})}if(a("keyword","finally")){var o=t.token;i(),r=new X({start:o,body:Qe(),end:k()})}n||r||h("Missing catch/finally blocks");return new nn({body:e,bcatch:n,bfinally:r})}();case"var":i();f=vn();return j(),f;case"with":return t.input.has_directive("use strict")&&h("Strict mode may not include a with statement"),i(),new cn({expression:M(),body:z()})}}x()});function re(){var e=zn();return j(),new ge({body:e})}function ce(e){var n,r=null;I()||(r=gn(se,!0)),null!=r?((n=find_if(function(e){return e.name==r.name},t.labels))||b(r.start,"Undefined label "+r.name),r.thedef=n):0==t.in_loop&&h(e.TYPE+" not inside a loop or switch"),j();var a=new e({label:r});return n&&n.references.push(a),a}function pe(e,n){if(a("name",e)){var t=o();if(t&&!jn(t,"operator","=")&&!("punc"==t.type&&/^[(;}]$/.test(t.value)||n&&E(t)))return i()}}function Ae(e){var n,r=t.in_async,o=t.in_generator;t.input.push_directives_stack(),t.input.add_directive("use strict"),n=e===U?gn(Ge):gn(Oe,!0);var s=null;a("keyword","extends")&&(i(),B(),s=Sn(!0)),C("{");for(var u=[];!a("punc","}");)if(a("punc",";"))i();else{var c=t.token,l=!!pe("static"),f=pe("async",!0);if(a("operator","*")){i();var p=a("name")&&/^#/.test(t.token.value),_=yn(),d=t.token,v=Re(f?AST_AsyncGeneratorFunction:AST_GeneratorFunction);v.start=d,v.end=k(),u.push(new AST_ClassMethod({start:c,static:l,private:p,key:_,value:v,end:k()}))}else if(l&&a("punc","{"))u.push(new AST_ClassInit({start:c,value:new AST_ClassInitBlock({start:c,body:Qe(),end:k()}),end:k()}));else{p=a("name")&&/^#/.test(t.token.value),_=yn();if(a("punc","(")){var m=t.token,S=Re(f?AST_AsyncFunction:Z);S.start=m,S.end=k(),u.push(new AST_ClassMethod({start:c,static:l,private:p,key:_,value:S,end:k()}))}else{f&&x(f);var A=null;if(a("operator","="))i(),t.in_async=!1,t.in_generator=!1,A=Bn(),t.in_generator=o,t.in_async=r;else if(!a("punc",";")&&!a("punc","}")){var w=null;switch(_){case"get":w=AST_ClassGetter;break;case"set":w=AST_ClassSetter}if(w){u.push(new w({start:c,static:l,private:a("name")&&/^#/.test(t.token.value),key:yn(),value:Tn(),end:k()}));continue}}j(),u.push(new AST_ClassField({start:c,static:l,private:p,key:_,value:A,end:k()}))}}}return i(),t.input.pop_directives_stack(),t.in_generator=o,t.in_async=r,new e({extends:s,name:n,properties:u})}function Te(e){if(e instanceof l){var n=null;return e.elements[e.elements.length-1]instanceof AST_Spread&&(n=Te(e.elements.pop().expression)),new AST_DestructuredArray({start:e.start,elements:e.elements.map(Te),rest:n,end:e.end})}if(e instanceof p)return new AST_DefaultValue({start:e.start,name:Te(e.left),value:e.right,end:e.end});if(e instanceof AST_DefaultValue)return e.name=Te(e.name),e;if(e instanceof AST_DestructuredArray)return e.elements=e.elements.map(Te),e.rest&&(e.rest=Te(e.rest)),e;if(e instanceof AST_DestructuredObject)return e.properties.forEach(function(e){e.value=Te(e.value)}),e.rest&&(e.rest=Te(e.rest)),e;if(e instanceof ee)return e;if(e instanceof ve){n=null;return e.properties[e.properties.length-1]instanceof AST_Spread&&(n=Te(e.properties.pop().expression)),new AST_DestructuredObject({start:e.start,properties:e.properties.map(function(e){return e instanceof Se||b(e.start,"Invalid destructuring assignment"),new AST_DestructuredKeyVal({start:e.start,key:e.key,value:Te(e.value),end:e.end})}),rest:n,end:e.end})}return e instanceof Ve?e:e instanceof Ke?new Ve(e):e instanceof ln?new Ve({start:e.start,name:"yield",end:e.end}):void b(e.start,"Invalid arrow parameter")}function Pe(e,n,r){var o=t.in_async,i=t.in_generator;t.in_async=r,t.in_generator=!1;var s=t.in_funarg;t.in_funarg=t.in_function;var u,c,l=e.map(Te),p=e.rest||null;p&&(p=Te(p)),t.in_funarg=s,C("=>");var _=t.in_loop,d=t.labels;++t.in_function,t.input.push_directives_stack(),t.in_loop=0,t.labels=[],a("punc","{")?(t.in_directives=!0,u=Qe(),c=null):(u=[],B(),c=Bn());var v=t.input.has_directive("use strict");t.input.pop_directives_stack(),--t.in_function,t.in_loop=_,t.labels=d,t.in_generator=i,t.in_async=o;var m=new(r?AST_AsyncArrow:f)({start:n,argnames:l,rest:p,body:u,value:c,end:k()});return v&&m.each_argname(bn),m}var Re=function(e){var r,a=t.in_async,o=t.in_generator;/Defun$/.test(e.TYPE)?(r=gn(je),t.in_async=/^Async/.test(e.TYPE),t.in_generator=/Generator/.test(e.TYPE)):(t.in_async=/^Async/.test(e.TYPE),t.in_generator=/Generator/.test(e.TYPE),r=gn($e,!0)),!r||e===c||r instanceof Ne||x(k()),C("(");var i=t.in_funarg;t.in_funarg=t.in_function;var s=An(")",!n.strict,!1,function(){return Cn(Ve)});t.in_funarg=i;var u=t.in_loop,l=t.labels;++t.in_function,t.in_directives=!0,t.input.push_directives_stack(),t.in_loop=0,t.labels=[];var f=Qe(),p=t.input.has_directive("use strict");t.input.pop_directives_stack(),--t.in_function,t.in_loop=u,t.labels=l,t.in_generator=o,t.in_async=a;var _=new e({name:r,argnames:s,rest:s.rest||null,body:f});return p&&(r&&bn(r),_.each_argname(bn)),_};function Le(){return a("name")||a("string")||Fn(t.token.value)}function qe(e){return new xe({start:e,quote:e.quote,value:e.value,end:e})}function ze(){var e=t.token;return D("string"),j(),qe(e)}function We(e,n){return n.name&&((n=new e(n)).name=new(e===U?Ge:je)(n.name)),n}var He=q(function(){if(a("name"))switch(t.token.value){case"async":return i(),D("keyword","function"),a("operator","*")?(i(),Re(AST_AsyncGeneratorDefun)):Re(AST_AsyncDefun);case"let":i();var e=dn();return j(),e}else if(a("keyword"))switch(t.token.value){case"class":return i(),Ae(U);case"const":i();e=_n();return j(),e;case"function":return i(),a("operator","*")?(i(),Re(AST_GeneratorDefun)):Re(V);case"var":i();e=vn();return j(),e}x()});function Qe(){C("{");for(var e=[];!a("punc","}");)a("eof")&&C("}"),e.push(z());return i(),e}function tn(){C("{");for(var e,n,r,o,s=[];!a("punc","}");)a("eof")&&C("}"),a("keyword","case")?(e&&(e.end=k()),n=[],e=new w({start:(o=t.token,i(),o),expression:zn(),body:n}),s.push(e),C(":")):a("keyword","default")?(e&&(e.end=k()),r&&h("More than one default clause in switch statement"),n=[],e=new G({start:(o=t.token,i(),C(":"),o),body:n}),s.push(e),r=e):(n||x(),n.push(z()));return e&&(e.end=k()),i(),s}function fn(e,n){for(var r=[];;){var o=t.token,s=Dn(e),u=null;if(a("operator","=")?(i(),u=Bn(n)):!n&&(e===Fe||s instanceof AST_Destructured)&&h("Missing initializer in declaration"),r.push(new sn({start:o,name:s,value:u,end:k()})),!a("punc",","))break;i()}return r}function pn(){var e=o();return jn(e,"name")||jn(e,"punc","[")||jn(e,"punc","{")}var _n=function(e){return new P({start:k(),definitions:fn(Fe,e),end:k()})},dn=function(e){return new ue({start:k(),definitions:fn(Ye,e),end:k()})},vn=function(e){return new on({start:k(),definitions:fn(Be,e),end:k()})};var Sn=function(e){if(a("operator","new"))return function(e){var r,s=t.token;if(D("operator","new"),a("punc",".")&&jn(o(),"name","target"))i(),i(),r=new fe;else{var u,c=Sn(!1);a("punc","(")?(i(),u=An(")",!n.strict)):u=[],r=new le({expression:c,args:u})}return r.start=s,r.end=k(),In(r,e)}(e);var r=t.token;if(a("punc")){switch(r.value){case"`":return In(En(null),e);case"(":if(i(),a("punc",")"))return i(),Pe([],r);var s=zn(!1,!0),u=r.comments_before.length;if([].unshift.apply(s.start.comments_before,r.comments_before),r.comments_before.length=0,r.comments_before=s.start.comments_before,r.comments_before_length=u,0==u&&r.comments_before.length>0){var c=r.comments_before[0];c.nlb||(c.nlb=r.nlb,r.nlb=!1)}r.comments_after=s.start.comments_after,s.start=r,C(")");var l=k();return l.comments_before=s.end.comments_before,l.comments_after.forEach(function(e){s.end.comments_after.push(e),e.nlb&&(t.token.nlb=!0)}),l.comments_after.length=0,l.comments_after=s.end.comments_after,s.end=l,a("punc","=>")?Pe(s instanceof be?s.expressions:[s],r):In(s,e);case"[":return In(wn(),e);case"{":return In(kn(),e)}x()}if(a("keyword"))switch(r.value){case"class":i();var f=Ae(y);return f.start=r,f.end=k(),In(f,e);case"function":return i(),a("operator","*")?(i(),_=Re(AST_GeneratorFunction)):_=Re(Z),_.start=r,_.end=k(),In(_,e)}if(a("name")){var p=hn(Ke,r);if(i(),"async"==p.name){var _;if(a("keyword","function"))return i(),a("operator","*")?(i(),_=Re(AST_AsyncGeneratorFunction)):_=Re(AST_AsyncFunction),_.start=r,_.end=k(),In(_,e);if(a("name")&&jn(o(),"punc","=>"))return r=t.token,p=hn(Ke,r),i(),Pe([p],r,!0);if(a("punc","(")){var v=In(p,e);if(!a("punc","=>"))return v;var m=v.args;return m[m.length-1]instanceof AST_Spread&&(m.rest=m.pop().expression),Pe(m,r,!0)}}return a("punc","=>")?Pe([p],r):In(p,e)}if(Yn[t.token.type])return In(function(){var e,n=t.token,r=n.value;switch(n.type){case"num":isFinite(r)?e=new de({value:r}):(e=new AST_Infinity,r<0&&(e=new an({operator:"-",expression:e})));break;case"bigint":e=new d({value:r});break;case"string":e=new xe({value:r,quote:n.quote});break;case"regexp":e=new ye({value:r});break;case"atom":switch(r){case"false":e=new W;break;case"true":e=new en;break;case"null":e=new _e;break;default:x()}break;default:x()}return i(),e.start=e.end=n,e}(),e);x()};function An(e,n,r,o){o||(o=Bn);for(var s=!0,u=[];!a("punc",e)&&(s?s=!1:C(","),!n||!a("punc",e));)if(r&&a("punc",","))u.push(new ee({start:t.token,end:t.token}));else if(a("operator","...")){if(o!==Bn){i(),u.rest=o(),u.rest instanceof AST_DefaultValue&&b(u.rest.start,"Invalid rest parameter");break}u.push(new AST_Spread({start:t.token,expression:(i(),o()),end:k()}))}else u.push(o());return C(e),u}var wn=q(function(){return C("["),new l({elements:An("]",!n.strict,!0)})}),Tn=q(function(){return Re(c)}),kn=q(function(){C("{");for(var e=!0,r=[];!a("punc","}")&&(e?e=!1:C(","),n.strict||!a("punc","}"));){var s=t.token;if(a("operator","*")){i();var u=yn(),c=t.token,l=Re(AST_GeneratorFunction);l.start=c,l.end=k(),r.push(new AST_ObjectMethod({start:s,key:u,value:l,end:k()}))}else if(a("operator","..."))i(),r.push(new AST_Spread({start:s,expression:Bn(),end:k()}));else if(jn(o(),"operator","=")){var f=gn(Ke);i(),r.push(new Se({start:s,key:s.value,value:new p({start:s,left:f,operator:"=",right:Bn(),end:k()}),end:k()}))}else if(jn(o(),"punc",",")||jn(o(),"punc","}"))r.push(new Se({start:s,key:s.value,value:gn(Ke),end:k()}));else{u=yn();if(a("punc","(")){var _=t.token;(v=Re(Z)).start=_,v.end=k(),r.push(new AST_ObjectMethod({start:s,key:u,value:v,end:k()}))}else if(a("punc",":"))i(),r.push(new Se({start:s,key:u,value:Bn(),end:k()}));else{if("name"==s.type)switch(u){case"async":var d=a("operator","*")&&i();u=yn();var v;_=t.token;(v=Re(d?AST_AsyncGeneratorFunction:AST_AsyncFunction)).start=_,v.end=k(),r.push(new AST_ObjectMethod({start:s,key:u,value:v,end:k()}));continue;case"get":r.push(new me({start:s,key:yn(),value:Tn(),end:k()}));continue;case"set":r.push(new we({start:s,key:yn(),value:Tn(),end:k()}));continue}x()}}}return i(),new ve({properties:r})});function yn(){var e=t.token;switch(e.type){case"operator":mn[e.value]||x();case"num":case"string":case"name":case"keyword":case"atom":return i(),""+e.value;case"punc":C("[");var n=Bn();return C("]"),n;default:x()}}function hn(e,n){var r=n.value;switch(r){case"await":t.in_async&&x(n);break;case"super":e=Ce;break;case"this":e=Xe;break;case"yield":t.in_generator&&x(n)}return new e({name:""+r,start:n,end:n})}function bn(e){"arguments"!=e.name&&"eval"!=e.name&&"let"!=e.name||b(e.start,"Unexpected "+e.name+" in strict mode")}function gn(e,n){if(!a("name"))return n||h("Name expected"),null;var r=hn(e,t.token);return t.input.has_directive("use strict")&&r instanceof Ne&&bn(r),i(),r}function Dn(e){var r=t.token;if(a("punc","[")){i();var s=An("]",!n.strict,!0,function(){return Cn(e)});return new AST_DestructuredArray({start:r,elements:s,rest:s.rest||null,end:k()})}if(a("punc","{")){i();for(var u=!0,c=[],l=null;!a("punc","}")&&(u?u=!1:C(","),n.strict||!a("punc","}"));){var f=t.token;if(a("punc","[")||jn(o(),"punc",":")){var p=yn();C(":"),c.push(new AST_DestructuredKeyVal({start:f,key:p,value:Cn(e),end:k()}))}else{if(a("operator","...")){i(),l=Dn(e);break}var _=gn(e);a("operator","=")&&(i(),_=new AST_DefaultValue({start:_.start,name:_,value:Bn(),end:k()})),c.push(new AST_DestructuredKeyVal({start:f,key:f.value,value:_,end:k()}))}}return C("}"),new AST_DestructuredObject({start:r,properties:c,rest:l,end:k()})}return gn(e)}function Cn(e){var n=t.token,r=Dn(e);return a("operator","=")?(i(),new AST_DefaultValue({start:n,name:r,value:Bn(),end:k()})):r}function En(e){for(var n=e?e.start:t.token,r=t.input.context().read_template,o=[],s=[];r(o);)i(),s.push(zn()),a("punc","}")||x();return i(),new AST_Template({start:n,expressions:s,strings:o,tag:e,end:k()})}function In(e,r){for(var u,c=e.start,l=null;;)if(a("operator","?")&&jn(o(),"punc",".")&&(i(),i(),l=e),a("punc","[")){i();var f=zn();C("]"),e=new De({start:c,optional:l===e,expression:e,property:f,end:k()})}else if(r&&a("punc","("))i(),e=new A({start:c,optional:l===e,expression:e,args:An(")",!n.strict),end:k()});else if(l===e||a("punc","."))l!==e&&i(),e=new Y({start:c,optional:l===e,expression:e,property:(void 0,u=t.token.value,D("name"),u),end:k()});else{if(!a("punc","`"))break;l&&h("Invalid template on optional chain"),e=En(e)}if(l&&(e.terminal=!0),e instanceof A&&!e.pure)for(var p=(c=e.start).comments_before,_=s(c,"comments_before_length")?c.comments_before_length:p.length;--_>=0;)if(/[@#]__PURE__/.test(p[_].value)){e.pure=!0;break}return e}function On(e){var n=t.token;if(t.in_async&&a("name","await"))return t.in_funarg===t.in_function&&h("Invalid use of await in function argument"),t.input.context().regex_allowed=!0,i(),new _({start:n,expression:On(e),end:k()});if(t.in_generator&&a("name","yield")){t.in_funarg===t.in_function&&h("Invalid use of yield in function argument"),t.input.context().regex_allowed=!0,i();var r=null,o=!1;return a("operator","*")?(i(),r=Bn(e),o=!0):(a("punc")?xn[t.token.value]:I())||(r=Bn(e)),new ln({start:n,expression:r,nested:o,end:k()})}if(a("operator")&&Vn[n.value]){i(),B();var s=Pn(an,n,On(e));return s.start=n,s.end=k(),s}for(var u=Sn(!0);a("operator")&&Mn[t.token.value]&&!E(t.token);)(u=Pn(rn,t.token,u)).start=n,u.end=t.token,i();return u}function Pn(e,n,r){var a=n.value;switch(a){case"++":case"--":qn(r)||b(n,"Invalid use of "+a+" operator");break;case"delete":r instanceof Ke&&t.input.has_directive("use strict")&&b(r.start,"Calling delete on expression not allowed in strict mode")}return new e({operator:a,expression:r})}var Nn=function(e,n,r){var o=a("operator")?t.token.value:null;"in"==o&&r&&(o=null);var s=null!=o?$n[o]:null;if(null!=s&&s>n){i();var u=Nn(On(r),"**"==o?s-1:s,r);return Nn(new v({start:e.start,left:e,operator:o,right:u,end:u.end}),n,r)}return e};var Un=function(e){var n=t.token,r=function(e){return Nn(On(e),0,e)}(e);if(a("operator","?")){i();var o=Bn();return C(":"),new O({start:n,condition:r,consequent:o,alternative:Bn(e),end:k()})}return r};function qn(e){return e instanceof ke&&!e.optional||e instanceof Ke}function Kn(e){if(e instanceof l){var n=null;if(e.elements[e.elements.length-1]instanceof AST_Spread&&!((n=Kn(e.elements.pop().expression))instanceof AST_Destructured||qn(n)))return e;var t=e.elements.map(Kn);return u(t,function(e){return e instanceof AST_DefaultValue||e instanceof AST_Destructured||e instanceof ee||qn(e)})?new AST_DestructuredArray({start:e.start,elements:t,rest:n,end:e.end}):e}if(e instanceof p){var r=Kn(e.left);return r instanceof AST_Destructured||qn(r)?new AST_DefaultValue({start:e.start,name:r,value:e.right,end:e.end}):e}if(!(e instanceof ve))return e;n=null;if(e.properties[e.properties.length-1]instanceof AST_Spread&&!((n=Kn(e.properties.pop().expression))instanceof AST_Destructured||qn(n)))return e;for(var a=[],o=0;o<e.properties.length;o++){var i=e.properties[o];if(!(i instanceof Se))return e;var s=Kn(i.value);if(!(s instanceof AST_DefaultValue||s instanceof AST_Destructured||qn(s)))return e;a.push(new AST_DestructuredKeyVal({start:i.start,key:i.key,value:s,end:i.end}))}return new AST_DestructuredObject({start:e.start,properties:a,rest:n,end:e.end})}function Bn(e){var n=t.token,r=Un(e),o=t.token.value;if(a("operator")&&Ln[o]){if(qn(r)||"="==o&&(r=Kn(r))instanceof AST_Destructured)return i(),new p({start:n,left:r,operator:o,right:Bn(e),end:k()});h("Invalid assignment")}return r}function zn(e,n){for(var r=t.token,s=[];;){if(n&&a("operator","...")){i(),s.rest=Dn(Ve);break}if(s.push(Bn(e)),!a("punc",","))break;if(i(),n&&a("punc",")")&&jn(o(),"punc","=>"))break}return 1!=s.length||s.rest?new be({start:r,expressions:s,end:k()}):s[0]}function Wn(e){++t.in_loop;var n=e();return--t.in_loop,n}if(n.expression){B();var Xn=zn();return D("eof"),Xn}return function(){var e=t.token,r=[];for(n.module&&(t.in_async=!0,t.input.add_directive("use strict")),t.input.push_directives_stack();!a("eof");)r.push(z(!0));t.input.pop_directives_stack();var o=k()||e,i=n.toplevel;return i?(i.body=i.body.concat(r),i.end=o):i=new Ze({start:e,body:r,end:o}),i}()}return n.parse=qn,{is_identifier_string:Fn,is_identifier_char:Pn,is_surrogate_pair_head:function(e){return e>=55296&&e<=56319},is_surrogate_pair_tail:function(e){return e>=56320&&e<=57343},tokenizer:Rn,parse:qn,KEYWORDS:mn,RESERVED_WORDS:An,KEYWORDS_BEFORE_EXPRESSION:wn,KEYWORDS_ATOM:Sn}});
//# sourceMappingURL=sourcemaps/parse.js.map
