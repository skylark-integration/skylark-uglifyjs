/**
 * skylark-uglifyjs - A version of uglifyjs that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./utils","./ast"],function(e,n){"use strict";const{characters:t,defaults:r,find_if:a,makePredicate:o,set_annotation:i,configure_error_stack:s,HOP:u,all:c}=e,{AST_Accessor:l,AST_Array:f,AST_Arrow:p,AST_Assign:d,AST_Await:_,AST_BigInt:v,AST_Binary:m,AST_BlockStatement:w,AST_Break:S,AST_Call:k,AST_Case:y,AST_Catch:A,AST_Chain:h,AST_ClassExpression:b,AST_ClassGetter:T,AST_ClassInit:g,AST_ClassMethod:x,AST_ClassPrivateProperty:E,AST_ClassProperty:C,AST_ClassStaticBlock:D,AST_ClassSetter:I,AST_ConciseMethod:P,AST_PrivateIn:F,AST_PrivateGetter:O,AST_PrivateMethod:N,AST_PrivateSetter:G,AST_Conditional:R,AST_Const:U,AST_Continue:j,AST_Debugger:L,AST_Default:$,AST_DefaultAssign:M,AST_DefaultValue:Y,AST_DefClass:q,AST_Definitions:B,AST_Defun:V,AST_Destructured:X,AST_DestructuredArray:z,AST_DestructuredKeyVal:K,AST_DestructuredObject:W,AST_Destructuring:H,AST_Directive:J,AST_Do:Q,AST_Dot:Z,AST_DotHash:ee,AST_EmptyStatement:ne,AST_Expansion:te,AST_Export:re,AST_ExportDeclaration:ae,AST_False:oe,AST_Finally:ie,AST_For:se,AST_ForIn:ue,AST_ForOf:ce,AST_Function:le,AST_Hole:fe,AST_If:pe,AST_Import:de,AST_ImportMeta:_e,AST_IterationStatement:ve,AST_Label:me,AST_LabeledStatement:we,AST_LabelRef:Se,AST_Let:ke,AST_NameMapping:ye,AST_New:Ae,AST_NewTarget:he,AST_Node:be,AST_Null:Te,AST_Number:ge,AST_Object:xe,AST_ObjectGetter:Ee,AST_ObjectKeyVal:Ce,AST_ObjectMethod:De,AST_ObjectProperty:Ie,AST_ObjectSetter:Pe,AST_PrefixedTemplateString:Fe,AST_PropAccess:Oe,AST_RegExp:Ne,AST_Return:Ge,AST_Sequence:Re,AST_SimpleStatement:Ue,AST_Spread:je,AST_String:Le,AST_Sub:$e,AST_Super:Me,AST_Switch:Ye,AST_SymbolCatch:qe,AST_SymbolClass:Be,AST_SymbolClassProperty:Ve,AST_SymbolConst:Xe,AST_SymbolDeclaration:ze,AST_SymbolDefClass:Ke,AST_SymbolDefun:We,AST_SymbolExport:He,AST_SymbolExportForeign:Je,AST_SymbolFunarg:Qe,AST_SymbolImport:Ze,AST_SymbolImportForeign:en,AST_SymbolLambda:nn,AST_SymbolLet:tn,AST_SymbolMethod:rn,AST_SymbolRef:an,AST_SymbolVar:on,AST_Template:sn,AST_TemplateSegment:un,AST_TemplateString:cn,AST_This:ln,AST_SymbolPrivateProperty:fn,AST_Throw:pn,AST_Token:dn,AST_Toplevel:_n,AST_True:vn,AST_Try:mn,AST_TryBlock:wn,AST_UnaryPostfix:Sn,AST_UnaryPrefix:kn,AST_Var:yn,AST_VarDef:An,AST_While:hn,AST_With:bn,AST_Yield:Tn,_INLINE:gn,_NOINLINE:xn,_PURE:En,_KEY:Cn,_MANGLEPROP:Dn}=n;var In="break case catch class const continue debugger default delete do else extends finally for function if in instanceof new return switch throw try typeof var void while with",Pn="false null true",Fn=["abstract async await boolean byte char double enum export final float goto implements import int interface let long native package private protected public short static super synchronized this throws transient volatile yield",Pn,In].join(" "),On="return new delete throw else case";In=o(In),Fn=o(Fn),On=o(On),Pn=o(Pn);var Nn=/^0b([01]+)$/i,Gn=/^0x([0-9a-f]+)$/i,Rn=/^0o?([0-7]+)$/i,Un=o(["in","instanceof","typeof","new","void","delete","++","--","+","-","!","~","&","|","^","*","/","%","**",">>","<<",">>>","<",">","<=",">=","==","===","!=","!==","?","=","+=","-=","/=","*=","%=","**=",">>=","<<=",">>>=","&=","|=","^=","&&","||","??","&&=","||=","??="]),jn="\n\r\u2028\u2029",Ln="+-*&%=<>!?|~^",$n=",;:)}]",Mn="[{(,;:",Yn=Mn+"`)}]",qn=jn+"  \t\f\v​             　\ufeff",Bn=o(t("./'\"#"+Ln+Yn+qn));function Vn(e){return e>=48&&e<=57}function Xn(e){return!Bn[e]}function zn(e){return/^[a-z_$][a-z0-9_$]*$/i.test(e)}function Kn(e,n,t,r,a){this.message=e,this.filename=n,this.line=t,this.col=r,this.pos=a}function Wn(e,n,t,r,a){throw new Kn(e,n,t,r,a)}function Hn(e,n,t){return e.type==n&&(null==t||e.value==t)}jn=o(t(jn)),Ln=o(t(Ln)),$n=o(t($n)),Mn=o(t(Mn)),Yn=o(t(Yn)),qn=o(t(qn)),Kn.prototype=Object.create(Error.prototype),Kn.prototype.constructor=Kn,Kn.prototype.name="SyntaxError",s(Kn);var Jn={};function Qn(e,n,t,r){var a={text:e,filename:n,pos:0,tokpos:0,line:1,tokline:0,col:0,tokcol:0,newline_before:!1,regex_allowed:!1,comments_before:[],directives:Object.create(null),read_template:T("Unterminated template literal",function(e){for(var n="";;){var t=r();switch(t){case"\\":t+=r();break;case"`":return void e.push(n);case"$":if("{"==i())return s(),e.push(n),a.regex_allowed=!0,!0}n+=t}function r(){var e=s(!0,!0);return"\r"==e?"\n":e}})},o=!1;function i(){return a.text.charAt(a.pos)}function s(e,n){var t=a.text.charAt(a.pos++);if(e&&!t)throw Jn;return jn[t]?(a.col=0,a.line++,n||(a.newline_before=!0),"\r"==t&&"\n"==i()&&(a.pos++,t="\n")):a.col++,t}function u(e){for(;e-- >0;)s()}function c(e){return a.text.substr(a.pos,e.length)==e}function l(){a.tokline=a.line,a.tokcol=a.col,a.tokpos=a.pos}function f(t,r,i){a.regex_allowed="operator"==t&&!et[r]||"keyword"==t&&On[r]||"punc"==t&&Mn[r],"punc"==t&&"."==r?o=!0:i||(o=!1);var s={type:t,value:r,line:a.tokline,col:a.tokcol,pos:a.tokpos,endline:a.line,endcol:a.col,endpos:a.pos,nlb:a.newline_before,file:n};return/^(?:num|string|regexp)$/i.test(t)&&(s.raw=e.substring(s.pos,s.endpos)),i||(s.comments_before=a.comments_before,s.comments_after=a.comments_before=[]),a.newline_before=!1,new dn(s)}function p(){for(;qn[i()];)s()}function d(e){Wn(e,n,a.tokline,a.tokcol,a.tokpos)}function _(e){return/^0[0-7_]+$/.test(e)}function v(e){var n=!1,t=!1,r=!1,a="."==e,o=function(e){for(var n,t="";(n=i())&&e(n,t);)t+=s();return t}(function(e,o){switch(e){case"x":case"X":return!r&&(r=!0);case"e":case"E":return!!r||!n&&(n=t=!0);case"+":case"-":return t;case t=!1,".":return!(a||n||r||_(o))&&(a=!0)}return/[_0-9a-dfo]/i.test(e)});e&&(o=e+o),_(o)?g.has_directive("use strict")&&d("Legacy octal literals are not allowed in strict mode"):o=o.replace(r?/([1-9a-f]|.0)_(?=[0-9a-f])/gi:/([1-9]|.0)_(?=[0-9])/gi,"$1");var u=function(e){var n;if(n=Nn.exec(e))return parseInt(n[1],2);if(n=Gn.exec(e))return parseInt(n[1],16);if(n=Rn.exec(e))return parseInt(n[1],8);var t=parseFloat(e);return t==e?t:void 0}(o);return isNaN(u)&&d("Invalid syntax: "+o),a||n||"n"!=i()?f("num",u):f("bigint",o.toLowerCase()+s())}function m(e){var n=s(!0,e);if(n>="0"&&n<="7")return function(e){var n=i();n>="0"&&n<="7"&&(e+=s(!0))[0]<="3"&&(n=i())>="0"&&n<="7"&&(e+=s(!0));if("0"===e)return"\0";e.length>0&&g.has_directive("use strict")&&d("Legacy octal escape sequences are not allowed in strict mode");return String.fromCharCode(parseInt(e,8))}(n);if("u"==n){var t=s(!0,e);if(n+=t,"{"!=t)n+=s(!0,e)+s(!0,e)+s(!0,e);else do{n+=t=s(!0,e)}while("}"!=t)}else"x"==n&&(n+=s(!0,e)+s(!0,e));var r=function(e){switch(e[0]){case"b":return"\b";case"f":return"\f";case"n":return"\n";case"r":return"\r";case"t":return"\t";case"u":var n;if("{"==e[1]&&"}"==e.slice(-1))n=e.slice(2,-1);else{if(5!=e.length)return;n=e.slice(1)}if((t=parseInt(n,16))<0||isNaN(t))return;if(t<65536)return String.fromCharCode(t);if(t>1114111)return;return String.fromCharCode(55232+(t>>10))+String.fromCharCode(56320+(1023&t));case"v":return"\v";case"x":if(3!=e.length)return;var t;if((t=parseInt(e.slice(1),16))<0||isNaN(t))return;return String.fromCharCode(t);case"\r":case"\n":return"";default:if("0"==e)return"\0";if(e[0]>="0"&&e[0]<="9")return;return e}}(n);return"string"!=typeof r&&d("Invalid escape sequence: \\"+n),r}var w=T("Unterminated string constant",function(e){for(var n=s(),t="";;){var r=s(!0,!0);if("\\"==r)r=m(!0);else if(jn[r])d("Unterminated string constant");else if(r==n)break;t+=r}var a=f("string",t);return a.quote=e,a});function S(e){var n,t=a.regex_allowed,r=function(){for(var e=a.text,n=a.pos;n<a.text.length;++n)if(jn[e[n]])return n;return-1}();return-1==r?(n=a.text.substr(a.pos),a.pos=a.text.length):(n=a.text.substring(a.pos,r),a.pos=r),a.col=a.tokcol+(a.pos-a.tokpos),a.comments_before.push(f(e,n,!0)),a.regex_allowed=t,g}var k=T("Unterminated multiline comment",function(){var e=a.regex_allowed,n=function(e,n){var t=a.text.indexOf(e,a.pos);if(n&&-1==t)throw Jn;return t}("*/",!0),t=a.text.substring(a.pos,n).replace(/\r\n|\r|\u2028|\u2029/g,"\n");return u(t.length+2),a.comments_before.push(f("comment2",t,!0)),a.regex_allowed=e,g});function y(){for(var e,n=!1,t=!1,r="#"==i()?s():"";e=i();)if(n)"u"!=e&&d("Expecting UnicodeEscapeSequence -- uXXXX"),Xn(e=m())||d("Unicode char: "+e.charCodeAt(0)+" is not valid in identifier"),r+=e,n=!1;else if("\\"==e)t=n=!0,s();else{if(!Xn(e))break;r+=s()}if(In[r]&&t){var a=r.charCodeAt(0).toString(16).toUpperCase();r="\\u"+"0000".substr(a.length)+a+r.slice(1)}return r}var A=T("Unterminated regular expression",function(e){for(var n,t=!1,r=!1;n=s(!0);)if(jn[n])d("Unexpected line terminator");else if(t)e+="\\"+n,t=!1;else if("["==n)r=!0,e+=n;else if("]"==n&&r)r=!1,e+=n;else{if("/"==n&&!r)break;"\\"==n?t=!0:e+=n}var a=y();try{var o=new RegExp(e,a);return o.raw_source=e,f("regexp",o)}catch(e){d(e.message)}});function h(e){return f("operator",function e(n){if(!i())return n;var t=n+i();return Un[t]?(s(),e(t)):n}(e||s()))}function b(){switch(s(),i()){case"/":return s(),S("comment1");case"*":return s(),k()}return a.regex_allowed?A(""):h("/")}function T(e,n){return function(t){try{return n(t)}catch(n){if(n!==Jn)throw n;d(e)}}}function g(e){if(null!=e)return A(e);for(r&&0==a.pos&&c("#!")&&(l(),u(2),S("comment5"));;){if(p(),l(),t){if(c("\x3c!--")){u(4),S("comment3");continue}if(c("--\x3e")&&a.newline_before){u(3),S("comment4");continue}}var n=i();if(!n)return f("eof");var _=n.charCodeAt(0);switch(_){case 34:case 39:return w(n);case 46:return s(),c("..")?f("operator","."+s()+s()):Vn(i().charCodeAt(0))?v("."):f("punc",".");case 47:var m=b();if(m===g)continue;return m}if(Vn(_))return v();if(Yn[n])return f("punc",s());if(c("=>"))return f("punc",s()+s());if(Ln[n])return h();if(35==_||92==_||!Bn[n])return void 0,k=y(),o?f("name",k):Pn[k]?f("atom",k):In[k]?Un[k]?f("operator",k):f("keyword",k):f("name",k);break}var k;d("Unexpected character '"+n+"'")}return g.context=function(e){return e&&(a=e),a},g.add_directive=function(e){a.directives[e]=!0},g.push_directives_stack=function(){a.directives=Object.create(a.directives)},g.pop_directives_stack=function(){a.directives=Object.getPrototypeOf(a.directives)},g.has_directive=function(e){return!!a.directives[e]},g}var Zn=o("typeof void delete -- ++ ! ~ - +"),et=o("-- ++"),nt=o("= += -= /= *= %= **= >>= <<= >>>= &= |= ^= &&= ||= ??="),tt=function(e,n){for(var t=0;t<e.length;)for(var r=e[t++],a=0;a<r.length;a++)n[r[a]]=t;return n}([["??"],["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],["<",">","<=",">=","in","instanceof"],[">>","<<",">>>"],["+","-"],["*","/","%"],["**"]],{}),rt=o("atom bigint num regexp string");function at(e,n){n=r(n,{bare_returns:!1,expression:!1,filename:null,html5_comments:!0,module:!1,shebang:!0,strict:!1,toplevel:null},!0);var t={input:"string"==typeof e?Qn(e,n.filename,n.html5_comments,n.shebang):e,in_async:!1,in_directives:!0,in_funarg:-1,in_function:0,in_generator:!1,in_loop:0,labels:[],peeked:null,prev:null,token:null};function o(e,n){return Hn(t.token,e,n)}function i(){return t.peeked||(t.peeked=t.input())}function s(){return t.prev=t.token,t.peeked?(t.token=t.peeked,t.peeked=null):t.token=t.input(),t.in_directives=t.in_directives&&("string"==t.token.type||o("punc",";")),t.token}function h(){return t.prev}function E(e,n,r,a){var o=t.input.context();Wn(e,o.filename,null!=n?n:o.tokline,null!=r?r:o.tokcol,null!=a?a:o.tokpos)}function C(e,n){E(n,e.line,e.col)}function D(e,n){return e+(void 0===n?"":" «"+n+"»")}function P(e){null==e&&(e=t.token),C(e,"Unexpected token: "+D(e.type,e.value))}function F(e,n){if(o(e,n))return s();C(t.token,"Unexpected token: "+D(t.token.type,t.token.value)+", expected: "+D(e,n))}function O(e){return F("punc",e)}function N(e){return e.nlb||!c(e.comments_before,function(e){return!e.nlb})}function G(){return!n.strict&&(o("eof")||o("punc","}")||N(t.token))}function M(e){o("punc",";")?s():e||G()||O(";")}function H(){O("(");var e=st();return O(")"),e}function ee(e){return function(){var n=t.token,r=e.apply(null,arguments),a=h();return r.start=n,r.end=a,r}}function te(){(o("operator","/")||o("operator","/="))&&(t.peeked=null,t.token=t.input(t.token.value.substr(1)))}t.token=s();var re=ee(function(e){switch(te(),t.token.type){case"string":var r=t.in_directives,a=st();if(r)if(a instanceof Le){var u=a.start.raw.slice(1,-1);t.input.add_directive(u),a.value=u}else t.in_directives=r=!1;return M(),r?new J(a):new Ue({body:a});case"num":case"bigint":case"regexp":case"operator":case"atom":return _e();case"name":switch(t.token.value){case"async":if(Hn(i(),"keyword","function"))return s(),s(),o("operator","*")?(s(),Je(AST_AsyncGeneratorDefun)):Je(AST_AsyncDefun);break;case"await":if(t.in_async)return _e();break;case"export":return e||""===n.module||P(),s(),function(){if(o("operator","*")){var e=t.token,n=e;return s(),o("name","as")&&(s(),en()||F("name"),n=t.token,s()),F("name","from"),new AST_ExportForeign({aliases:[rn(n)],keys:[rn(e)],path:un()})}if(o("punc","{")){s();for(var r=[],a=[];en();){var e=t.token;s(),a.push(e),o("name","as")?(s(),en()||F("name"),r.push(t.token),s()):r.push(e),o("punc","}")||O(",")}return O("}"),o("name","from")?(s(),new AST_ExportForeign({aliases:r.map(rn),keys:a.map(rn),path:un()})):(M(),new AST_ExportReferences({properties:a.map(function(e,n){Hn(e,"name")||C(e,"Name expected");var t=Un(He,e);return t.alias=rn(r[n]),t})}))}if(o("keyword","default")){s();var u=t.token,c=function(){if(o("name","async")){if(!Hn(i(),"keyword","function"))return;return s(),s(),o("operator","*")?(s(),cn(AST_AsyncGeneratorDefun,Je(AST_AsyncGeneratorFunction))):cn(AST_AsyncDefun,Je(AST_AsyncFunction))}if(o("keyword"))switch(t.token.value){case"class":return s(),cn(q,Ie(b));case"function":return s(),o("operator","*")?(s(),cn(AST_GeneratorDefun,Je(AST_GeneratorFunction))):cn(V,Je(le))}}();return c?(c.start=u,c.end=h()):(te(),c=st(),M()),new AST_ExportDefault({body:c})}return new ae({body:fn()})}();case"import":var l=i();if("punc"==l.type&&/^[(.]$/.test(l.value))break;return e||""===n.module||P(),s(),function(){var e,n=null,r=Ln(Ze,!0),a=null;r?(r.key=new Le({start:r.start,value:"",end:r.end}),(e=o("punc",","))&&s()):e=!o("string");if(e)if(o("operator","*")){var u=t.token;s(),F("name","as"),(n=Ln(Ze)).key=rn(u)}else{for(O("{"),a=[];en();){var c;if(Hn(i(),"name","as")){var u=t.token;s(),s(),(c=Ln(Ze)).key=rn(u)}else(c=Ln(Ze)).key=new Le({start:c.start,value:c.name,end:c.end});a.push(c),o("punc","}")||O(",")}O("}")}(n||r||a)&&F("name","from");return new de({all:n,default:r,path:un(),properties:a})}();case"let":if(xn()){s();var f=Cn();return M(),f}break;case"yield":if(t.in_generator)return _e()}return Hn(i(),"punc",":")?function(){var e=Ln(me);c(t.labels,function(n){return n.name!=e.name})||E("Label "+e.name+" defined twice");O(":"),t.labels.push(e);var n=re();t.labels.pop(),n instanceof ve||e.references.forEach(function(n){n instanceof j&&C(n.label.start,"Continue label `"+e.name+"` must refer to IterationStatement")});return new we({body:n,label:e})}():_e();case"punc":switch(t.token.value){case"{":return new w({start:t.token,body:dn(),end:h()});case"[":case"(":case"`":return _e();case";":return t.in_directives=!1,s(),new ne;default:P()}case"keyword":switch(t.token.value){case"break":return s(),ye(S);case"class":return s(),Ie(q);case"const":s();f=En();return M(),f;case"continue":return s(),ye(j);case"debugger":return s(),M(),new L;case"do":s();a=ut(re);F("keyword","while");var p=H();return M(!0),new Q({body:a,condition:p});case"while":return s(),new hn({condition:H(),body:ut(re)});case"for":return s(),function(){var e=o("name","await")&&s();O("(");var n=null;if(e||!o("punc",";")){var t;if(n=o("keyword","const")?(s(),En(!0)):o("name","let")&&xn()?(s(),Cn(!0)):o("keyword","var")?(s(),Dn(!0)):st(!0),e?(F("name","of"),t=AST_ForAwaitOf):o("operator","in")?(s(),t=ue):o("name","of")&&(s(),t=ce),t)return n instanceof B?(n.definitions.length>1&&C(n.start,"Only one variable declaration allowed in for..in/of loop"),t!==ue&&n.definitions[0].value&&C(n.definitions[0].value.start,"No initializers allowed in for..of loop")):at(n)||(n=ot(n))instanceof X||C(n.start,"Invalid left-hand side in for..in/of loop"),function(e,n){te();var t=st();return O(")"),new e({init:n,object:t,body:ut(re)})}(t,n)}return function(e){O(";");var n=o("punc",";")?null:st();O(";");var t=o("punc",")")?null:st();return O(")"),new se({init:e,condition:n,step:t,body:ut(re)})}(n)}();case"function":return s(),o("operator","*")?(s(),Je(AST_GeneratorDefun)):Je(V);case"if":return s(),function(){var e=H(),n=re(),t=null;o("keyword","else")&&(s(),t=re());return new pe({condition:e,body:n,alternative:t})}();case"return":0!=t.in_function||n.bare_returns||E("'return' outside of function"),s();u=null;return o("punc",";")?s():G()||(u=st(),M()),new Ge({value:u});case"switch":return s(),new Ye({expression:H(),body:ut(wn)});case"throw":s(),N(t.token)&&E("Illegal newline after 'throw'");u=st();return M(),new pn({value:u});case"try":return s(),function(){var e=dn(),n=null,r=null;if(o("keyword","catch")){var a=t.token;s();var i=null;o("punc","(")&&(s(),i=Mn(qe),O(")")),n=new A({start:a,argname:i,body:dn(),end:h()})}if(o("keyword","finally")){var a=t.token;s(),r=new ie({start:a,body:dn(),end:h()})}n||r||E("Missing catch/finally blocks");return new mn({body:e,bcatch:n,bfinally:r})}();case"var":s();f=Dn();return M(),f;case"with":return t.input.has_directive("use strict")&&E("Strict mode may not include a with statement"),s(),new bn({expression:H(),body:re()})}}P()});function _e(){var e=st();return M(),new Ue({body:e})}function ye(e){var n,r=null;G()||(r=Ln(Se,!0)),null!=r?((n=a(function(e){return e.name==r.name},t.labels))||C(r.start,"Undefined label "+r.name),r.thedef=n):0==t.in_loop&&E(e.TYPE+" not inside a loop or switch"),M();var o=new e({label:r});return n&&n.references.push(o),o}function be(e,n){if(o("name",e)){var t=i();if(t&&!Hn(t,"operator","=")&&!("punc"==t.type&&/^[(;}]$/.test(t.value)||n&&N(t)))return s()}}function Ie(e){var n,r=t.in_async,a=t.in_generator;t.input.push_directives_stack(),t.input.add_directive("use strict"),n=e===q?Ln(Ke):Ln(Be,!0);var i=null;o("keyword","extends")&&(s(),te(),i=Pn(!0)),O("{");for(var u=[];!o("punc","}");)if(o("punc",";"))s();else{var c=t.token,l=!!be("static"),f=be("async",!0);if(o("operator","*")){s();var p=o("name")&&/^#/.test(t.token.value),d=Rn(),_=t.token,v=Je(f?AST_AsyncGeneratorFunction:AST_GeneratorFunction);v.start=_,v.end=h(),u.push(new x({start:c,static:l,private:p,key:d,value:v,end:h()}))}else if(l&&o("punc","{"))u.push(new g({start:c,value:new AST_ClassInitBlock({start:c,body:dn(),end:h()}),end:h()}));else{p=o("name")&&/^#/.test(t.token.value),d=Rn();if(o("punc","(")){var m=t.token,w=Je(f?AST_AsyncFunction:le);w.start=m,w.end=h(),u.push(new x({start:c,static:l,private:p,key:d,value:w,end:h()}))}else{f&&P(f);var S=null;if(o("operator","="))s(),t.in_async=!1,t.in_generator=!1,S=it(),t.in_generator=a,t.in_async=r;else if(!o("punc",";")&&!o("punc","}")){var k=null;switch(d){case"get":k=T;break;case"set":k=I}if(k){u.push(new k({start:c,static:l,private:o("name")&&/^#/.test(t.token.value),key:Rn(),value:Nn(),end:h()}));continue}}M(),u.push(new AST_ClassField({start:c,static:l,private:p,key:d,value:S,end:h()}))}}}return s(),t.input.pop_directives_stack(),t.in_generator=a,t.in_async=r,new e({extends:i,name:n,properties:u})}function Fe(e){if(e instanceof f){var n=null;return e.elements[e.elements.length-1]instanceof je&&(n=Fe(e.elements.pop().expression)),new z({start:e.start,elements:e.elements.map(Fe),rest:n,end:e.end})}if(e instanceof d)return new Y({start:e.start,name:Fe(e.left),value:e.right,end:e.end});if(e instanceof Y)return e.name=Fe(e.name),e;if(e instanceof z)return e.elements=e.elements.map(Fe),e.rest&&(e.rest=Fe(e.rest)),e;if(e instanceof W)return e.properties.forEach(function(e){e.value=Fe(e.value)}),e.rest&&(e.rest=Fe(e.rest)),e;if(e instanceof fe)return e;if(e instanceof xe){n=null;return e.properties[e.properties.length-1]instanceof je&&(n=Fe(e.properties.pop().expression)),new W({start:e.start,properties:e.properties.map(function(e){return e instanceof Ce||C(e.start,"Invalid destructuring assignment"),new K({start:e.start,key:e.key,value:Fe(e.value),end:e.end})}),rest:n,end:e.end})}return e instanceof Qe?e:e instanceof an?new Qe(e):e instanceof Tn?new Qe({start:e.start,name:"yield",end:e.end}):void C(e.start,"Invalid arrow parameter")}function Ve(e,n,r){var a=t.in_async,i=t.in_generator;t.in_async=r,t.in_generator=!1;var s=t.in_funarg;t.in_funarg=t.in_function;var u,c,l=e.map(Fe),f=e.rest||null;f&&(f=Fe(f)),t.in_funarg=s,O("=>");var d=t.in_loop,_=t.labels;++t.in_function,t.input.push_directives_stack(),t.in_loop=0,t.labels=[],o("punc","{")?(t.in_directives=!0,u=dn(),c=null):(u=[],te(),c=it());var v=t.input.has_directive("use strict");t.input.pop_directives_stack(),--t.in_function,t.in_loop=d,t.labels=_,t.in_generator=i,t.in_async=a;var m=new(r?AST_AsyncArrow:p)({start:n,argnames:l,rest:f,body:u,value:c,end:h()});return v&&m.each_argname(jn),m}var Je=function(e){var r,a=t.in_async,o=t.in_generator;/Defun$/.test(e.TYPE)?(r=Ln(We),t.in_async=/^Async/.test(e.TYPE),t.in_generator=/Generator/.test(e.TYPE)):(t.in_async=/^Async/.test(e.TYPE),t.in_generator=/Generator/.test(e.TYPE),r=Ln(nn,!0)),!r||e===l||r instanceof ze||P(h()),O("(");var i=t.in_funarg;t.in_funarg=t.in_function;var s=Fn(")",!n.strict,!1,function(){return Yn(Qe)});t.in_funarg=i;var u=t.in_loop,c=t.labels;++t.in_function,t.in_directives=!0,t.input.push_directives_stack(),t.in_loop=0,t.labels=[];var f=dn(),p=t.input.has_directive("use strict");t.input.pop_directives_stack(),--t.in_function,t.in_loop=u,t.labels=c,t.in_generator=o,t.in_async=a;var d=new e({name:r,argnames:s,rest:s.rest||null,body:f});return p&&(r&&jn(r),d.each_argname(jn)),d};function en(){return o("name")||o("string")||zn(t.token.value)}function rn(e){return new Le({start:e,quote:e.quote,value:e.value,end:e})}function un(){var e=t.token;return F("string"),M(),rn(e)}function cn(e,n){return n.name&&((n=new e(n)).name=new(e===q?Ke:We)(n.name)),n}var fn=ee(function(){if(o("name"))switch(t.token.value){case"async":return s(),F("keyword","function"),o("operator","*")?(s(),Je(AST_AsyncGeneratorDefun)):Je(AST_AsyncDefun);case"let":s();var e=Cn();return M(),e}else if(o("keyword"))switch(t.token.value){case"class":return s(),Ie(q);case"const":s();e=En();return M(),e;case"function":return s(),o("operator","*")?(s(),Je(AST_GeneratorDefun)):Je(V);case"var":s();e=Dn();return M(),e}P()});function dn(){O("{");for(var e=[];!o("punc","}");)o("eof")&&O("}"),e.push(re());return s(),e}function wn(){O("{");for(var e,n,r,a,i=[];!o("punc","}");)o("eof")&&O("}"),o("keyword","case")?(e&&(e.end=h()),n=[],e=new y({start:(a=t.token,s(),a),expression:st(),body:n}),i.push(e),O(":")):o("keyword","default")?(e&&(e.end=h()),r&&E("More than one default clause in switch statement"),n=[],e=new $({start:(a=t.token,s(),O(":"),a),body:n}),i.push(e),r=e):(n||P(),n.push(re()));return e&&(e.end=h()),s(),i}function gn(e,n){for(var r=[];;){var a=t.token,i=Mn(e),u=null;if(o("operator","=")?(s(),u=it(n)):!n&&(e===Xe||i instanceof X)&&E("Missing initializer in declaration"),r.push(new An({start:a,name:i,value:u,end:h()})),!o("punc",","))break;s()}return r}function xn(){var e=i();return Hn(e,"name")||Hn(e,"punc","[")||Hn(e,"punc","{")}var En=function(e){return new U({start:h(),definitions:gn(Xe,e),end:h()})},Cn=function(e){return new ke({start:h(),definitions:gn(tn,e),end:h()})},Dn=function(e){return new yn({start:h(),definitions:gn(on,e),end:h()})};var Pn=function(e){if(o("operator","new"))return function(e){var r,a=t.token;if(F("operator","new"),o("punc",".")&&Hn(i(),"name","target"))s(),s(),r=new he;else{var u,c=Pn(!1);o("punc","(")?(s(),u=Fn(")",!n.strict)):u=[],r=new Ae({expression:c,args:u})}return r.start=a,r.end=h(),Bn(r,e)}(e);var r=t.token;if(o("punc")){switch(r.value){case"`":return Bn(qn(null),e);case"(":if(s(),o("punc",")"))return s(),Ve([],r);var a=st(!1,!0),u=r.comments_before.length;if([].unshift.apply(a.start.comments_before,r.comments_before),r.comments_before.length=0,r.comments_before=a.start.comments_before,r.comments_before_length=u,0==u&&r.comments_before.length>0){var c=r.comments_before[0];c.nlb||(c.nlb=r.nlb,r.nlb=!1)}r.comments_after=a.start.comments_after,a.start=r,O(")");var l=h();return l.comments_before=a.end.comments_before,l.comments_after.forEach(function(e){a.end.comments_after.push(e),e.nlb&&(t.token.nlb=!0)}),l.comments_after.length=0,l.comments_after=a.end.comments_after,a.end=l,o("punc","=>")?Ve(a instanceof Re?a.expressions:[a],r):Bn(a,e);case"[":return Bn(On(),e);case"{":return Bn(Gn(),e)}P()}if(o("keyword"))switch(r.value){case"class":s();var f=Ie(b);return f.start=r,f.end=h(),Bn(f,e);case"function":return s(),o("operator","*")?(s(),d=Je(AST_GeneratorFunction)):d=Je(le),d.start=r,d.end=h(),Bn(d,e)}if(o("name")){var p=Un(an,r);if(s(),"async"==p.name){var d;if(o("keyword","function"))return s(),o("operator","*")?(s(),d=Je(AST_AsyncGeneratorFunction)):d=Je(AST_AsyncFunction),d.start=r,d.end=h(),Bn(d,e);if(o("name")&&Hn(i(),"punc","=>"))return r=t.token,p=Un(an,r),s(),Ve([p],r,!0);if(o("punc","(")){var _=Bn(p,e);if(!o("punc","=>"))return _;var m=_.args;return m[m.length-1]instanceof je&&(m.rest=m.pop().expression),Ve(m,r,!0)}}return o("punc","=>")?Ve([p],r):Bn(p,e)}if(rt[t.token.type])return Bn(function(){var e,n=t.token,r=n.value;switch(n.type){case"num":isFinite(r)?e=new ge({value:r}):(e=new AST_Infinity,r<0&&(e=new kn({operator:"-",expression:e})));break;case"bigint":e=new v({value:r});break;case"string":e=new Le({value:r,quote:n.quote});break;case"regexp":e=new Ne({value:r});break;case"atom":switch(r){case"false":e=new oe;break;case"true":e=new vn;break;case"null":e=new Te;break;default:P()}break;default:P()}return s(),e.start=e.end=n,e}(),e);P()};function Fn(e,n,r,a){a||(a=it);for(var i=!0,u=[];!o("punc",e)&&(i?i=!1:O(","),!n||!o("punc",e));)if(r&&o("punc",","))u.push(new fe({start:t.token,end:t.token}));else if(o("operator","...")){if(a!==it){s(),u.rest=a(),u.rest instanceof Y&&C(u.rest.start,"Invalid rest parameter");break}u.push(new je({start:t.token,expression:(s(),a()),end:h()}))}else u.push(a());return O(e),u}var On=ee(function(){return O("["),new f({elements:Fn("]",!n.strict,!0)})}),Nn=ee(function(){return Je(l)}),Gn=ee(function(){O("{");for(var e=!0,r=[];!o("punc","}")&&(e?e=!1:O(","),n.strict||!o("punc","}"));){var a=t.token;if(o("operator","*")){s();var u=Rn(),c=t.token,l=Je(AST_GeneratorFunction);l.start=c,l.end=h(),r.push(new De({start:a,key:u,value:l,end:h()}))}else if(o("operator","..."))s(),r.push(new je({start:a,expression:it(),end:h()}));else if(Hn(i(),"operator","=")){var f=Ln(an);s(),r.push(new Ce({start:a,key:a.value,value:new d({start:a,left:f,operator:"=",right:it(),end:h()}),end:h()}))}else if(Hn(i(),"punc",",")||Hn(i(),"punc","}"))r.push(new Ce({start:a,key:a.value,value:Ln(an),end:h()}));else{u=Rn();if(o("punc","(")){var p=t.token;(v=Je(le)).start=p,v.end=h(),r.push(new De({start:a,key:u,value:v,end:h()}))}else if(o("punc",":"))s(),r.push(new Ce({start:a,key:u,value:it(),end:h()}));else{if("name"==a.type)switch(u){case"async":var _=o("operator","*")&&s();u=Rn();var v;p=t.token;(v=Je(_?AST_AsyncGeneratorFunction:AST_AsyncFunction)).start=p,v.end=h(),r.push(new De({start:a,key:u,value:v,end:h()}));continue;case"get":r.push(new Ee({start:a,key:Rn(),value:Nn(),end:h()}));continue;case"set":r.push(new Pe({start:a,key:Rn(),value:Nn(),end:h()}));continue}P()}}}return s(),new xe({properties:r})});function Rn(){var e=t.token;switch(e.type){case"operator":In[e.value]||P();case"num":case"string":case"name":case"keyword":case"atom":return s(),""+e.value;case"punc":O("[");var n=it();return O("]"),n;default:P()}}function Un(e,n){var r=n.value;switch(r){case"await":t.in_async&&P(n);break;case"super":e=Me;break;case"this":e=ln;break;case"yield":t.in_generator&&P(n)}return new e({name:""+r,start:n,end:n})}function jn(e){"arguments"!=e.name&&"eval"!=e.name&&"let"!=e.name||C(e.start,"Unexpected "+e.name+" in strict mode")}function Ln(e,n){if(!o("name"))return n||E("Name expected"),null;var r=Un(e,t.token);return t.input.has_directive("use strict")&&r instanceof ze&&jn(r),s(),r}function Mn(e){var r=t.token;if(o("punc","[")){s();var a=Fn("]",!n.strict,!0,function(){return Yn(e)});return new z({start:r,elements:a,rest:a.rest||null,end:h()})}if(o("punc","{")){s();for(var u=!0,c=[],l=null;!o("punc","}")&&(u?u=!1:O(","),n.strict||!o("punc","}"));){var f=t.token;if(o("punc","[")||Hn(i(),"punc",":")){var p=Rn();O(":"),c.push(new K({start:f,key:p,value:Yn(e),end:h()}))}else{if(o("operator","...")){s(),l=Mn(e);break}var d=Ln(e);o("operator","=")&&(s(),d=new Y({start:d.start,name:d,value:it(),end:h()})),c.push(new K({start:f,key:f.value,value:d,end:h()}))}}return O("}"),new W({start:r,properties:c,rest:l,end:h()})}return Ln(e)}function Yn(e){var n=t.token,r=Mn(e);return o("operator","=")?(s(),new Y({start:n,name:r,value:it(),end:h()})):r}function qn(e){for(var n=e?e.start:t.token,r=t.input.context().read_template,a=[],i=[];r(a);)s(),i.push(st()),o("punc","}")||P();return s(),new sn({start:n,expressions:i,strings:a,tag:e,end:h()})}function Bn(e,r){for(var a,c=e.start,l=null;;)if(o("operator","?")&&Hn(i(),"punc",".")&&(s(),s(),l=e),o("punc","[")){s();var f=st();O("]"),e=new $e({start:c,optional:l===e,expression:e,property:f,end:h()})}else if(r&&o("punc","("))s(),e=new k({start:c,optional:l===e,expression:e,args:Fn(")",!n.strict),end:h()});else if(l===e||o("punc","."))l!==e&&s(),e=new Z({start:c,optional:l===e,expression:e,property:(void 0,a=t.token.value,F("name"),a),end:h()});else{if(!o("punc","`"))break;l&&E("Invalid template on optional chain"),e=qn(e)}if(l&&(e.terminal=!0),e instanceof k&&!e.pure)for(var p=(c=e.start).comments_before,d=u(c,"comments_before_length")?c.comments_before_length:p.length;--d>=0;)if(/[@#]__PURE__/.test(p[d].value)){e.pure=!0;break}return e}function Vn(e){var n=t.token;if(t.in_async&&o("name","await"))return t.in_funarg===t.in_function&&E("Invalid use of await in function argument"),t.input.context().regex_allowed=!0,s(),new _({start:n,expression:Vn(e),end:h()});if(t.in_generator&&o("name","yield")){t.in_funarg===t.in_function&&E("Invalid use of yield in function argument"),t.input.context().regex_allowed=!0,s();var r=null,a=!1;return o("operator","*")?(s(),r=it(e),a=!0):(o("punc")?$n[t.token.value]:G())||(r=it(e)),new Tn({start:n,expression:r,nested:a,end:h()})}if(o("operator")&&Zn[n.value]){s(),te();var i=Xn(kn,n,Vn(e));return i.start=n,i.end=h(),i}for(var u=Pn(!0);o("operator")&&et[t.token.value]&&!N(t.token);)(u=Xn(Sn,t.token,u)).start=n,u.end=t.token,s();return u}function Xn(e,n,r){var a=n.value;switch(a){case"++":case"--":at(r)||C(n,"Invalid use of "+a+" operator");break;case"delete":r instanceof an&&t.input.has_directive("use strict")&&C(r.start,"Calling delete on expression not allowed in strict mode")}return new e({operator:a,expression:r})}var Kn=function(e,n,r){var a=o("operator")?t.token.value:null;"in"==a&&r&&(a=null);var i=null!=a?tt[a]:null;if(null!=i&&i>n){s();var u=Kn(Vn(r),"**"==a?i-1:i,r);return Kn(new m({start:e.start,left:e,operator:a,right:u,end:u.end}),n,r)}return e};var Jn=function(e){var n=t.token,r=function(e){return Kn(Vn(e),0,e)}(e);if(o("operator","?")){s();var a=it();return O(":"),new R({start:n,condition:r,consequent:a,alternative:it(e),end:h()})}return r};function at(e){return e instanceof Oe&&!e.optional||e instanceof an}function ot(e){if(e instanceof f){var n=null;if(e.elements[e.elements.length-1]instanceof je&&!((n=ot(e.elements.pop().expression))instanceof X||at(n)))return e;var t=e.elements.map(ot);return c(t,function(e){return e instanceof Y||e instanceof X||e instanceof fe||at(e)})?new z({start:e.start,elements:t,rest:n,end:e.end}):e}if(e instanceof d){var r=ot(e.left);return r instanceof X||at(r)?new Y({start:e.start,name:r,value:e.right,end:e.end}):e}if(!(e instanceof xe))return e;n=null;if(e.properties[e.properties.length-1]instanceof je&&!((n=ot(e.properties.pop().expression))instanceof X||at(n)))return e;for(var a=[],o=0;o<e.properties.length;o++){var i=e.properties[o];if(!(i instanceof Ce))return e;var s=ot(i.value);if(!(s instanceof Y||s instanceof X||at(s)))return e;a.push(new K({start:i.start,key:i.key,value:s,end:i.end}))}return new W({start:e.start,properties:a,rest:n,end:e.end})}function it(e){var n=t.token,r=Jn(e),a=t.token.value;if(o("operator")&&nt[a]){if(at(r)||"="==a&&(r=ot(r))instanceof X)return s(),new d({start:n,left:r,operator:a,right:it(e),end:h()});E("Invalid assignment")}return r}function st(e,n){for(var r=t.token,a=[];;){if(n&&o("operator","...")){s(),a.rest=Mn(Qe);break}if(a.push(it(e)),!o("punc",","))break;if(s(),n&&o("punc",")")&&Hn(i(),"punc","=>"))break}return 1!=a.length||a.rest?new Re({start:r,expressions:a,end:h()}):a[0]}function ut(e){++t.in_loop;var n=e();return--t.in_loop,n}if(n.expression){te();var ct=st();return F("eof"),ct}return function(){var e=t.token,r=[];for(n.module&&(t.in_async=!0,t.input.add_directive("use strict")),t.input.push_directives_stack();!o("eof");)r.push(re(!0));t.input.pop_directives_stack();var a=h()||e,i=n.toplevel;return i?(i.body=i.body.concat(r),i.end=a):i=new _n({start:e,body:r,end:a}),i}()}return n.parse=at,{is_identifier_string:zn,is_identifier_char:Xn,is_surrogate_pair_head:function(e){return e>=55296&&e<=56319},is_surrogate_pair_tail:function(e){return e>=56320&&e<=57343},tokenizer:Qn,parse:at,KEYWORDS:In,RESERVED_WORDS:Fn,KEYWORDS_BEFORE_EXPRESSION:On,KEYWORDS_ATOM:Pn,UNARY_POSTFIX:et,PRECEDENCE:tt}});
//# sourceMappingURL=sourcemaps/parse.js.map
